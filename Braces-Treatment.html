<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Braces Treatment Plan - Optimized UI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="sidebar/sidebar.css">

      <style>
      :root {
        --sidebar-bg: #1e293b;
        --sidebar-active: #00bfff;
        --sidebar-hover: rgba(0,191,255,0.1);
        --bg: #eef8fc;
        --card: #ffffff;
        --shadow: 0 4px 20px rgba(0,0,0,0.08);
        --shadow-lg: 0 10px 40px rgba(0,0,0,0.12);
        --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
        --text: #2c3e50;
        --text-light: #64748b;
        --border: #e5e7eb;
        --border-light: #f1f5f9;
        --success: #32cd32;
        --success-light: rgba(50,205,50,0.1);
        --primary: #00bfff;
        --primary-light: rgba(0,191,255,0.08);
        --radius: 12px;
        --radius-lg: 16px;
        --radius-sm: 8px;
      }
       html, body {
            height: 100%;
            overflow: auto;
        }


        body {
            font-family: 'Inter', Arial, sans-serif;
            margin: 0;
            transition: background-color 0.3s ease;
            background-size: cover;
            background-attachment: fixed;
            background-color: var(--bg-color);
            color: var(--sidebar-text);
        }


        /* ============================================= */
        /* LAYOUT & STRUCTURE */
        /* ============================================= */


        .dashboard {
            display: flex;
            height: 100vh;
            min-height: 100vh;
            overflow: hidden;
            color: var(--text-color);
        }

        .main-content {
            flex-direction: column;
            padding: 20px;
            display: flex;
            flex: 3;
            transition: background-color 0.3s ease;
        }


        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            margin-top: -20px;
        }

        /* Dropdown Styles */
        .dropdown {
         position: relative;
        }

        .dropdown-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .dropdown-toggle .arrow {
            margin-left: auto;
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .dropdown.active .dropdown-toggle .arrow {
            transform: rotate(180deg);
        }

        .submenu {
            list-style: none;
            padding: 0;
            margin: 0;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 0 0 8px 8px;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            visibility: hidden;
        }

        .dropdown.active .submenu {
            max-height: 300px;
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }


        .btn {
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-flex;
            margin-top: -10px;
            align-items: center;
            gap: 5px;
            font-size: 13px;
            border: none;
        }
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--sidebar-active);
            color: var(--sidebar-active);
        }


        .btn-outline:hover {
            background-color: var(--sidebar-active);
            color: white;
            box-shadow: 0 4px 8px rgba(0, 191, 255, 0.2);
        }


        .theme-toggle {
            display: flex;
            align-items: center;
            margin-left: 20px;
            gap: 10px;
        }


        .theme-toggle-label {
            font-size: 14px;
            color: var(--text-color);
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }


        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }


        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }


        input:checked + .slider {
            background-color: #00bfff;
        }


        input:checked + .slider:before {
            transform: translateX(26px);
        }
/* ===== BASE ENHANCEMENTS ===== */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Inter', sans-serif;
}

html, body {
  height: 100%;
  overflow: hidden;
}

body {
  background: linear-gradient(135deg, #f0f9ff 0%, #eef8fc 100%);
  color: var(--text);
  margin: 0;
  min-height: 100vh;
  overflow: hidden;
}

/* ============================================= */
/* DASHBOARD LAYOUT - FIXED SIZING */
/* ============================================= */
.dashboard {
  display: flex;
  height: 100vh;
  width: 100vw;
  overflow: hidden;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}


/* ===== FIXED MAIN CONTENT ===== */
.main {
  margin-left: 200px;
  padding: 20px;
  min-height: 100vh;
  background: var(--bg);
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
  position: fixed;
  right: 0;
  top: 0;
  bottom: 0;
  width: calc(100vw - 200px);
  overflow-y: auto;
  height: 100vh;
}

/* FIXED CONTAINER */
.container {
  background: var(--card);
  padding: 30px;
  border-radius: var(--radius-lg);
  max-width: 1400px;
  width: 100%;
  margin: 0 auto 30px auto;
  box-shadow: var(--shadow);
  box-sizing: border-box;
  border: 1px solid rgba(255,255,255,0.9);
  position: relative;
  overflow: visible;
  min-height: calc(100vh - 40px);
}

.container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--sidebar-active), #0099cc);
}

/* FIXED HEADER */
.container h2 {
  font-size: 24px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 2px solid var(--border-light);
  display: flex;
  align-items: center;
  gap: 10px;
}

/* FIXED SEARCH BOX */
.search-box {
  background: #fff;
  padding: 12px 16px;
  border-radius: var(--radius);
  margin-bottom: 20px;
  position: relative;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border);
  transition: all 0.3s ease;
}

.search-box:focus-within {
  border-color: var(--sidebar-active);
  box-shadow: 0 0 0 3px rgba(0,191,255,0.15);
  transform: translateY(-1px);
}

.search-box input {
  width: 100%;
  border: none;
  outline: none;
  font-size: 14px;
  color: var(--text);
  padding-left: 30px;
  background: transparent;
}

.search-box::before {
  content: '\f002';
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--sidebar-active);
  font-size: 14px;
}

/* FIXED PATIENT LIST */
.patient-list {
  background: #fff;
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
  margin-bottom: 20px;
  border: 1px solid var(--border);
  overflow: hidden;
  max-height: 200px;
  overflow-y: auto;
}

.patient-item {
  padding: 12px 16px;
  cursor: pointer;
  border-bottom: 1px solid var(--border-light);
  transition: all 0.25s ease;
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.patient-item:hover {
  background: linear-gradient(90deg, var(--primary-light), transparent);
  padding-left: 20px;
}

.patient-item.selected {
  background: linear-gradient(90deg, rgba(0,191,255,0.15), transparent);
  font-weight: 600;
  color: var(--sidebar-active);
  border-left: 4px solid var(--sidebar-active);
}

.patient-item::before {
  content: 'ðŸ‘¤';
  font-size: 12px;
  opacity: 0.7;
}

.selected-patient {
  font-size: 14px;
  margin-bottom: 20px;
  padding: 12px;
  background: var(--primary-light);
  border-radius: var(--radius);
  border-left: 4px solid var(--sidebar-active);
}

.selected-patient b {
  color: var(--sidebar-active);
  margin-right: 6px;
}

/* ===== FIXED GRID LAYOUT ===== */
.grid-optimized {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

.card {
  background: #fff;
  border-radius: var(--radius-lg);
  padding: 20px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  min-height: 250px;
}

.card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-lg);
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--sidebar-active), transparent);
}

.card h3 {
  border-bottom: 2px solid var(--border-light);
  padding-bottom: 10px;
  margin-bottom: 15px;
  font-size: 15px;
  font-weight: 600;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 8px;
}

.card h3::before {
  content: '';
  width: 4px;
  height: 16px;
  background: var(--sidebar-active);
  border-radius: 2px;
}

/* FIXED FORM ELEMENTS */
.form-group {
  margin-bottom: 12px;
}

label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 6px 0;
  cursor: pointer;
  padding: 6px;
  border-radius: var(--radius-sm);
  transition: background 0.2s ease;
  font-size: 13px;
}

label:hover {
  background: var(--primary-light);
}

input[type="radio"],
input[type="checkbox"] {
  width: 14px;
  height: 14px;
  accent-color: var(--sidebar-active);
}

input[type="text"],
select {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  font-size: 13px;
  transition: all 0.3s ease;
  background: #fff;
}

input[type="text"]:focus,
select:focus {
  outline: none;
  border-color: var(--sidebar-active);
  box-shadow: 0 0 0 3px rgba(0,191,255,0.15);
}

/* FIXED BUTTONS */
.btn-outline {
  background: #fff;
  border: 2px solid var(--border);
  padding: 6px 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-weight: 600;
  font-size: 12px;
  color: var(--text);
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.btn-outline:hover {
  background: var(--border-light);
  border-color: var(--sidebar-active);
  color: var(--sidebar-active);
  transform: translateY(-1px);
}

.save-btn {
  background: linear-gradient(135deg, var(--success), #2aa52a);
  color: #fff;
  border: none;
  padding: 12px 16px;
  border-radius: var(--radius);
  cursor: pointer;
  font-weight: 600;
  font-size: 13px;
  width: 100%;
  margin-top: 12px;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  box-shadow: 0 4px 15px rgba(50,205,50,0.3);
}

.save-btn:hover {
  background: linear-gradient(135deg, #2aa52a, #228b22);
  transform: translateY(-1px);
  box-shadow: 0 6px 20px rgba(50,205,50,0.4);
}

/* ===== ENHANCED CHIEF COMPLAINT DESIGN ===== */
.chief-complaint-container {
  margin-bottom: 20px;
}

.chief-complaint-box {
  background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
  border: 2px solid var(--primary-light);
  border-radius: var(--radius-lg);
  padding: 20px;
  position: relative;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 191, 255, 0.08);
  min-height: 120px;
}

.chief-complaint-box:focus-within {
  border-color: var(--sidebar-active);
  box-shadow: 0 6px 20px rgba(0, 191, 255, 0.15);
  transform: translateY(-2px);
}

.chief-complaint-label {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
  color: var(--sidebar-active);
  font-weight: 600;
  font-size: 15px;
}

.chief-complaint-label i {
  font-size: 18px;
  background: linear-gradient(135deg, var(--sidebar-active), #0099cc);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.chief-complaint-input {
  width: 100%;
  min-height: 80px;
  padding: 14px;
  border: 2px dashed var(--border);
  border-radius: var(--radius);
  font-size: 14px;
  line-height: 1.5;
  color: var(--text);
  resize: vertical;
  transition: all 0.3s ease;
  background: white;
  font-family: 'Inter', sans-serif;
}

.chief-complaint-input:focus {
  outline: none;
  border-color: var(--sidebar-active);
  border-style: solid;
  box-shadow: 0 0 0 4px rgba(0, 191, 255, 0.1);
}

.chief-complaint-input::placeholder {
  color: var(--text-light);
  font-style: italic;
  opacity: 0.7;
}

.chief-complaint-hint {
  font-size: 11px;
  color: var(--text-light);
  margin-top: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
  padding-left: 4px;
}

.chief-complaint-hint i {
  font-size: 10px;
}

/* FIXED TABLE */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin-top: 12px;
  border-radius: var(--radius);
  overflow: hidden;
  border: 1px solid var(--border);
  font-size: 13px;
}

th {
  background: linear-gradient(135deg, var(--sidebar-active), #0099cc);
  color: #fff;
  font-weight: 600;
  padding: 12px 10px;
  text-align: left;
  border: none;
  font-size: 13px;
}

td {
  padding: 12px 10px;
  border-bottom: 1px solid var(--border-light);
  transition: background 0.2s ease;
  font-size: 13px;
}

tr:last-child td {
  border-bottom: none;
}

.phase-row {
  cursor: pointer;
  transition: all 0.3s ease;
}

.phase-row:hover {
  background: var(--primary-light);
  transform: translateX(3px);
}

.phase-row.selected {
  background: rgba(0,191,255,0.15);
  border-left: 4px solid var(--sidebar-active);
  font-weight: 600;
}

/* ===== NEW: TABBED INTERFACE ===== */
.tabs {
  display: flex;
  gap: 2px;
  margin-bottom: 20px;
  background: var(--border-light);
  border-radius: var(--radius);
  padding: 4px;
}

.tab-btn {
  flex: 1;
  padding: 10px 15px;
  background: transparent;
  border: none;
  cursor: pointer;
  font-weight: 600;
  color: var(--text-light);
  transition: all 0.3s ease;
  border-radius: var(--radius-sm);
  font-size: 13px;
}

.tab-btn.active {
  background: white;
  color: var(--sidebar-active);
  box-shadow: var(--shadow-sm);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== NEW: COMPACT ASSESSMENT SECTION ===== */
.compact-assessment {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.assessment-item {
  background: var(--border-light);
  padding: 12px;
  border-radius: var(--radius-sm);
  border-left: 3px solid var(--sidebar-active);
}

.assessment-item label {
  display: block;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 6px;
  font-size: 12px;
}

/* ===== NEW: PROGRESS INDICATOR ===== */
.progress-container {
  margin: 15px 0;
}

.progress-bar {
  height: 6px;
  background: var(--border);
  border-radius: 3px;
  overflow: hidden;
  margin-bottom: 8px;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--sidebar-active), #0099cc);
  border-radius: 3px;
  transition: width 0.3s ease;
}

.progress-labels {
  display: flex;
  justify-content: space-between;
  font-size: 11px;
  color: var(--text-light);
}

/* ===== WALKTHROUGH ===== */
.tour-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: none;
  z-index: 9998;
  backdrop-filter: blur(4px);
  animation: fadeIn 0.3s ease;
}

.tour-tooltip {
  position: fixed;
  background: #fff;
  max-width: 380px;
  padding: 20px;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  display: none;
  z-index: 9999;
  font-size: 14px;
  line-height: 1.6;
  color: var(--text);
  animation: slideUp 0.4s ease;
  border: 1px solid var(--border);
}

@keyframes slideUp {
  from { transform: translateY(15px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.tour-tooltip::after {
  content: "";
  position: absolute;
  width: 0;
  height: 0;
  border: 10px solid transparent;
  border-bottom-color: #fff;
  top: -20px;
  left: 25px;
}

.tour-header {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 600;
  font-size: 16px;
  margin-bottom: 10px;
  color: var(--text);
}

.tour-header i {
  font-size: 20px;
  color: var(--sidebar-active);
}

.tour-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 15px;
}

.tour-actions button {
  border: none;
  padding: 10px 20px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s ease;
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.tour-progress {
  font-size: 12px;
  color: var(--sidebar-active);
  font-weight: 600;
  margin-bottom: 6px;
  display: flex;
  align-items: center;
  gap: 5px;
}

.tour-progress::before {
  content: 'ðŸ“‹';
  font-size: 11px;
}

.tour-arrow {
  position: fixed;
  width: 0;
  height: 0;
  border-left: 14px solid transparent;
  border-right: 14px solid transparent;
  border-top: 20px solid var(--sidebar-active);
  animation: bounce 1s infinite;
  z-index: 10001;
  display: none;
}

#restartTourBtn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 999;
  background: linear-gradient(135deg, var(--sidebar-active), #0099cc);
  color: #fff;
  border: none;
  padding: 12px 20px;
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 0 8px 25px rgba(0,191,255,0.4);
  font-weight: 600;
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.3s ease;
}

#restartTourBtn:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 12px 30px rgba(0,191,255,0.5);
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 1200px) {
  .grid-optimized {
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }
}

@media (max-width: 900px) {
  .sidebar {
    transform: translateX(-200px);
    position: fixed;
    height: 100vh;
  }
  
  .main {
    margin-left: 0;
    width: 100vw;
    padding: 15px;
  }
  
  .container {
    width: 100%;
    padding: 20px;
    margin: 15px auto;
  }
  
  .grid-optimized {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 600px) {
  .main {
    padding: 12px;
  }
  
  .container {
    padding: 16px 12px;
  }
  
  .container h2 {
    font-size: 20px;
  }
  
  .tab-btn {
    padding: 8px 10px;
    font-size: 11px;
  }
  
  .card {
    padding: 16px;
  }
  
  .grid-optimized {
    gap: 12px;
  }
  
  .chief-complaint-box {
    padding: 15px;
  }
  
  .chief-complaint-input {
    min-height: 70px;
    padding: 12px;
  }
}

/* CUSTOM SCROLLBARS */
.main::-webkit-scrollbar {
  width: 6px;
}

.main::-webkit-scrollbar-track {
  background: var(--border-light);
  border-radius: 4px;
}

.main::-webkit-scrollbar-thumb {
  background: var(--sidebar-active);
  border-radius: 4px;
}

.main::-webkit-scrollbar-thumb:hover {
  background: #0099cc;
}

.sidebar::-webkit-scrollbar {
  width: 4px;
}

.sidebar::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
}

.sidebar::-webkit-scrollbar-thumb {
  background: var(--sidebar-active);
  border-radius: 4px;
}

.patient-list::-webkit-scrollbar {
  width: 4px;
}

.patient-list::-webkit-scrollbar-track {
  background: var(--border-light);
  border-radius: 4px;
}

.patient-list::-webkit-scrollbar-thumb {
  background: var(--sidebar-active);
  border-radius: 4px;
}

/* UTILITY CLASSES */
.mt-10 { margin-top: 10px; }
.mb-10 { margin-bottom: 10px; }
.text-sm { font-size: 12px; }
.text-xs { font-size: 11px; }
.flex-1 { flex: 1; }
.gap-8 { gap: 8px; }

/* STATUS BADGES */
.status-badge {
  padding: 3px 10px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
  display: inline-block;
  text-align: center;
  min-width: 70px;
}

.status-planned { background: #2ecc71; color: white; }
.status-inprogress { background: #f39c12; color: white; }
.status-pending { background: #95a5a6; color: white; }
.status-future { background: #7f8c8d; color: white; }
.status-completed { background: #3498db; color: white; }
</style>
</head>
<body>
<!-- ARROW -->
<div id="tourArrow" class="tour-arrow"></div>

   <div class="dashboard">
    <!-- Sidebar Navigation -->
    <div id="sidebar-container"></div>

<!-- FIXED MAIN CONTENT -->
<div class="main">
<div class="container">
  <button id="restartTourBtn">
    <i class="fas fa-redo"></i> Restart Tutorial
  </button>

  <h2><i class="fas fa-chain"></i> Braces Treatment Plan</h2>

  <!-- PATIENT SELECTION SECTION -->
  <div class="search-box">
    <input id="searchPatient" placeholder="Search patient by name...">
  </div>

  <div class="patient-list">
    <div class="patient-item">Samillano, Kristina Casandra</div>
    <div class="patient-item">Reyes, Juan Miguel</div>
    <div class="patient-item">Dela Cruz, Maria Angela</div>
    <div class="patient-item">Santos, Ana Marie</div>
    <div class="patient-item">Gonzales, Robert James</div>
    <div class="patient-item">Tan, Michelle</div>
  </div>

  <div class="selected-patient">
    <b>Selected Patient:</b> <span id="selectedPatientSpan">None selected</span>
  </div>

  <!-- TREATMENT PROGRESS -->
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" id="treatmentProgress" style="width: 0%"></div>
    </div>
    <div class="progress-labels">
      <span>Not Started</span>
      <span id="progressPercent">0%</span>
      <span>Completed</span>
    </div>
  </div>

  <!-- TABBED INTERFACE -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="treatment">Treatment Plan</button>
    <button class="tab-btn" data-tab="assessment">Assessment</button>
    <button class="tab-btn" data-tab="phases">Treatment Phases</button>
    <button class="tab-btn" data-tab="history">History</button>
  </div>

  <!-- TREATMENT PLAN TAB -->
  <div class="tab-content active" id="treatment-tab">
    <div class="grid-optimized">
      <div class="card">
        <h3><i class="fas fa-ruler-combined"></i> Archwire Sequence</h3>
        <div class="form-group">
          <label><input type="radio" name="archwire" value="initial"> Initial alignment (NiTi)</label>
          <label><input type="radio" name="archwire" value="working"> Working phase (Stainless Steel)</label>
          <label><input type="radio" name="archwire" value="finishing"> Finishing & detailing</label>
          <label><input type="radio" name="archwire" value="retention"> Retention phase</label>
        </div>
        <div class="form-group">
          <label>Custom Notes:</label>
          <input type="text" placeholder="Additional notes...">
        </div>
      </div>

      <div class="card">
        <h3><i class="fas fa-tools"></i> Auxiliaries</h3>
        <div class="form-group">
          <label><input type="checkbox" name="auxiliaries" value="elastics"> Elastics (Interarch)</label>
          <label><input type="checkbox" name="auxiliaries" value="chains"> Power chains</label>
          <label><input type="checkbox" name="auxiliaries" value="coils"> Coil springs</label>
          <label><input type="checkbox" name="auxiliaries" value="turbos"> Bite turbos</label>
          <label><input type="checkbox" name="auxiliaries" value="buttons"> Buttons</label>
          <label><input type="checkbox" name="auxiliaries" value="hooks"> Hooks</label>
        </div>
      </div>

      <div class="card">
        <h3><i class="fas fa-clipboard-check"></i> Treatment Summary</h3>
        <div class="form-group">
          <div class="assessment-item">
            <label>Estimated Duration:</label>
            <input type="text" placeholder="e.g., 18-24 months">
          </div>
          <div class="assessment-item">
            <label>Treatment Complexity:</label>
            <select>
              <option>Simple</option>
              <option>Moderate</option>
              <option>Complex</option>
            </select>
          </div>
        </div>
        <p style="color:var(--text-light);font-size:12px;margin:10px 0;padding:10px;background:var(--border-light);border-radius:var(--radius-sm);">
          No selection yet. Please configure the treatment plan.
        </p>
        <button id="saveTreatmentPlan" class="save-btn">
          <i class="fas fa-save"></i> SAVE TREATMENT PLAN
        </button>
      </div>
    </div>
  </div>

  <!-- ASSESSMENT TAB -->
  <div class="tab-content" id="assessment-tab">
    <div class="card">
      <div class="assessment-header">
        <h3><i class="fas fa-stethoscope"></i> Patient Assessment</h3>
        <div class="assessment-controls">
          <button id="editAssessment" class="btn-outline">
            <i class="fas fa-edit"></i> Edit Assessment
          </button>
          <button id="saveAssessment" class="save-btn" style="display:none;width:auto;padding:8px 20px;">
            <i class="fas fa-check"></i> Save
          </button>
        </div>
      </div>

      <!-- ENHANCED CHIEF COMPLAINT SECTION -->
      <div class="chief-complaint-container">
        <div class="chief-complaint-box">
          <div class="chief-complaint-label">
            <i class="fas fa-comment-medical"></i>
            <span>Chief Complaint</span>
          </div>
          <textarea id="chiefComplaint" class="chief-complaint-input" 
                    placeholder="Describe the patient's main concern... 
                    
Example: 
â€¢ 'Front teeth are crooked and affecting smile'
â€¢ 'Difficulty chewing due to misaligned bite'
â€¢ 'Teeth are crowded and hard to clean'
â€¢ 'Jaw pain when chewing'"
                    disabled></textarea>
          <div class="chief-complaint-hint">
            <i class="fas fa-lightbulb"></i>
            Be specific about symptoms, duration, and patient concerns
          </div>
        </div>
      </div>

      <div class="compact-assessment">
        <div class="form-group">
          <label>Malocclusion Classification</label>
          <select id="malocclusion" disabled>
            <option value="">Select classification</option>
            <option>Class I (Neutroclusion)</option>
            <option>Class II Division 1</option>
            <option>Class II Division 2</option>
            <option>Class III</option>
            <option>Open Bite</option>
            <option>Deep Bite</option>
            <option>Crossbite</option>
          </select>
        </div>

        <div class="form-group">
          <label>Overjet (mm)</label>
          <input type="text" id="overjet" placeholder="e.g., 4mm" disabled>
        </div>

        <div class="form-group">
          <label>Overbite (%)</label>
          <input type="text" id="overbitePercent" placeholder="e.g., 30%" disabled>
        </div>
        
        <div class="form-group">
          <label>Crowding (mm)</label>
          <input type="text" id="crowding" placeholder="e.g., 5mm" disabled>
        </div>
      </div>

      <h4 style="margin: 20px 0 10px 0; font-size: 14px; color: var(--text);">
        <i class="fas fa-check-circle"></i> Clinical Findings
      </h4>
      
      <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:10px;margin-top:15px;">
        <label><input type="checkbox" id="crowdingCB" disabled> Crowding</label>
        <label><input type="checkbox" id="overbiteCB" disabled> Overbite</label>
        <label><input type="checkbox" id="crossbiteCB" disabled> Crossbite</label>
        <label><input type="checkbox" id="spacingCB" disabled> Spacing</label>
        <label><input type="checkbox" id="rotationCB" disabled> Rotation</label>
        <label><input type="checkbox" id="impactionCB" disabled> Impaction</label>
        <label><input type="checkbox" id="missingCB" disabled> Missing Teeth</label>
        <label><input type="checkbox" id="supernumeraryCB" disabled> Supernumerary</label>
      </div>
      
      <div class="form-group" style="margin-top: 20px;">
        <label>Additional Notes</label>
        <textarea id="additionalNotes" rows="3" placeholder="Any additional clinical observations..." disabled></textarea>
      </div>
    </div>
  </div>

  <!-- TREATMENT PHASES TAB -->
  <div class="tab-content" id="phases-tab">
    <div class="card">
      <h3><i class="fas fa-calendar-alt"></i> Treatment Phases & Timeline</h3>
      <table>
        <thead>
          <tr>
            <th>Phase</th>
            <th>Description</th>
            <th>Duration</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr class="phase-row">
            <td><strong>Phase 1</strong></td>
            <td>Initial alignment and leveling</td>
            <td>4â€“6 months</td>
            <td><span class="status-badge status-planned">Planned</span></td>
          </tr>
          <tr class="phase-row">
            <td><strong>Phase 2</strong></td>
            <td>Space closure and canine retraction</td>
            <td>6â€“12 months</td>
            <td><span class="status-badge status-pending">Not Started</span></td>
          </tr>
          <tr class="phase-row">
            <td><strong>Phase 3</strong></td>
            <td>Finishing and detailing</td>
            <td>3â€“6 months</td>
            <td><span class="status-badge status-future">Pending</span></td>
          </tr>
          <tr class="phase-row">
            <td><strong>Phase 4</strong></td>
            <td>Retention</td>
            <td>12â€“24 months</td>
            <td><span class="status-badge status-future">Future</span></td>
          </tr>
        </tbody>
      </table>
      <div style="display: flex; gap: 10px; margin-top: 15px;">
        <button id="addPhase" class="btn-outline">
          <i class="fas fa-plus"></i> Add Phase
        </button>
        <button id="savePhases" class="save-btn" style="margin-top:0;flex:1;">
          <i class="fas fa-calendar-check"></i> SAVE PHASES
        </button>
      </div>
    </div>
  </div>

  <!-- HISTORY TAB -->
  <div class="tab-content" id="history-tab">
    <div class="card">
      <h3><i class="fas fa-history"></i> Treatment History</h3>
      <div style="max-height: 300px; overflow-y: auto;">
        <div class="history-item" style="padding:10px;border-bottom:1px solid var(--border-light);">
          <div style="display:flex;justify-content:space-between;">
            <strong>Initial Assessment</strong>
            <span class="text-xs" style="color:var(--text-light);">2024-01-15</span>
          </div>
          <p class="text-sm">Complete dental evaluation performed. Malocclusion Class II diagnosed.</p>
        </div>
        <div class="history-item" style="padding:10px;border-bottom:1px solid var(--border-light);">
          <div style="display:flex;justify-content:space-between;">
            <strong>Impressions Taken</strong>
            <span class="text-xs" style="color:var(--text-light);">2024-01-22</span>
          </div>
          <p class="text-sm">Upper and lower impressions completed for study models.</p>
        </div>
        <div class="history-item" style="padding:10px;">
          <div style="display:flex;justify-content:space-between;">
            <strong>Treatment Plan Finalized</strong>
            <span class="text-xs" style="color:var(--text-light);">2024-01-29</span>
          </div>
          <p class="text-sm">18-month treatment plan approved by patient.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- TUTORIAL OVERLAYS -->
  <div id="tourOverlay" class="tour-overlay"></div>
  <div id="tourTooltip" class="tour-tooltip"></div>

</div>
</div>

<script>
let selectedPatient = "";
let treatmentProgress = 0;

/* ENHANCED SEARCH */
const searchInput = document.getElementById("searchPatient");
const patientItems = document.querySelectorAll(".patient-item");

searchInput.addEventListener("input", () => {
  const searchTerm = searchInput.value.toLowerCase();
  patientItems.forEach(p => {
    const text = p.textContent.toLowerCase();
    p.style.display = text.includes(searchTerm) ? "flex" : "none";
  });
});

/* PATIENT SELECTION */
patientItems.forEach(p => {
  p.addEventListener("click", () => {
    patientItems.forEach(x => x.classList.remove("selected"));
    p.classList.add("selected");
    selectedPatient = p.textContent;
    
    const patientSpan = document.getElementById("selectedPatientSpan");
    patientSpan.textContent = selectedPatient;
    patientSpan.style.animation = "none";
    setTimeout(() => {
      patientSpan.style.animation = "pulse 0.5s ease";
    }, 10);
    
    // Update summary
    const summaryCard = document.querySelector("#treatment-tab .card:nth-child(3) p");
    summaryCard.innerHTML = `<strong>${selectedPatient}</strong><br>Treatment plan ready for configuration.`;
    summaryCard.style.color = "var(--text)";
    
    // Update progress
    updateTreatmentProgress();
  });
});

/* TABBED INTERFACE */
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    // Remove active class from all tabs
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    // Add active class to clicked tab
    this.classList.add('active');
    const tabId = this.getAttribute('data-tab');
    document.getElementById(`${tabId}-tab`).classList.add('active');
  });
});
// Dropdown functionality
  function toggleDropdown(event) {
    event.preventDefault();
    event.stopPropagation();
    
    const dropdown = event.currentTarget.closest('.dropdown');
    const isActive = dropdown.classList.contains('active');
    
    // Close all other dropdowns
    document.querySelectorAll('.dropdown.active').forEach(item => {
      if (item !== dropdown) {
        item.classList.remove('active');
      }
    });
    
    // Toggle current dropdown
    dropdown.classList.toggle('active', !isActive);
  }

  // Close dropdowns when clicking outside
  document.addEventListener('click', function(event) {
    if (!event.target.closest('.dropdown')) {
      document.querySelectorAll('.dropdown.active').forEach(item => {
        item.classList.remove('active');
      });
    }
  });

/* ENHANCED ASSESSMENT EDITING */
document.getElementById("editAssessment").addEventListener("click", () => {
  // Enable all assessment fields
  const fields = ["chiefComplaint", "malocclusion", "overjet", "overbitePercent", "crowding", 
                  "crowdingCB", "overbiteCB", "crossbiteCB", "spacingCB", "rotationCB", 
                  "impactionCB", "missingCB", "supernumeraryCB", "additionalNotes"];
  
  fields.forEach(id => {
    const field = document.getElementById(id);
    if (field) {
      field.disabled = false;
      field.style.backgroundColor = "#fff";
      if (field.tagName === 'TEXTAREA') {
        field.style.borderColor = "var(--sidebar-active)";
      }
    }
  });
  
  // Update UI
  document.getElementById("editAssessment").style.display = "none";
  document.getElementById("saveAssessment").style.display = "flex";
  
  // Focus on chief complaint
  document.getElementById("chiefComplaint").focus();
});

document.getElementById("saveAssessment").addEventListener("click", () => {
  // Validate required fields
  const chiefComplaint = document.getElementById("chiefComplaint").value.trim();
  if (!chiefComplaint) {
    showNotification("Please enter the chief complaint before saving!", "warning");
    document.getElementById("chiefComplaint").focus();
    return;
  }
  
  // Save data (in real app, this would be an API call)
  const assessmentData = {
    patient: selectedPatient,
    chiefComplaint: chiefComplaint,
    malocclusion: document.getElementById("malocclusion").value,
    overjet: document.getElementById("overjet").value,
    overbitePercent: document.getElementById("overbitePercent").value,
    crowding: document.getElementById("crowding").value,
    findings: {
      crowding: document.getElementById("crowdingCB").checked,
      overbite: document.getElementById("overbiteCB").checked,
      crossbite: document.getElementById("crossbiteCB").checked,
      spacing: document.getElementById("spacingCB").checked,
      rotation: document.getElementById("rotationCB").checked,
      impaction: document.getElementById("impactionCB").checked,
      missing: document.getElementById("missingCB").checked,
      supernumerary: document.getElementById("supernumeraryCB").checked
    },
    additionalNotes: document.getElementById("additionalNotes").value,
    timestamp: new Date().toISOString()
  };
  
  // Save to localStorage for demo
  localStorage.setItem(`assessment_${selectedPatient}`, JSON.stringify(assessmentData));
  
  showNotification("Assessment saved successfully!");
  
  // Disable fields after saving
  const fields = ["chiefComplaint", "malocclusion", "overjet", "overbitePercent", "crowding", 
                  "crowdingCB", "overbiteCB", "crossbiteCB", "spacingCB", "rotationCB", 
                  "impactionCB", "missingCB", "supernumeraryCB", "additionalNotes"];
  
  fields.forEach(id => {
    const field = document.getElementById(id);
    if (field) {
      field.disabled = true;
      field.style.backgroundColor = "#f8fafc";
      if (field.tagName === 'TEXTAREA') {
        field.style.borderColor = "var(--border)";
      }
    }
  });
  
  // Update UI
  document.getElementById("editAssessment").style.display = "inline-flex";
  document.getElementById("saveAssessment").style.display = "none";
  
  updateTreatmentProgress();
});

/* LOAD SAVED ASSESSMENT DATA */
function loadAssessmentData() {
  if (selectedPatient) {
    const savedData = localStorage.getItem(`assessment_${selectedPatient}`);
    if (savedData) {
      const data = JSON.parse(savedData);
      
      // Populate fields
      document.getElementById("chiefComplaint").value = data.chiefComplaint || "";
      document.getElementById("malocclusion").value = data.malocclusion || "";
      document.getElementById("overjet").value = data.overjet || "";
      document.getElementById("overbitePercent").value = data.overbitePercent || "";
      document.getElementById("crowding").value = data.crowding || "";
      document.getElementById("additionalNotes").value = data.additionalNotes || "";
      
      // Check checkboxes
      if (data.findings) {
        document.getElementById("crowdingCB").checked = data.findings.crowding || false;
        document.getElementById("overbiteCB").checked = data.findings.overbite || false;
        document.getElementById("crossbiteCB").checked = data.findings.crossbite || false;
        document.getElementById("spacingCB").checked = data.findings.spacing || false;
        document.getElementById("rotationCB").checked = data.findings.rotation || false;
        document.getElementById("impactionCB").checked = data.findings.impaction || false;
        document.getElementById("missingCB").checked = data.findings.missing || false;
        document.getElementById("supernumeraryCB").checked = data.findings.supernumerary || false;
      }
    }
  }
}

/* PHASE SELECTION */
document.querySelectorAll(".phase-row").forEach(r => {
  r.addEventListener("click", () => {
    r.classList.toggle("selected");
  });
});

document.getElementById("addPhase").addEventListener("click", () => {
  const table = document.querySelector("tbody");
  const newRow = document.createElement("tr");
  newRow.className = "phase-row";
  newRow.innerHTML = `
    <td><strong>Phase ${table.children.length + 1}</strong></td>
    <td><input type="text" placeholder="Description" style="width:100%;padding:4px;border:1px solid var(--border);border-radius:4px;"></td>
    <td><input type="text" placeholder="Duration" style="width:100%;padding:4px;border:1px solid var(--border);border-radius:4px;"></td>
    <td>
      <select style="padding:2px 4px;border-radius:4px;font-size:11px;">
        <option value="planned">Planned</option>
        <option value="inprogress">In Progress</option>
        <option value="completed">Completed</option>
        <option value="pending">Pending</option>
        <option value="future">Future</option>
      </select>
    </td>
  `;
  table.appendChild(newRow);
});

/* SAVE BUTTONS */
document.getElementById("saveTreatmentPlan").addEventListener("click", () => {
  if (!selectedPatient) {
    showNotification("Please select a patient first!", "warning");
    return;
  }
  
  // Check if archwire is selected
  const archwireSelected = document.querySelector('input[name="archwire"]:checked');
  if (!archwireSelected) {
    showNotification("Please select an archwire sequence!", "warning");
    return;
  }
  
  // Save treatment plan data
  const treatmentPlanData = {
    patient: selectedPatient,
    archwire: archwireSelected.value,
    auxiliaries: Array.from(document.querySelectorAll('input[name="auxiliaries"]:checked')).map(cb => cb.value),
    estimatedDuration: document.querySelector('#treatment-tab input[placeholder*="Duration"]').value,
    complexity: document.querySelector('#treatment-tab select').value,
    timestamp: new Date().toISOString()
  };
  
  localStorage.setItem(`treatment_${selectedPatient}`, JSON.stringify(treatmentPlanData));
  
  showNotification(`Treatment plan saved for ${selectedPatient}`);
  updateTreatmentProgress();
});

document.getElementById("savePhases").addEventListener("click", () => {
  const selectedPhases = document.querySelectorAll(".phase-row.selected");
  if (selectedPhases.length === 0) {
    showNotification("Please select at least one treatment phase", "warning");
    return;
  }
  
  // Save phases data
  const phasesData = {
    patient: selectedPatient,
    phases: Array.from(document.querySelectorAll('.phase-row')).map(row => ({
      phase: row.querySelector('td strong').textContent,
      description: row.querySelector('td:nth-child(2)').textContent || row.querySelector('td:nth-child(2) input').value,
      duration: row.querySelector('td:nth-child(3)').textContent || row.querySelector('td:nth-child(3) input').value,
      status: row.querySelector('td:nth-child(4) .status-badge')?.textContent || row.querySelector('td:nth-child(4) select').value
    })),
    timestamp: new Date().toISOString()
  };
  
  localStorage.setItem(`phases_${selectedPatient}`, JSON.stringify(phasesData));
  
  showNotification(`${selectedPhases.length} treatment phases saved`);
  updateTreatmentProgress();
});

/* TREATMENT PROGRESS CALCULATION */
function updateTreatmentProgress() {
  let progress = 0;
  
  // Patient selected (20%)
  if (selectedPatient) progress += 20;
  
  // Archwire selected (20%)
  if (document.querySelector('input[name="archwire"]:checked')) progress += 20;
  
  // Auxiliaries selected (15%)
  if (document.querySelectorAll('input[name="auxiliaries"]:checked').length > 0) progress += 15;
  
  // Chief complaint filled (25%)
  if (document.getElementById("chiefComplaint").value.trim()) progress += 25;
  
  // Phases selected (20%)
  if (document.querySelectorAll(".phase-row.selected").length > 0) progress += 20;
  
  treatmentProgress = Math.min(progress, 100);
  
  // Update UI
  document.getElementById("treatmentProgress").style.width = `${treatmentProgress}%`;
  document.getElementById("progressPercent").textContent = `${treatmentProgress}%`;
  
  // Update progress bar color based on progress
  const progressFill = document.getElementById("treatmentProgress");
  if (treatmentProgress < 30) {
    progressFill.style.background = "linear-gradient(90deg, #ff6b6b, #ff8e8e)";
  } else if (treatmentProgress < 70) {
    progressFill.style.background = "linear-gradient(90deg, #f39c12, #f1c40f)";
  } else {
    progressFill.style.background = "linear-gradient(90deg, var(--sidebar-active), #0099cc)";
  }
}

/* NOTIFICATION FUNCTION */
function showNotification(message, type = "success") {
  const notification = document.createElement("div");
  
  // Set colors based on type
  let bgColor, icon;
  if (type === "success") {
    bgColor = "linear-gradient(135deg, var(--success), #2aa52a)";
    icon = "fa-check-circle";
  } else if (type === "warning") {
    bgColor = "linear-gradient(135deg, #f39c12, #e67e22)";
    icon = "fa-exclamation-triangle";
  } else {
    bgColor = "linear-gradient(135deg, #3498db, #2980b9)";
    icon = "fa-info-circle";
  }
  
  notification.style.cssText = `
    position: fixed;
    top: 30px;
    right: 30px;
    background: ${bgColor};
    color: white;
    padding: 12px 20px;
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg);
    z-index: 10000;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: slideInRight 0.3s ease;
    font-size: 13px;
    max-width: 400px;
  `;
  
  notification.innerHTML = `
    <i class="fas ${icon}"></i>
    <span>${message}</span>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = "slideOutRight 0.3s ease";
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 300);
  }, 3000);
}

// Add animation keyframes
const style = document.createElement("style");
style.textContent = `
  @keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  @keyframes slideOutRight {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }
`;
document.head.appendChild(style);

/* FORM INTERACTIONS */
document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
  input.addEventListener("change", function() {
    const label = this.closest("label");
    if (this.checked) {
      label.style.background = "var(--primary-light)";
      label.style.color = "var(--sidebar-active)";
      label.style.fontWeight = "600";
    } else {
      label.style.background = "";
      label.style.color = "";
      label.style.fontWeight = "";
    }
    updateTreatmentProgress();
  });
});

// Load assessment data when patient is selected
patientItems.forEach(p => {
  p.addEventListener("click", () => {
    setTimeout(loadAssessmentData, 100);
  });
});

/* =========================
   ENHANCED WALKTHROUGH
========================= */
const steps = [
  {
    el: ".search-box",
    title: "ðŸ” Search Patient",
    text: "Quickly find patients by typing their name. The list filters instantly."
  },
  {
    el: ".chief-complaint-container",
    title: "ðŸ’¬ Chief Complaint",
    text: "Describe the patient's main concerns in detail. Be specific about symptoms and duration."
  },
  {
    el: ".tabs",
    title: "ðŸ“‹ Tab Navigation",
    text: "Switch between Treatment Plan, Assessment, Phases, and History tabs."
  },
  {
    el: "#treatment-tab",
    title: "ðŸ¦· Treatment Configuration",
    text: "Configure archwire sequence and select required auxiliaries."
  },
  {
    el: "#assessment-tab",
    title: "ðŸ“Š Patient Assessment",
    text: "Edit and save patient assessment details including malocclusion classification."
  },
  {
    el: ".progress-container",
    title: "ðŸ“ˆ Treatment Progress",
    text: "Track treatment completion percentage in real-time."
  },
  {
    el: "#saveTreatmentPlan",
    title: "ðŸ’¾ Save Plan",
    text: "Save the complete treatment plan for the selected patient."
  }
];

let stepIndex = 0;
const overlay = document.getElementById("tourOverlay");
const tooltip = document.getElementById("tourTooltip");
const arrow = document.getElementById("tourArrow");

function showStep() {
  document.querySelectorAll(".tour-highlight")
    .forEach(e => e.classList.remove("tour-highlight"));

  const step = steps[stepIndex];
  const el = document.querySelector(step.el);
  if (!el) return nextStep();

  // Switch to relevant tab if needed
  if (step.el.includes("tab")) {
    const tabBtn = document.querySelector(`.tab-btn[data-tab="${step.el.split('-')[0].replace('#', '')}"]`);
    if (tabBtn) tabBtn.click();
  }

  el.scrollIntoView({ behavior: "smooth", block: "center" });
  el.classList.add("tour-highlight");

  const rect = el.getBoundingClientRect();
  const windowHeight = window.innerHeight;
  const windowWidth = window.innerWidth;

  // Position tooltip
  tooltip.innerHTML = `
    <div class="tour-progress">Step ${stepIndex + 1} of ${steps.length}</div>
    <div class="tour-header">
      <i class="fas fa-lightbulb"></i>
      <span>${step.title}</span>
    </div>
    <p>${step.text}</p>
    <div class="tour-actions">
      <button id="skipTour">
        <i class="fas fa-times"></i> Skip
      </button>
      <button id="nextTour">
        ${stepIndex === steps.length - 1 ? '<i class="fas fa-check"></i> Finish' : 'Next <i class="fas fa-arrow-right"></i>'}
      </button>
    </div>
  `;

  tooltip.style.display = "block";
  
  // Position tooltip intelligently
  if (rect.bottom + tooltip.offsetHeight + 20 > windowHeight) {
    tooltip.style.top = rect.top - tooltip.offsetHeight - 15 + "px";
    tooltip.style.transform = "translateY(0)";
    arrow.style.top = rect.top - 15 + "px";
    arrow.style.transform = "rotate(180deg)";
  } else {
    tooltip.style.top = rect.bottom + 15 + "px";
    tooltip.style.transform = "translateY(0)";
    arrow.style.top = rect.top - 20 + "px";
    arrow.style.transform = "rotate(0deg)";
  }
  
  tooltip.style.left = Math.max(15, Math.min(rect.left, windowWidth - tooltip.offsetWidth - 15)) + "px";
  arrow.style.left = rect.left + rect.width / 2 - 14 + "px";
  arrow.style.display = "block";
  overlay.style.display = "block";

  // Rebind events
  setTimeout(() => {
    document.getElementById("nextTour").onclick = nextStep;
    document.getElementById("skipTour").onclick = endTour;
  }, 10);
}

function nextStep() {
  stepIndex++;
  if (stepIndex >= steps.length) {
    endTour();
  } else {
    showStep();
  }
}

function endTour() {
  overlay.style.display = "none";
  tooltip.style.display = "none";
  arrow.style.display = "none";
  document.querySelectorAll(".tour-highlight")
    .forEach(e => e.classList.remove("tour-highlight"));
  localStorage.setItem("bracesTourDone", "yes");
  showNotification("Tutorial completed! You're ready to use the system.");
}

/* RESTART WALKTHROUGH */
document.getElementById("restartTourBtn").addEventListener("click", () => {
  stepIndex = 0;
  localStorage.removeItem("bracesTourDone");
  
  const btn = document.getElementById("restartTourBtn");
  btn.style.animation = "bounce 0.5s ease";
  setTimeout(() => {
    btn.style.animation = "";
  }, 500);
  
  setTimeout(() => {
    showStep();
  }, 300);
});

/* AUTO RUN (FIRST TIME ONLY) */
window.addEventListener("load", () => {
  if (!localStorage.getItem("bracesTourDone")) {
    setTimeout(() => {
      showStep();
    }, 1000);
  }
  
  // Load any saved data for first patient
  if (patientItems.length > 0) {
    setTimeout(() => {
      patientItems[0].click();
    }, 500);
  }
});

// Initialize progress
updateTreatmentProgress();
</script>
<script type="module">
    import { loadSidebar } from './sidebar/sidebar.js';
    loadSidebar('sidebar-container');
</script>
</body>
</html>