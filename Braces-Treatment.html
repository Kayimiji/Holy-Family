<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Braces Treatment Plan - Optimized UI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --sidebar-bg: #1e293b;
  --sidebar-active: #00bfff;
  --sidebar-hover: rgba(0,191,255,0.1);
  --bg: #eef8fc;
  --card: #ffffff;
  --shadow: 0 4px 20px rgba(0,0,0,0.08);
  --shadow-lg: 0 10px 40px rgba(0,0,0,0.12);
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
  --text: #2c3e50;
  --text-light: #64748b;
  --border: #e5e7eb;
  --border-light: #f1f5f9;
  --success: #32cd32;
  --success-light: rgba(50,205,50,0.1);
  --primary: #00bfff;
  --primary-light: rgba(0,191,255,0.08);
  --radius: 12px;
  --radius-lg: 16px;
  --radius-sm: 8px;
}
:root {
    --statcards-bg: #00bfff98;
    --calendarmodal-bg: #00bfff98;
    --bg-color: #f5f7fa;
    --sidebar-bg: #1e293b;
    --sidebar-text: rgba(255, 255, 255, 0.9);
    --sidebar-active: #00bfff;
    --card-bg: #ffffff;
    --text-color: #2e3b48;
    --text-muted: #7a8ba9;
    --border-color: #e1e5eb;
    --hover-bg: #f0f4f8;
    --today-bg: #e6f7ff;
    --selected-bg: #00bfff;
    --selected-text: white;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    --modal-bg: #ffffff;
    --modal-text: #2c3e50;
    --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    --calendar-day-bg: var(--card-bg);
    --calendar-today-bg: var(--sidebar-active);
    --calendar-today-color: white;
    --calendar-selected-bg: rgba(0, 191, 255, 0.2);
}

.sidebar {
  background-color: var(--sidebar-bg);
  color: var(--sidebar-text);
  padding: 20px 0;
  box-shadow: 2px 0 10px rgba(0,0,0,0.1);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.sidebar-header {
  display: flex;
  align-items: center;
  padding: 20px;
  margin-bottom: 30px;
}

.sidebar-logo {
  width: 90px;
  height: 90px;
  border-radius: 50%;
  object-fit: cover;
}

.sidebar-title h2 {
  margin: 0;
  font-size: 18px;
  text-transform: uppercase;
}

.holy-family,
.dental-clinic {
  color: #00bbff;
  font-weight: bold;
}

.sidebar-menu {
  list-style: none;
  padding: 0;
  margin: 0;
}

.sidebar-menu li {
  margin-bottom: 5px;
}

.sidebar-menu a {
  display: flex;
  align-items: center;
  padding: 12px 20px;
  color: var(--sidebar-text);
  text-decoration: none;
  transition: 0.3s;
}

.sidebar-menu a:hover,
.sidebar-menu a.active {
  background-color: rgba(0,191,255,0.2);
  color: #fff;
  border-left: 3px solid var(--sidebar-active);
}

.sidebar-menu i {
  margin-right: 10px;
  width: 20px;
  text-align: center;
}

/* Dropdown */
.dropdown-toggle {
  justify-content: space-between;
}

.arrow {
  transition: transform 0.3s ease;
}

.dropdown.active .arrow {
  transform: rotate(180deg);
}

.submenu {
  list-style: none;
  padding: 0;
  background: rgba(0,0,0,0.2);
  max-height: 0;
  overflow: hidden;
  transition: all 0.3s ease;
}

.dropdown.active .submenu {
  max-height: 300px;
}

/* Footer */
.sidebar-footer {
  bottom: 20px;
  width: 100%;
  margin-bottom: 40px;
}


* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Inter', sans-serif;
}

html, body {
  height: 100%;
  overflow: hidden;
}

body {
  background: linear-gradient(135deg, #f0f9ff 0%, #eef8fc 100%);
  color: var(--text);
  margin: 0;
  min-height: 100vh;
  overflow: hidden;
}

/* ===== DASHBOARD LAYOUT ===== */
.dashboard {
  display: flex;
  height: 100vh;
  width: 100vw;
  overflow: hidden;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}

/* ===== SIDEBAR ===== */
.sidebar {
  background-color: var(--sidebar-bg);
  color: rgba(255, 255, 255, 0.9);
  padding: 15px 0;
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
  width: 200px;
  overflow-y: auto;
  position: fixed;
  left: 0;
  top: 0;
  bottom: 0;
  z-index: 10;
  height: 100vh;
  flex-shrink: 0;
}

.sidebar-header {
  display: flex;
  align-items: center;
  padding: 15px;
  margin-bottom: 20px;
}

.logo-container {
  position: relative;
}

.sidebar-logo {
  width: 50px;
  height: 50px;
  border-radius: 10px;
  object-fit: cover;
  border: 2px solid var(--sidebar-active);
  margin-right: 12px;
  box-shadow: 0 0 15px rgba(0,191,255,0.3);
}

.logo-glow {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 10px;
  background: radial-gradient(circle at center, transparent 30%, var(--sidebar-active) 100%);
  opacity: 0.3;
  z-index: -1;
}

.sidebar-title h2 {
  color: var(--sidebar-active);
  margin: 0;
  font-size: 16px;
  line-height: 1.2;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.sidebar-title p {
  color: rgba(255, 255, 255, 0.9);
  font-size: 11px;
  margin-top: 4px;
  font-style: italic;
}

.sidebar-menu {
  list-style: none;
  padding: 0;
  margin: 0;
}

.sidebar-menu li {
  margin-bottom: 4px;
}

.sidebar-menu a {
  display: flex;
  align-items: center;
  padding: 10px 15px;
  color: rgba(255, 255, 255, 0.9);
  text-decoration: none;
  transition: all 0.3s ease;
  font-size: 13px;
}

.sidebar-menu a:hover,
.sidebar-menu a.active {
  background-color: rgba(0, 191, 255, 0.2);
  color: white;
  border-left: 3px solid var(--sidebar-active);
  padding-left: 12px;
}

.sidebar-menu i {
  margin-right: 8px;
  width: 16px;
  text-align: center;
  font-size: 14px;
}

/* Dropdown Styles */
.dropdown {
  position: relative;
}

.dropdown-toggle {
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
}

.dropdown-toggle .arrow {
  margin-left: auto;
  font-size: 12px;
  transition: transform 0.3s ease;
}

.dropdown.active .dropdown-toggle .arrow {
  transform: rotate(180deg);
}

.submenu {
  list-style: none;
  padding: 0;
  margin: 0;
  background-color: rgba(0, 0, 0, 0.2);
  border-radius: 0 0 8px 8px;
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  transform: translateY(-10px);
  transition: all 0.3s ease;
  visibility: hidden;
}

.dropdown.active .submenu {
  max-height: 300px;
  opacity: 1;
  transform: translateY(0);
  visibility: visible;
}

.submenu li a {
  padding-left: 40px !important;
  font-size: 12px;
}

.settings-menu {
  margin-top: auto;
}

.logout-btn {
  background-color: rgba(255, 0, 0, 0.1) !important;
}

.logout-btn:hover {
  background-color: rgba(255, 0, 0, 0.2) !important;
  border-left-color: #ff4444 !important;
}

/* ===== MAIN CONTENT ===== */
.main {
  margin-left: 200px;
  padding: 20px;
  min-height: 100vh;
  background: var(--bg);
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
  position: fixed;
  right: 0;
  top: 0;
  bottom: 0;
  width: calc(100vw - 200px);
  overflow-y: auto;
  height: 100vh;
}

.container {
  background: var(--card);
  padding: 30px;
  border-radius: var(--radius-lg);
  max-width: 1400px;
  width: 100%;
  margin: 0 auto 30px auto;
  box-shadow: var(--shadow);
  box-sizing: border-box;
  border: 1px solid rgba(255,255,255,0.9);
  position: relative;
  overflow: visible;
  min-height: calc(100vh - 40px);
}

.container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--sidebar-active), #0099cc);
}

/* ===== BUTTON ENHANCEMENTS ===== */
.btn {
  padding: 10px 20px;
  border-radius: var(--radius);
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: 14px;
  border: none;
  outline: none;
  position: relative;
  overflow: hidden;
}

.btn::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 5px;
  height: 5px;
  background: rgba(255, 255, 255, 0.5);
  opacity: 0;
  border-radius: 100%;
  transform: scale(1, 1) translate(-50%);
  transform-origin: 50% 50%;
}

.btn:active::after {
  animation: ripple 0.6s ease-out;
}

@keyframes ripple {
  0% {
    transform: scale(0, 0);
    opacity: 0.5;
  }
  20% {
    transform: scale(25, 25);
    opacity: 0.3;
  }
  100% {
    opacity: 0;
    transform: scale(40, 40);
  }
}

.btn-outline {
  background: transparent;
  border: 2px solid var(--sidebar-active);
  color: var(--sidebar-active);
  padding: 8px 16px;
  font-size: 13px;
}

.btn-outline:hover {
  background: var(--sidebar-active);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(0, 191, 255, 0.3);
}

.btn-solid {
  background: linear-gradient(135deg, var(--sidebar-active), #0099cc);
  color: white;
  border: none;
  box-shadow: 0 4px 15px rgba(0, 191, 255, 0.3);
}

.btn-solid:hover {
  background: linear-gradient(135deg, #0099cc, #0088bb);
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0, 191, 255, 0.4);
}

.btn-success {
  background: linear-gradient(135deg, var(--success), #2aa52a);
  color: white;
  border: none;
  box-shadow: 0 4px 15px rgba(50, 205, 50, 0.3);
}

.btn-success:hover {
  background: linear-gradient(135deg, #2aa52a, #228b22);
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(50, 205, 50, 0.4);
}

.btn-warning {
  background: linear-gradient(135deg, #f39c12, #e67e22);
  color: white;
  border: none;
  box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
}

.btn-warning:hover {
  background: linear-gradient(135deg, #e67e22, #d35400);
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(243, 156, 18, 0.4);
}

.btn-danger {
  background: linear-gradient(135deg, #ff4444, #cc0000);
  color: white;
  border: none;
  box-shadow: 0 4px 15px rgba(255, 68, 68, 0.3);
}

.btn-danger:hover {
  background: linear-gradient(135deg, #cc0000, #aa0000);
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(255, 68, 68, 0.4);
}

.btn-sm {
  padding: 6px 12px;
  font-size: 12px;
}

.btn-lg {
  padding: 14px 28px;
  font-size: 16px;
}

.btn-full {
  width: 100%;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
  box-shadow: none !important;
}

/* Floating Action Button */
.fab {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--sidebar-active), #0099cc);
  color: white;
  border: none;
  box-shadow: 0 8px 25px rgba(0, 191, 255, 0.4);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  z-index: 1000;
  transition: all 0.3s ease;
}

.fab:hover {
  transform: translateY(-5px) scale(1.1);
  box-shadow: 0 12px 30px rgba(0, 191, 255, 0.5);
}

.fab-menu {
  position: absolute;
  bottom: 70px;
  right: 0;
  background: white;
  border-radius: var(--radius);
  box-shadow: var(--shadow-lg);
  padding: 10px;
  display: none;
  flex-direction: column;
  gap: 5px;
  min-width: 180px;
}

.fab-menu.show {
  display: flex;
  animation: slideUp 0.3s ease;
}

.fab-item {
  padding: 10px 15px;
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  transition: all 0.2s ease;
  text-decoration: none;
  color: var(--text);
}

.fab-item:hover {
  background: var(--primary-light);
  color: var(--sidebar-active);
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ===== HEADER ===== */
.container h2 {
  font-size: 24px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 25px;
  padding-bottom: 12px;
  border-bottom: 2px solid var(--border-light);
  display: flex;
  align-items: center;
  gap: 12px;
}

/* ===== SEARCH BOX ===== */
.search-box {
  background: white;
  padding: 12px 16px;
  border-radius: var(--radius);
  margin-bottom: 20px;
  position: relative;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border);
  transition: all 0.3s ease;
}

.search-box:focus-within {
  border-color: var(--sidebar-active);
  box-shadow: 0 0 0 3px rgba(0,191,255,0.15);
  transform: translateY(-1px);
}

.search-box input {
  width: 100%;
  border: none;
  outline: none;
  font-size: 14px;
  color: var(--text);
  padding-left: 30px;
  background: transparent;
}

.search-box::before {
  content: '\f002';
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--sidebar-active);
  font-size: 14px;
}

/* ===== PATIENT LIST ===== */
.patient-list {
  background: white;
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
  margin-bottom: 20px;
  border: 1px solid var(--border);
  overflow: hidden;
  max-height: 250px;
  overflow-y: auto;
}

.patient-item {
  padding: 14px 16px;
  cursor: pointer;
  border-bottom: 1px solid var(--border-light);
  transition: all 0.25s ease;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 10px;
  position: relative;
}

.patient-item:hover {
  background: linear-gradient(90deg, var(--primary-light), transparent);
  padding-left: 20px;
}

.patient-item.selected {
  background: linear-gradient(90deg, rgba(0,191,255,0.15), transparent);
  font-weight: 600;
  color: var(--sidebar-active);
  border-left: 4px solid var(--sidebar-active);
}

.patient-item::before {
  content: 'ðŸ‘¤';
  font-size: 14px;
  opacity: 0.7;
}

.patient-item .badge {
  margin-left: auto;
  font-size: 10px;
  padding: 2px 8px;
  border-radius: 10px;
  background: var(--primary-light);
  color: var(--sidebar-active);
}

.selected-patient {
  font-size: 15px;
  margin-bottom: 25px;
  padding: 15px;
  background: var(--primary-light);
  border-radius: var(--radius);
  border-left: 4px solid var(--sidebar-active);
  display: flex;
  align-items: center;
  gap: 10px;
  animation: pulse 2s infinite;
}

.selected-patient b {
  color: var(--sidebar-active);
  font-weight: 700;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.8; }
}

/* ===== PROGRESS BAR ===== */
.progress-container {
  margin: 25px 0;
  background: white;
  padding: 20px;
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
}

.progress-bar {
  height: 10px;
  background: var(--border);
  border-radius: 5px;
  overflow: hidden;
  margin-bottom: 12px;
  position: relative;
}

.progress-fill {
  height: 100%;
  border-radius: 5px;
  transition: width 0.5s ease, background 0.5s ease;
  position: relative;
  overflow: hidden;
}

.progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  background-image: linear-gradient(
    45deg,
    rgba(255, 255, 255, 0.15) 25%,
    transparent 25%,
    transparent 50%,
    rgba(255, 255, 255, 0.15) 50%,
    rgba(255, 255, 255, 0.15) 75%,
    transparent 75%,
    transparent
  );
  background-size: 20px 20px;
  animation: progressStripes 1s linear infinite;
}

@keyframes progressStripes {
  from { background-position: 0 0; }
  to { background-position: 20px 0; }
}

.progress-labels {
  display: flex;
  justify-content: space-between;
  font-size: 13px;
  color: var(--text);
  font-weight: 500;
}

#progressPercent {
  font-weight: 700;
  color: var(--sidebar-active);
  font-size: 16px;
}

/* ===== TABS ===== */
.tabs {
  display: flex;
  gap: 2px;
  margin-bottom: 25px;
  background: var(--border-light);
  border-radius: var(--radius);
  padding: 4px;
}

.tab-btn {
  flex: 1;
  padding: 12px 15px;
  background: transparent;
  border: none;
  cursor: pointer;
  font-weight: 600;
  color: var(--text-light);
  transition: all 0.3s ease;
  border-radius: var(--radius-sm);
  font-size: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  position: relative;
  overflow: hidden;
}

.tab-btn::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 0;
  height: 3px;
  background: var(--sidebar-active);
  transition: width 0.3s ease;
}

.tab-btn:hover {
  color: var(--sidebar-active);
  background: rgba(0,191,255,0.05);
}

.tab-btn.active {
  background: white;
  color: var(--sidebar-active);
  box-shadow: var(--shadow-sm);
}

.tab-btn.active::after {
  width: 100%;
}

.tab-content {
  display: none;
  animation: fadeIn 0.4s ease;
}

.tab-content.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== GRID LAYOUT ===== */
.grid-optimized {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 25px;
  margin: 25px 0;
}

.card {
  background: white;
  border-radius: var(--radius-lg);
  padding: 25px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--sidebar-active), transparent);
}

.card h3 {
  border-bottom: 2px solid var(--border-light);
  padding-bottom: 15px;
  margin-bottom: 20px;
  font-size: 16px;
  font-weight: 700;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 10px;
}

.card h3 i {
  color: var(--sidebar-active);
  font-size: 18px;
  width: 24px;
}

/* ===== FORM ELEMENTS ===== */
.form-group {
  margin-bottom: 20px;
}

label {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 8px 0;
  cursor: pointer;
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  transition: all 0.2s ease;
  font-size: 14px;
  position: relative;
}

label:hover {
  background: var(--primary-light);
  transform: translateX(5px);
}

input[type="radio"],
input[type="checkbox"] {
  width: 18px;
  height: 18px;
  accent-color: var(--sidebar-active);
  cursor: pointer;
}

input[type="text"],
select,
textarea {
  width: 100%;
  padding: 12px 15px;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  font-size: 14px;
  transition: all 0.3s ease;
  background: white;
  font-family: 'Inter', sans-serif;
}

input[type="text"]:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: var(--sidebar-active);
  box-shadow: 0 0 0 3px rgba(0,191,255,0.15);
}

/* ===== ENHANCED CHIEF COMPLAINT ===== */
.chief-complaint-container {
  margin-bottom: 25px;
}

.chief-complaint-box {
  background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
  border: 2px solid var(--primary-light);
  border-radius: var(--radius-lg);
  padding: 25px;
  position: relative;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 191, 255, 0.08);
}

.chief-complaint-box:focus-within {
  border-color: var(--sidebar-active);
  box-shadow: 0 6px 20px rgba(0, 191, 255, 0.15);
  transform: translateY(-2px);
}

.chief-complaint-label {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 15px;
  color: var(--sidebar-active);
  font-weight: 700;
  font-size: 16px;
}

.chief-complaint-label i {
  font-size: 20px;
  background: linear-gradient(135deg, var(--sidebar-active), #0099cc);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.chief-complaint-input {
  width: 100%;
  min-height: 120px;
  padding: 15px;
  border: 2px dashed var(--border);
  border-radius: var(--radius);
  font-size: 15px;
  line-height: 1.6;
  color: var(--text);
  resize: vertical;
  transition: all 0.3s ease;
  background: white;
}

.chief-complaint-input:focus {
  outline: none;
  border-color: var(--sidebar-active);
  border-style: solid;
  box-shadow: 0 0 0 4px rgba(0, 191, 255, 0.1);
}

.chief-complaint-hint {
  font-size: 12px;
  color: var(--text-light);
  margin-top: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
  padding-left: 5px;
}

/* ===== ASSESSMENT SECTION ===== */
.compact-assessment {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  margin-top: 25px;
}

.assessment-item {
  background: var(--border-light);
  padding: 15px;
  border-radius: var(--radius-sm);
  border-left: 4px solid var(--sidebar-active);
}

.assessment-item label {
  display: block;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 8px;
  font-size: 13px;
  padding: 0;
}

.assessment-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 2px solid var(--border-light);
}

.assessment-controls {
  display: flex;
  gap: 10px;
}

/* ===== TABLE STYLES ===== */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin-top: 20px;
  border-radius: var(--radius);
  overflow: hidden;
  border: 1px solid var(--border);
  font-size: 14px;
  background: white;
}

th {
  background: linear-gradient(135deg, var(--sidebar-active), #0099cc);
  color: white;
  font-weight: 600;
  padding: 15px;
  text-align: left;
  border: none;
  font-size: 14px;
}

td {
  padding: 15px;
  border-bottom: 1px solid var(--border-light);
  transition: all 0.2s ease;
  font-size: 14px;
}

tr:last-child td {
  border-bottom: none;
}

.phase-row {
  cursor: pointer;
  transition: all 0.3s ease;
}

.phase-row:hover {
  background: var(--primary-light);
  transform: translateX(5px);
}

.phase-row.selected {
  background: rgba(0,191,255,0.15);
  border-left: 4px solid var(--sidebar-active);
  font-weight: 600;
}

/* ===== HISTORY ITEMS ===== */
.history-item {
  padding: 15px;
  border-bottom: 1px solid var(--border-light);
  transition: all 0.2s ease;
}

.history-item:hover {
  background: var(--border-light);
  transform: translateX(5px);
}

.history-item:last-child {
  border-bottom: none;
}

/* ===== STATUS BADGES ===== */
.status-badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  display: inline-block;
  text-align: center;
  min-width: 80px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-planned { background: #2ecc71; color: white; }
.status-inprogress { background: #f39c12; color: white; }
.status-pending { background: #95a5a6; color: white; }
.status-future { background: #7f8c8d; color: white; }
.status-completed { background: #3498db; color: white; }
.status-cancelled { background: #e74c3c; color: white; }

/* ===== TOUR/WALKTHROUGH ===== */
.tour-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: none;
  z-index: 9998;
  backdrop-filter: blur(4px);
  animation: fadeIn 0.3s ease;
}

.tour-tooltip {
  position: fixed;
  background: white;
  max-width: 400px;
  padding: 25px;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  display: none;
  z-index: 9999;
  font-size: 15px;
  line-height: 1.6;
  color: var(--text);
  animation: slideUp 0.4s ease;
  border: 1px solid var(--border);
}

.tour-tooltip::after {
  content: "";
  position: absolute;
  width: 0;
  height: 0;
  border: 12px solid transparent;
  border-bottom-color: white;
  top: -24px;
  left: 30px;
}

.tour-header {
  display: flex;
  align-items: center;
  gap: 12px;
  font-weight: 700;
  font-size: 18px;
  margin-bottom: 15px;
  color: var(--text);
}

.tour-header i {
  font-size: 22px;
  color: var(--sidebar-active);
}

.tour-progress {
  font-size: 13px;
  color: var(--sidebar-active);
  font-weight: 600;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.tour-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 20px;
}

.tour-actions button {
  border: none;
  padding: 12px 24px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s ease;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.tour-highlight {
  position: relative;
  z-index: 10000;
  box-shadow: 0 0 0 4px rgba(0,191,255,0.5), 0 0 30px rgba(0,191,255,0.3) !important;
  animation: pulseHighlight 2s infinite;
}

@keyframes pulseHighlight {
  0%, 100% { box-shadow: 0 0 0 4px rgba(0,191,255,0.5), 0 0 30px rgba(0,191,255,0.3); }
  50% { box-shadow: 0 0 0 4px rgba(0,191,255,0.8), 0 0 40px rgba(0,191,255,0.5); }
}

.tour-arrow {
  position: fixed;
  width: 0;
  height: 0;
  border-left: 16px solid transparent;
  border-right: 16px solid transparent;
  border-top: 24px solid var(--sidebar-active);
  animation: bounce 1s infinite;
  z-index: 10001;
  display: none;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

#restartTourBtn {
  position: fixed;
  bottom: 100px;
  right: 30px;
  z-index: 999;
  background: linear-gradient(135deg, var(--sidebar-active), #0099cc);
  color: white;
  border: none;
  padding: 15px 25px;
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 0 8px 25px rgba(0,191,255,0.4);
  font-weight: 600;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.3s ease;
}

#restartTourBtn:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 12px 30px rgba(0,191,255,0.5);
}

/* ===== NOTIFICATIONS ===== */
.notification {
  position: fixed;
  top: 30px;
  right: 30px;
  padding: 15px 25px;
  border-radius: var(--radius);
  box-shadow: var(--shadow-lg);
  z-index: 10000;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 12px;
  animation: slideInRight 0.3s ease;
  font-size: 14px;
  max-width: 400px;
}

.notification-success {
  background: linear-gradient(135deg, var(--success), #2aa52a);
  color: white;
}

.notification-warning {
  background: linear-gradient(135deg, #f39c12, #e67e22);
  color: white;
}

.notification-error {
  background: linear-gradient(135deg, #ff4444, #cc0000);
  color: white;
}

.notification-info {
  background: linear-gradient(135deg, #3498db, #2980b9);
  color: white;
}

@keyframes slideInRight {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOutRight {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(100%); opacity: 0; }
}

/* ===== FLOATING ACTION MENU ===== */
#fabMenu {
  display: none;
}

#fabMenu.show {
  display: flex;
  flex-direction: column;
  gap: 10px;
  animation: slideUp 0.3s ease;
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 1200px) {
  .grid-optimized {
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  }
}

@media (max-width: 900px) {
  .sidebar {
    transform: translateX(-200px);
    position: fixed;
    height: 100vh;
    z-index: 1000;
  }
  
  .main {
    margin-left: 0;
    width: 100vw;
    padding: 15px;
  }
  
  .container {
    width: 100%;
    padding: 20px;
    margin: 15px auto;
  }
  
  .grid-optimized {
    grid-template-columns: 1fr;
  }
  
  .compact-assessment {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 600px) {
  .main {
    padding: 10px;
  }
  
  .container {
    padding: 15px 10px;
  }
  
  .container h2 {
    font-size: 20px;
  }
  
  .tab-btn {
    padding: 10px;
    font-size: 12px;
  }
  
  .card {
    padding: 20px;
  }
  
  .grid-optimized {
    gap: 15px;
  }
  
  .chief-complaint-box {
    padding: 20px;
  }
  
  .chief-complaint-input {
    min-height: 100px;
    padding: 12px;
  }
  
  .assessment-header {
    flex-direction: column;
    gap: 15px;
    align-items: flex-start;
  }
  
  #restartTourBtn {
    bottom: 80px;
    right: 15px;
    padding: 12px 20px;
    font-size: 13px;
  }
  
  .fab {
    width: 50px;
    height: 50px;
    bottom: 20px;
    right: 20px;
    font-size: 18px;
  }
}

/* ===== CUSTOM SCROLLBARS ===== */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--border-light);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: var(--sidebar-active);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #0099cc;
}

/* ===== UTILITY CLASSES ===== */
.mt-10 { margin-top: 10px; }
.mt-20 { margin-top: 20px; }
.mb-10 { margin-bottom: 10px; }
.mb-20 { margin-bottom: 20px; }
.text-sm { font-size: 13px; }
.text-xs { font-size: 12px; }
.flex-1 { flex: 1; }
.gap-8 { gap: 8px; }
.gap-12 { gap: 12px; }
.hidden { display: none; }
.text-center { text-align: center; }
.flex { display: flex; }
.items-center { align-items: center; }
.justify-between { justify-content: space-between; }
.w-full { width: 100%; }

/* ===== PRINT STYLES ===== */
@media print {
  .sidebar,
  .fab,
  #restartTourBtn,
  .btn-outline,
  .tour-tooltip,
  .tour-overlay {
    display: none !important;
  }
  
  .main {
    margin-left: 0;
    width: 100%;
    padding: 0;
  }
  
  .container {
    box-shadow: none;
    border: 1px solid #ddd;
  }
  
  .card {
    break-inside: avoid;
  }
}
</style>
</head>
<body>
<!-- TOUR ARROW -->
<div id="tourArrow" class="tour-arrow"></div>


   <div class="dashboard">
    <!-- Sidebar Navigation -->
     
    <div id="sidebar-container"></div>
    <aside class="sidebar">
        <div>
            <div class="sidebar-header">
                <div class="logo-container">
                    <img src="logo.png" alt="Clinic Logo" class="sidebar-logo">
                </div>
                <div class="sidebar-title">
                    <h2>
                        <span class="holy-family">SMART</span><br>
                        <span class="dental-clinic">DENTISTRY</span>
                    </h2>
                </div>
            </div>

            <ul class="sidebar-menu">
                <li><a href="admin.html"><i class="fas fa-home"></i>Dashboard</a></li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-action="toggle-dropdown">
                        <i class="fas fa-tooth"></i>
                        <span>My Clinic</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li><a href="clinic-profile.html"><i class="fas fa-hospital"></i>Clinic Profile</a></li>
                        <li><a href="odontogram-prescription.html"><i class="fas fa-tooth"></i>Dental Chart</a></li>
                        <li><a href="Braces-Treatment.html"><i class="fas fa-tooth"></i>Braces Treatment</a></li>
                    </ul>
                </li>

                <li><a href="patients.html"><i class="fas fa-users"></i>Patients</a></li>
                <li><a href="Finance.html"><i class="fas fa-dollar-sign"></i>Finance & Records</a></li>
                <li><a href="Data-Back-Up.html"><i class="fas fa-database"></i>Data Backup</a></li>
            </ul>
        </div>

        <div class="sidebar-footer">
            <ul class="sidebar-menu">
                <li><a href="adminsettings.html"><i class="fas fa-cog"></i>Settings</a></li>
                <li><a href="landingpage.html" data-action="return-home"><i class="fas fa-arrow-left"></i>Return to Home</a>
            </ul>
        </div>
    </aside>


<!-- FLOATING ACTION BUTTON -->
<button class="fab" id="fabButton">
  <i class="fas fa-plus"></i>
</button>

<div id="fabMenu" class="fab-menu">
  <a href="#" class="fab-item" id="fabNewPlan">
    <i class="fas fa-file-medical"></i>
    <span>New Treatment Plan</span>
  </a>
  <a href="#" class="fab-item" id="fabPrint">
    <i class="fas fa-print"></i>
    <span>Print Plan</span>
  </a>
  <a href="#" class="fab-item" id="fabExport">
    <i class="fas fa-file-export"></i>
    <span>Export Data</span>
  </a>
  <a href="#" class="fab-item" id="fabQuickSave">
    <i class="fas fa-save"></i>
    <span>Quick Save</span>
  </a>
</div>



    <!-- MAIN CONTENT -->
    <div class="main">
    <div class="container">
      <button id="restartTourBtn" class="btn-solid">
        <i class="fas fa-redo"></i> Restart Tutorial
      </button>

      <h2><i class="fas fa-chain"></i> Braces Treatment Plan</h2>

      <!-- PATIENT SELECTION SECTION -->
      <div class="search-box">
        <input id="searchPatient" placeholder="Search patient by name...">
      </div>

      <div class="patient-list">
        <div class="patient-item" data-id="1">
          Samillano, Kristina Casandra
          <span class="badge">Active</span>
        </div>
        <div class="patient-item" data-id="2">
          Reyes, Juan Miguel
          <span class="badge">Active</span>
        </div>
        <div class="patient-item" data-id="3">
          Dela Cruz, Maria Angela
          <span class="badge">Completed</span>
        </div>
        <div class="patient-item" data-id="4">
          Santos, Ana Marie
          <span class="badge">New</span>
        </div>
        <div class="patient-item" data-id="5">
          Gonzales, Robert James
          <span class="badge">Active</span>
        </div>
        <div class="patient-item" data-id="6">
          Tan, Michelle
          <span class="badge">Pending</span>
        </div>
      </div>

      <div class="selected-patient">
        <i class="fas fa-user-injured"></i>
        <div>
          <b>Selected Patient:</b> <span id="selectedPatientSpan">None selected</span>
        </div>
      </div>

      <!-- TREATMENT PROGRESS -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="treatmentProgress" style="width: 0%"></div>
        </div>
        <div class="progress-labels">
          <span>Not Started</span>
          <span id="progressPercent">0%</span>
          <span>Completed</span>
        </div>
      </div>

      <!-- TABBED INTERFACE -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="treatment">
          <i class="fas fa-clipboard-list"></i> Treatment Plan
        </button>
        <button class="tab-btn" data-tab="assessment">
          <i class="fas fa-stethoscope"></i> Assessment
        </button>
        <button class="tab-btn" data-tab="phases">
          <i class="fas fa-calendar-alt"></i> Treatment Phases
        </button>
        <button class="tab-btn" data-tab="history">
          <i class="fas fa-history"></i> History
        </button>
      </div>

      <!-- TREATMENT PLAN TAB -->
      <div class="tab-content active" id="treatment-tab">
        <div class="grid-optimized">
          <div class="card">
            <h3><i class="fas fa-ruler-combined"></i> Archwire Sequence</h3>
            <div class="form-group">
              <label><input type="radio" name="archwire" value="initial"> Initial alignment (NiTi)</label>
              <label><input type="radio" name="archwire" value="working"> Working phase (Stainless Steel)</label>
              <label><input type="radio" name="archwire" value="finishing"> Finishing & detailing</label>
              <label><input type="radio" name="archwire" value="retention"> Retention phase</label>
            </div>
            <div class="form-group">
              <label>Custom Notes:</label>
              <input type="text" id="archwireNotes" placeholder="Additional notes...">
            </div>
            <button class="btn-outline w-full mt-10" id="clearArchwire">
              <i class="fas fa-times"></i> Clear Selection
            </button>
          </div>

          <div class="card">
            <h3><i class="fas fa-tools"></i> Auxiliaries</h3>
            <div class="form-group">
              <label><input type="checkbox" name="auxiliaries" value="elastics"> Elastics (Interarch)</label>
              <label><input type="checkbox" name="auxiliaries" value="chains"> Power chains</label>
              <label><input type="checkbox" name="auxiliaries" value="coils"> Coil springs</label>
              <label><input type="checkbox" name="auxiliaries" value="turbos"> Bite turbos</label>
              <label><input type="checkbox" name="auxiliaries" value="buttons"> Buttons</label>
              <label><input type="checkbox" name="auxiliaries" value="hooks"> Hooks</label>
            </div>
            <div class="flex justify-between mt-20">
              <button class="btn-outline" id="selectAllAux">
                <i class="fas fa-check-square"></i> Select All
              </button>
              <button class="btn-outline" id="clearAllAux">
                <i class="fas fa-times-circle"></i> Clear All
              </button>
            </div>
          </div>

          <div class="card">
            <h3><i class="fas fa-clipboard-check"></i> Treatment Summary</h3>
            <div class="form-group">
              <div class="assessment-item">
                <label>Estimated Duration:</label>
                <input type="text" id="estimatedDuration" placeholder="e.g., 18-24 months">
              </div>
              <div class="assessment-item">
                <label>Treatment Complexity:</label>
                <select id="treatmentComplexity">
                  <option value="">Select complexity</option>
                  <option>Simple</option>
                  <option>Moderate</option>
                  <option>Complex</option>
                </select>
              </div>
            </div>
            <div id="summaryText" style="color:var(--text-light);font-size:13px;margin:15px 0;padding:15px;background:var(--border-light);border-radius:var(--radius-sm);">
              <i class="fas fa-info-circle"></i> No selection yet. Please configure the treatment plan.
            </div>
            <div class="flex gap-12 mt-20">
              <button id="resetPlan" class="btn-outline flex-1">
                <i class="fas fa-undo"></i> Reset
              </button>
              <button id="saveTreatmentPlan" class="btn-success flex-1">
                <i class="fas fa-save"></i> SAVE PLAN
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ASSESSMENT TAB -->
      <div class="tab-content" id="assessment-tab">
        <div class="card">
          <div class="assessment-header">
            <h3><i class="fas fa-stethoscope"></i> Patient Assessment</h3>
            <div class="assessment-controls">
              <button id="editAssessment" class="btn-outline">
                <i class="fas fa-edit"></i> Edit Assessment
              </button>
              <button id="cancelAssessment" class="btn-outline" style="display:none;">
                <i class="fas fa-times"></i> Cancel
              </button>
              <button id="saveAssessment" class="btn-success" style="display:none;">
                <i class="fas fa-check"></i> Save Assessment
              </button>
            </div>
          </div>

          <!-- ENHANCED CHIEF COMPLAINT SECTION -->
          <div class="chief-complaint-container">
            <div class="chief-complaint-box">
              <div class="chief-complaint-label">
                <i class="fas fa-comment-medical"></i>
                <span>Chief Complaint</span>
              </div>
              <textarea id="chiefComplaint" class="chief-complaint-input" 
                        placeholder="Describe the patient's main concern... 
                        
Example: 
â€¢ 'Front teeth are crooked and affecting smile'
â€¢ 'Difficulty chewing due to misaligned bite'
â€¢ 'Teeth are crowded and hard to clean'
â€¢ 'Jaw pain when chewing'"
                        disabled></textarea>
              <div class="chief-complaint-hint">
                <i class="fas fa-lightbulb"></i>
                Be specific about symptoms, duration, and patient concerns
              </div>
            </div>
          </div>

          <div class="compact-assessment">
            <div class="form-group">
              <label>Malocclusion Classification</label>
              <select id="malocclusion" disabled>
                <option value="">Select classification</option>
                <option>Class I (Neutroclusion)</option>
                <option>Class II Division 1</option>
                <option>Class II Division 2</option>
                <option>Class III</option>
                <option>Open Bite</option>
                <option>Deep Bite</option>
                <option>Crossbite</option>
              </select>
            </div>

            <div class="form-group">
              <label>Overjet (mm)</label>
              <input type="text" id="overjet" placeholder="e.g., 4mm" disabled>
            </div>

            <div class="form-group">
              <label>Overbite (%)</label>
              <input type="text" id="overbitePercent" placeholder="e.g., 30%" disabled>
            </div>
            
            <div class="form-group">
              <label>Crowding (mm)</label>
              <input type="text" id="crowding" placeholder="e.g., 5mm" disabled>
            </div>
          </div>

          <h4 style="margin: 20px 0 15px 0; font-size: 15px; color: var(--text);">
            <i class="fas fa-check-circle"></i> Clinical Findings
          </h4>
          
          <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(160px, 1fr));gap:12px;margin-top:15px;">
            <label><input type="checkbox" id="crowdingCB" disabled> Crowding</label>
            <label><input type="checkbox" id="overbiteCB" disabled> Overbite</label>
            <label><input type="checkbox" id="crossbiteCB" disabled> Crossbite</label>
            <label><input type="checkbox" id="spacingCB" disabled> Spacing</label>
            <label><input type="checkbox" id="rotationCB" disabled> Rotation</label>
            <label><input type="checkbox" id="impactionCB" disabled> Impaction</label>
            <label><input type="checkbox" id="missingCB" disabled> Missing Teeth</label>
            <label><input type="checkbox" id="supernumeraryCB" disabled> Supernumerary</label>
          </div>
          
          <div class="form-group" style="margin-top: 25px;">
            <label>Additional Notes</label>
            <textarea id="additionalNotes" rows="4" placeholder="Any additional clinical observations..." disabled></textarea>
          </div>
          
          <div class="flex gap-12 mt-20">
            <button id="exportAssessment" class="btn-outline flex-1">
              <i class="fas fa-file-pdf"></i> Export PDF
            </button>
            <button id="printAssessment" class="btn-outline flex-1">
              <i class="fas fa-print"></i> Print
            </button>
          </div>
        </div>
      </div>

      <!-- TREATMENT PHASES TAB -->
      <div class="tab-content" id="phases-tab">
        <div class="card">
          <h3><i class="fas fa-calendar-alt"></i> Treatment Phases & Timeline</h3>
          <table>
            <thead>
              <tr>
                <th>Phase</th>
                <th>Description</th>
                <th>Duration</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="phasesTable">
              <tr class="phase-row" data-phase="1">
                <td><strong>Phase 1</strong></td>
                <td>Initial alignment and leveling</td>
                <td>4â€“6 months</td>
                <td><span class="status-badge status-planned">Planned</span></td>
                <td>
                  <button class="btn-outline btn-sm" onclick="editPhase(1)">
                    <i class="fas fa-edit"></i>
                  </button>
                </td>
              </tr>
              <tr class="phase-row" data-phase="2">
                <td><strong>Phase 2</strong></td>
                <td>Space closure and canine retraction</td>
                <td>6â€“12 months</td>
                <td><span class="status-badge status-pending">Not Started</span></td>
                <td>
                  <button class="btn-outline btn-sm" onclick="editPhase(2)">
                    <i class="fas fa-edit"></i>
                  </button>
                </td>
              </tr>
              <tr class="phase-row" data-phase="3">
                <td><strong>Phase 3</strong></td>
                <td>Finishing and detailing</td>
                <td>3â€“6 months</td>
                <td><span class="status-badge status-future">Pending</span></td>
                <td>
                  <button class="btn-outline btn-sm" onclick="editPhase(3)">
                    <i class="fas fa-edit"></i>
                  </button>
                </td>
              </tr>
              <tr class="phase-row" data-phase="4">
                <td><strong>Phase 4</strong></td>
                <td>Retention</td>
                <td>12â€“24 months</td>
                <td><span class="status-badge status-future">Future</span></td>
                <td>
                  <button class="btn-outline btn-sm" onclick="editPhase(4)">
                    <i class="fas fa-edit"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <div style="display: flex; gap: 12px; margin-top: 20px;">
            <button id="addPhase" class="btn-outline">
              <i class="fas fa-plus"></i> Add Phase
            </button>
            <button id="deletePhase" class="btn-danger">
              <i class="fas fa-trash"></i> Delete Selected
            </button>
            <button id="savePhases" class="btn-success flex-1">
              <i class="fas fa-calendar-check"></i> SAVE PHASES
            </button>
          </div>
        </div>
      </div>

      <!-- HISTORY TAB -->
      <div class="tab-content" id="history-tab">
        <div class="card">
          <h3><i class="fas fa-history"></i> Treatment History</h3>
          <div class="flex gap-12 mb-20">
            <button id="filterAll" class="btn-outline active">
              All Entries
            </button>
            <button id="filterAssessments" class="btn-outline">
              Assessments
            </button>
            <button id="filterVisits" class="btn-outline">
              Visits
            </button>
            <button id="clearHistory" class="btn-outline">
              <i class="fas fa-trash"></i> Clear
            </button>
          </div>
          <div id="historyList" style="max-height: 400px; overflow-y: auto;">
            <div class="history-item">
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <strong>Initial Assessment</strong>
                <span class="text-sm" style="color:var(--text-light);">2024-01-15 10:30 AM</span>
              </div>
              <p class="text-sm mt-10">Complete dental evaluation performed. Malocclusion Class II diagnosed.</p>
              <div class="text-xs mt-10" style="color:var(--sidebar-active);">
                <i class="fas fa-user-md"></i> Dr. Smith
              </div>
            </div>
            <div class="history-item">
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <strong>Impressions Taken</strong>
                <span class="text-sm" style="color:var(--text-light);">2024-01-22 02:15 PM</span>
              </div>
              <p class="text-sm mt-10">Upper and lower impressions completed for study models.</p>
              <div class="text-xs mt-10" style="color:var(--sidebar-active);">
                <i class="fas fa-user-md"></i> Dr. Johnson
              </div>
            </div>
            <div class="history-item">
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <strong>Treatment Plan Finalized</strong>
                <span class="text-sm" style="color:var(--text-light);">2024-01-29 11:00 AM</span>
              </div>
              <p class="text-sm mt-10">18-month treatment plan approved by patient.</p>
              <div class="text-xs mt-10" style="color:var(--sidebar-active);">
                <i class="fas fa-user-md"></i> Dr. Smith
              </div>
            </div>
          </div>
          <button id="exportHistory" class="btn-outline w-full mt-20">
            <i class="fas fa-file-excel"></i> Export History to Excel
          </button>
        </div>
      </div>

      <!-- TUTORIAL OVERLAYS -->
      <div id="tourOverlay" class="tour-overlay"></div>
      <div id="tourTooltip" class="tour-tooltip"></div>
    </div>
  </div>
</div>

<script>
// =========================
// ENHANCED GLOBAL VARIABLES
// =========================
let selectedPatient = "";
let treatmentProgress = 0;
let isAssessmentEditing = false;
let selectedPhases = new Set();

// =========================
// ENHANCED NOTIFICATION SYSTEM
// =========================
function showNotification(message, type = "success", duration = 3000) {
  const notification = document.createElement("div");
  notification.className = `notification notification-${type}`;
  
  let icon;
  switch(type) {
    case "success": icon = "fa-check-circle"; break;
    case "warning": icon = "fa-exclamation-triangle"; break;
    case "error": icon = "fa-times-circle"; break;
    default: icon = "fa-info-circle";
  }
  
  notification.innerHTML = `
    <i class="fas ${icon}"></i>
    <span>${message}</span>
  `;
  
  document.body.appendChild(notification);
  
  // Remove existing notifications
  const existingNotifications = document.querySelectorAll('.notification');
  if (existingNotifications.length > 3) {
    existingNotifications[0].remove();
  }
  
  // Auto remove
  setTimeout(() => {
    notification.style.animation = 'slideOutRight 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, duration);
  
  // Click to dismiss
  notification.addEventListener('click', () => {
    notification.style.animation = 'slideOutRight 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  });
}

// =========================
// PATIENT SELECTION ENHANCED
// =========================
const searchInput = document.getElementById("searchPatient");
const patientItems = document.querySelectorAll(".patient-item");

searchInput.addEventListener("input", () => {
  const searchTerm = searchInput.value.toLowerCase();
  patientItems.forEach(p => {
    const text = p.textContent.toLowerCase();
    p.style.display = text.includes(searchTerm) ? "flex" : "none";
  });
});

patientItems.forEach(p => {
  p.addEventListener("click", () => {
    patientItems.forEach(x => x.classList.remove("selected"));
    p.classList.add("selected");
    selectedPatient = p.textContent.split('\n')[0].trim();
    
    const patientSpan = document.getElementById("selectedPatientSpan");
    patientSpan.textContent = selectedPatient;
    patientSpan.style.color = "var(--sidebar-active)";
    
    // Update summary
    const summaryCard = document.getElementById("summaryText");
    summaryCard.innerHTML = `<i class="fas fa-user-check"></i> Treatment plan for <strong>${selectedPatient}</strong> ready for configuration.`;
    summaryCard.style.color = "var(--text)";
    
    // Load saved data
    loadPatientData();
    
    // Update progress
    updateTreatmentProgress();
    
    showNotification(`Patient ${selectedPatient} selected`, "success");
  });
});

// =========================
// TABBED INTERFACE ENHANCED
// =========================
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    this.classList.add('active');
    const tabId = this.getAttribute('data-tab');
    document.getElementById(`${tabId}-tab`).classList.add('active');
    
    // Update URL hash
    window.location.hash = tabId;
    
    showNotification(`${this.textContent.trim()} tab opened`, "info");
  });
});

// Load tab from URL hash
if (window.location.hash) {
  const tabId = window.location.hash.replace('#', '');
  const tabBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
  if (tabBtn) tabBtn.click();
}

/* ===== SIDEBAR DROPDOWN FUNCTIONALITY ===== */

function toggleDropdown(event) {
  event.preventDefault();
  event.stopPropagation();
  
  const dropdown = event.currentTarget.closest('.dropdown');
  const isActive = dropdown.classList.contains('active');
  
  // Close all other dropdowns
  document.querySelectorAll('.dropdown.active').forEach(item => {
    if (item !== dropdown) {
      item.classList.remove('active');
    }
  });
  
  // Toggle current dropdown
  dropdown.classList.toggle('active', !isActive);
}

// Close dropdowns when clicking outside
document.addEventListener('click', function(event) {
  if (!event.target.closest('.dropdown')) {
    document.querySelectorAll('.dropdown.active').forEach(item => {
      item.classList.remove('active');
    });
  }
});

// =========================
// ASSESSMENT FUNCTIONALITY
// =========================
document.getElementById("editAssessment").addEventListener("click", () => {
  isAssessmentEditing = true;
  const fields = ["chiefComplaint", "malocclusion", "overjet", "overbitePercent", "crowding", 
                  "crowdingCB", "overbiteCB", "crossbiteCB", "spacingCB", "rotationCB", 
                  "impactionCB", "missingCB", "supernumeraryCB", "additionalNotes"];
  
  fields.forEach(id => {
    const field = document.getElementById(id);
    if (field) {
      field.disabled = false;
      field.style.backgroundColor = "#fff";
      field.style.borderColor = "var(--sidebar-active)";
    }
  });
  
  document.getElementById("editAssessment").style.display = "none";
  document.getElementById("saveAssessment").style.display = "flex";
  document.getElementById("cancelAssessment").style.display = "flex";
  
  document.getElementById("chiefComplaint").focus();
  
  showNotification("Assessment editing enabled", "info");
});

document.getElementById("cancelAssessment").addEventListener("click", () => {
  isAssessmentEditing = false;
  disableAssessmentFields();
  loadPatientData();
  
  document.getElementById("editAssessment").style.display = "flex";
  document.getElementById("saveAssessment").style.display = "none";
  document.getElementById("cancelAssessment").style.display = "none";
  
  showNotification("Editing cancelled", "warning");
});

document.getElementById("saveAssessment").addEventListener("click", () => {
  const chiefComplaint = document.getElementById("chiefComplaint").value.trim();
  if (!chiefComplaint) {
    showNotification("Please enter the chief complaint before saving!", "warning");
    document.getElementById("chiefComplaint").focus();
    return;
  }
  
  const assessmentData = {
    patient: selectedPatient,
    chiefComplaint: chiefComplaint,
    malocclusion: document.getElementById("malocclusion").value,
    overjet: document.getElementById("overjet").value,
    overbitePercent: document.getElementById("overbitePercent").value,
    crowding: document.getElementById("crowding").value,
    findings: {
      crowding: document.getElementById("crowdingCB").checked,
      overbite: document.getElementById("overbiteCB").checked,
      crossbite: document.getElementById("crossbiteCB").checked,
      spacing: document.getElementById("spacingCB").checked,
      rotation: document.getElementById("rotationCB").checked,
      impaction: document.getElementById("impactionCB").checked,
      missing: document.getElementById("missingCB").checked,
      supernumerary: document.getElementById("supernumeraryCB").checked
    },
    additionalNotes: document.getElementById("additionalNotes").value,
    timestamp: new Date().toISOString()
  };
  
  localStorage.setItem(`assessment_${selectedPatient}`, JSON.stringify(assessmentData));
  
  // Add to history
  addHistoryEntry("Assessment Updated", `Patient assessment saved for ${selectedPatient}`);
  
  showNotification("Assessment saved successfully!", "success");
  
  isAssessmentEditing = false;
  disableAssessmentFields();
  
  document.getElementById("editAssessment").style.display = "flex";
  document.getElementById("saveAssessment").style.display = "none";
  document.getElementById("cancelAssessment").style.display = "none";
  
  updateTreatmentProgress();
});

function disableAssessmentFields() {
  const fields = ["chiefComplaint", "malocclusion", "overjet", "overbitePercent", "crowding", 
                  "crowdingCB", "overbiteCB", "crossbiteCB", "spacingCB", "rotationCB", 
                  "impactionCB", "missingCB", "supernumeraryCB", "additionalNotes"];
  
  fields.forEach(id => {
    const field = document.getElementById(id);
    if (field) {
      field.disabled = true;
      field.style.backgroundColor = "#f8fafc";
      field.style.borderColor = "var(--border)";
    }
  });
}

// =========================
// TREATMENT PLAN FUNCTIONALITY
// =========================
document.getElementById("clearArchwire").addEventListener("click", () => {
  document.querySelectorAll('input[name="archwire"]').forEach(radio => {
    radio.checked = false;
    radio.dispatchEvent(new Event('change'));
  });
  document.getElementById("archwireNotes").value = "";
  showNotification("Archwire selection cleared", "info");
});

document.getElementById("selectAllAux").addEventListener("click", () => {
  document.querySelectorAll('input[name="auxiliaries"]').forEach(cb => {
    cb.checked = true;
    cb.dispatchEvent(new Event('change'));
  });
  showNotification("All auxiliaries selected", "success");
});

document.getElementById("clearAllAux").addEventListener("click", () => {
  document.querySelectorAll('input[name="auxiliaries"]').forEach(cb => {
    cb.checked = false;
    cb.dispatchEvent(new Event('change'));
  });
  showNotification("All auxiliaries cleared", "info");
});

document.getElementById("resetPlan").addEventListener("click", () => {
  if (confirm("Are you sure you want to reset the entire treatment plan?")) {
    document.querySelectorAll('input[name="archwire"]').forEach(r => r.checked = false);
    document.querySelectorAll('input[name="auxiliaries"]').forEach(c => c.checked = false);
    document.getElementById("archwireNotes").value = "";
    document.getElementById("estimatedDuration").value = "";
    document.getElementById("treatmentComplexity").value = "";
    
    document.querySelectorAll('input[name="archwire"], input[name="auxiliaries"]').forEach(input => {
      input.dispatchEvent(new Event('change'));
    });
    
    showNotification("Treatment plan reset successfully", "success");
    updateTreatmentProgress();
  }
});

document.getElementById("saveTreatmentPlan").addEventListener("click", () => {
  if (!selectedPatient) {
    showNotification("Please select a patient first!", "warning");
    return;
  }
  
  const archwireSelected = document.querySelector('input[name="archwire"]:checked');
  if (!archwireSelected) {
    showNotification("Please select an archwire sequence!", "warning");
    return;
  }
  
  const treatmentPlanData = {
    patient: selectedPatient,
    archwire: archwireSelected.value,
    archwireNotes: document.getElementById("archwireNotes").value,
    auxiliaries: Array.from(document.querySelectorAll('input[name="auxiliaries"]:checked')).map(cb => cb.value),
    estimatedDuration: document.getElementById("estimatedDuration").value,
    complexity: document.getElementById("treatmentComplexity").value,
    timestamp: new Date().toISOString()
  };
  
  localStorage.setItem(`treatment_${selectedPatient}`, JSON.stringify(treatmentPlanData));
  
  // Update summary
  const summaryText = document.getElementById("summaryText");
  const auxCount = treatmentPlanData.auxiliaries.length;
  summaryText.innerHTML = `
    <i class="fas fa-check-circle" style="color:var(--success);"></i>
    <strong>Treatment Plan Saved!</strong><br>
    <span style="font-size:12px;">
      Archwire: ${treatmentPlanData.archwire}<br>
      Auxiliaries: ${auxCount} selected<br>
      Duration: ${treatmentPlanData.estimatedDuration || 'Not specified'}<br>
      Complexity: ${treatmentPlanData.complexity || 'Not specified'}
    </span>
  `;
  
  addHistoryEntry("Treatment Plan Saved", `Treatment plan configured for ${selectedPatient}`);
  
  showNotification(`Treatment plan saved for ${selectedPatient}`, "success");
  updateTreatmentProgress();
});

// =========================
// PHASES FUNCTIONALITY
// =========================
document.querySelectorAll(".phase-row").forEach(row => {
  row.addEventListener("click", (e) => {
    if (!e.target.closest('button')) {
      const phaseNum = row.getAttribute('data-phase');
      if (selectedPhases.has(phaseNum)) {
        selectedPhases.delete(phaseNum);
        row.classList.remove("selected");
      } else {
        selectedPhases.add(phaseNum);
        row.classList.add("selected");
      }
      updateDeleteButtonState();
    }
  });
});

function updateDeleteButtonState() {
  const deleteBtn = document.getElementById("deletePhase");
  deleteBtn.disabled = selectedPhases.size === 0;
  deleteBtn.innerHTML = selectedPhases.size > 0 
    ? `<i class="fas fa-trash"></i> Delete (${selectedPhases.size})`
    : `<i class="fas fa-trash"></i> Delete Selected`;
}

function editPhase(phaseNum) {
  const row = document.querySelector(`.phase-row[data-phase="${phaseNum}"]`);
  const cells = row.querySelectorAll('td');
  
  const oldDesc = cells[1].textContent;
  const oldDuration = cells[2].textContent;
  const oldStatus = cells[3].querySelector('.status-badge').textContent;
  
  const newDesc = prompt("Enter phase description:", oldDesc);
  if (newDesc === null) return;
  
  const newDuration = prompt("Enter duration:", oldDuration);
  if (newDuration === null) return;
  
  const newStatus = prompt("Enter status (planned/inprogress/completed/pending/future):", oldStatus.toLowerCase());
  if (newStatus === null) return;
  
  cells[1].textContent = newDesc;
  cells[2].textContent = newDuration;
  
  const statusMap = {
    'planned': 'status-planned',
    'inprogress': 'status-inprogress',
    'completed': 'status-completed',
    'pending': 'status-pending',
    'future': 'status-future'
  };
  
  const statusClass = statusMap[newStatus.toLowerCase()] || 'status-pending';
  cells[3].innerHTML = `<span class="status-badge ${statusClass}">${newStatus.charAt(0).toUpperCase() + newStatus.slice(1)}</span>`;
  
  showNotification(`Phase ${phaseNum} updated`, "success");
}

document.getElementById("addPhase").addEventListener("click", () => {
  const table = document.getElementById("phasesTable");
  const newPhaseNum = table.children.length + 1;
  
  const newRow = document.createElement("tr");
  newRow.className = "phase-row";
  newRow.setAttribute('data-phase', newPhaseNum);
  newRow.innerHTML = `
    <td><strong>Phase ${newPhaseNum}</strong></td>
    <td><input type="text" placeholder="Description" style="width:100%;padding:6px;border:1px solid var(--border);border-radius:4px;" value="New phase"></td>
    <td><input type="text" placeholder="Duration" style="width:100%;padding:6px;border:1px solid var(--border);border-radius:4px;" value="TBD"></td>
    <td>
      <select style="padding:4px 8px;border-radius:4px;font-size:12px;">
        <option value="planned">Planned</option>
        <option value="pending" selected>Pending</option>
        <option value="inprogress">In Progress</option>
        <option value="completed">Completed</option>
        <option value="future">Future</option>
      </select>
    </td>
    <td>
      <button class="btn-outline btn-sm" onclick="editPhase(${newPhaseNum})">
        <i class="fas fa-edit"></i>
      </button>
    </td>
  `;
  
  table.appendChild(newRow);
  showNotification(`New phase added`, "success");
});

document.getElementById("deletePhase").addEventListener("click", () => {
  if (selectedPhases.size === 0) {
    showNotification("No phases selected for deletion", "warning");
    return;
  }
  
  if (confirm(`Delete ${selectedPhases.size} selected phase(s)?`)) {
    selectedPhases.forEach(phaseNum => {
      const row = document.querySelector(`.phase-row[data-phase="${phaseNum}"]`);
      if (row) row.remove();
    });
    
    // Renumber remaining phases
    const rows = document.querySelectorAll('#phasesTable .phase-row');
    rows.forEach((row, index) => {
      const newPhaseNum = index + 1;
      row.setAttribute('data-phase', newPhaseNum);
      row.querySelector('td strong').textContent = `Phase ${newPhaseNum}`;
      
      const editBtn = row.querySelector('button[onclick]');
      if (editBtn) {
        editBtn.setAttribute('onclick', `editPhase(${newPhaseNum})`);
      }
    });
    
    selectedPhases.clear();
    updateDeleteButtonState();
    showNotification(`${selectedPhases.size} phase(s) deleted`, "success");
  }
});

document.getElementById("savePhases").addEventListener("click", () => {
  const phasesData = {
    patient: selectedPatient,
    phases: Array.from(document.querySelectorAll('.phase-row')).map(row => ({
      phase: row.querySelector('td strong').textContent,
      description: row.querySelector('td:nth-child(2)').textContent || row.querySelector('td:nth-child(2) input').value,
      duration: row.querySelector('td:nth-child(3)').textContent || row.querySelector('td:nth-child(3) input').value,
      status: row.querySelector('td:nth-child(4) .status-badge')?.textContent || 
              row.querySelector('td:nth-child(4) select')?.value || 'pending'
    })),
    timestamp: new Date().toISOString()
  };
  
  localStorage.setItem(`phases_${selectedPatient}`, JSON.stringify(phasesData));
  
  addHistoryEntry("Phases Updated", `Treatment phases saved for ${selectedPatient}`);
  
  showNotification(`${phasesData.phases.length} treatment phases saved`, "success");
  updateTreatmentProgress();
});

// =========================
// HISTORY FUNCTIONALITY
// =========================
document.getElementById("filterAll").addEventListener("click", function() {
  document.querySelectorAll('#historyList .history-item').forEach(item => {
    item.style.display = 'block';
  });
  document.querySelectorAll('#history-tab .btn-outline').forEach(btn => btn.classList.remove('active'));
  this.classList.add('active');
});

document.getElementById("filterAssessments").addEventListener("click", function() {
  document.querySelectorAll('#historyList .history-item').forEach(item => {
    const text = item.textContent.toLowerCase();
    item.style.display = text.includes('assessment') ? 'block' : 'none';
  });
  document.querySelectorAll('#history-tab .btn-outline').forEach(btn => btn.classList.remove('active'));
  this.classList.add('active');
});

document.getElementById("filterVisits").addEventListener("click", function() {
  document.querySelectorAll('#historyList .history-item').forEach(item => {
    const text = item.textContent.toLowerCase();
    item.style.display = (text.includes('visit') || text.includes('impression')) ? 'block' : 'none';
  });
  document.querySelectorAll('#history-tab .btn-outline').forEach(btn => btn.classList.remove('active'));
  this.classList.add('active');
});

document.getElementById("clearHistory").addEventListener("click", () => {
  if (confirm("Clear all history entries?")) {
    localStorage.removeItem(`history_${selectedPatient}`);
    document.getElementById("historyList").innerHTML = `
      <div class="text-center" style="padding: 40px; color: var(--text-light);">
        <i class="fas fa-history fa-2x mb-10"></i>
        <p>No history entries found</p>
      </div>
    `;
    showNotification("History cleared", "success");
  }
});

document.getElementById("exportHistory").addEventListener("click", () => {
  showNotification("Exporting history to Excel...", "info");
  // In a real app, this would generate and download an Excel file
  setTimeout(() => {
    showNotification("History exported successfully!", "success");
  }, 1500);
});

function addHistoryEntry(title, description) {
  if (!selectedPatient) return;
  
  const historyList = document.getElementById("historyList");
  const now = new Date();
  const timeStr = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
  
  const entry = document.createElement("div");
  entry.className = "history-item";
  entry.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <strong>${title}</strong>
      <span class="text-sm" style="color:var(--text-light);">${timeStr}</span>
    </div>
    <p class="text-sm mt-10">${description}</p>
    <div class="text-xs mt-10" style="color:var(--sidebar-active);">
      <i class="fas fa-user-md"></i> System Auto-save
    </div>
  `;
  
  historyList.insertBefore(entry, historyList.firstChild);
  
  // Save to localStorage
  const history = JSON.parse(localStorage.getItem(`history_${selectedPatient}`) || '[]');
  history.unshift({
    title,
    description,
    timestamp: now.toISOString(),
    type: 'system'
  });
  
  // Keep only last 50 entries
  if (history.length > 50) history.length = 50;
  localStorage.setItem(`history_${selectedPatient}`, JSON.stringify(history));
}

// =========================
// FLOATING ACTION BUTTON
// =========================
const fabButton = document.getElementById("fabButton");
const fabMenu = document.getElementById("fabMenu");

fabButton.addEventListener("click", (e) => {
  e.stopPropagation();
  fabMenu.classList.toggle("show");
});

document.addEventListener("click", () => {
  fabMenu.classList.remove("show");
});

fabMenu.addEventListener("click", (e) => {
  e.stopPropagation();
});

document.getElementById("fabNewPlan").addEventListener("click", () => {
  if (confirm("Create a new treatment plan? Current unsaved changes will be lost.")) {
    location.reload();
  }
});

document.getElementById("fabPrint").addEventListener("click", () => {
  showNotification("Preparing print preview...", "info");
  setTimeout(() => window.print(), 1000);
});

document.getElementById("fabExport").addEventListener("click", () => {
  showNotification("Exporting treatment plan data...", "info");
  // Export logic would go here
  setTimeout(() => {
    showNotification("Data exported successfully!", "success");
  }, 1500);
});

document.getElementById("fabQuickSave").addEventListener("click", () => {
  // Quick save all data
  if (selectedPatient) {
    const allData = {
      patient: selectedPatient,
      assessment: localStorage.getItem(`assessment_${selectedPatient}`),
      treatment: localStorage.getItem(`treatment_${selectedPatient}`),
      phases: localStorage.getItem(`phases_${selectedPatient}`),
      timestamp: new Date().toISOString()
    };
    
    localStorage.setItem(`backup_${selectedPatient}_${Date.now()}`, JSON.stringify(allData));
    showNotification("Quick save completed!", "success");
  } else {
    showNotification("Select a patient first", "warning");
  }
});

// =========================
// FORM INTERACTIONS
// =========================
document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
  input.addEventListener("change", function() {
    const label = this.closest("label");
    if (this.checked) {
      label.style.background = "var(--primary-light)";
      label.style.color = "var(--sidebar-active)";
      label.style.fontWeight = "600";
      label.style.transform = "translateX(5px)";
    } else {
      label.style.background = "";
      label.style.color = "";
      label.style.fontWeight = "";
      label.style.transform = "";
    }
    updateTreatmentProgress();
  });
});

// Auto-save for text inputs
document.querySelectorAll('input[type="text"], textarea, select').forEach(input => {
  input.addEventListener('change', () => {
    if (selectedPatient && !input.id.includes('search')) {
      // Debounce auto-save
      clearTimeout(input._timer);
      input._timer = setTimeout(() => {
        updateTreatmentProgress();
      }, 1000);
    }
  });
});

// =========================
// DATA LOADING
// =========================
function loadPatientData() {
  if (!selectedPatient) return;
  
  // Load assessment
  const savedAssessment = localStorage.getItem(`assessment_${selectedPatient}`);
  if (savedAssessment) {
    const data = JSON.parse(savedAssessment);
    document.getElementById("chiefComplaint").value = data.chiefComplaint || "";
    document.getElementById("malocclusion").value = data.malocclusion || "";
    document.getElementById("overjet").value = data.overjet || "";
    document.getElementById("overbitePercent").value = data.overbitePercent || "";
    document.getElementById("crowding").value = data.crowding || "";
    document.getElementById("additionalNotes").value = data.additionalNotes || "";
    
    if (data.findings) {
      document.getElementById("crowdingCB").checked = data.findings.crowding || false;
      document.getElementById("overbiteCB").checked = data.findings.overbite || false;
      document.getElementById("crossbiteCB").checked = data.findings.crossbite || false;
      document.getElementById("spacingCB").checked = data.findings.spacing || false;
      document.getElementById("rotationCB").checked = data.findings.rotation || false;
      document.getElementById("impactionCB").checked = data.findings.impaction || false;
      document.getElementById("missingCB").checked = data.findings.missing || false;
      document.getElementById("supernumeraryCB").checked = data.findings.supernumerary || false;
    }
  }
  
  // Load treatment plan
  const savedTreatment = localStorage.getItem(`treatment_${selectedPatient}`);
  if (savedTreatment) {
    const data = JSON.parse(savedTreatment);
    
    // Set archwire
    if (data.archwire) {
      document.querySelector(`input[name="archwire"][value="${data.archwire}"]`).checked = true;
    }
    document.getElementById("archwireNotes").value = data.archwireNotes || "";
    
    // Set auxiliaries
    if (data.auxiliaries) {
      data.auxiliaries.forEach(value => {
        const checkbox = document.querySelector(`input[name="auxiliaries"][value="${value}"]`);
        if (checkbox) checkbox.checked = true;
      });
    }
    
    document.getElementById("estimatedDuration").value = data.estimatedDuration || "";
    document.getElementById("treatmentComplexity").value = data.complexity || "";
    
    // Update summary
    const summaryText = document.getElementById("summaryText");
    const auxCount = data.auxiliaries ? data.auxiliaries.length : 0;
    summaryText.innerHTML = `
      <i class="fas fa-file-medical-alt" style="color:var(--sidebar-active);"></i>
      <strong>Loaded Treatment Plan</strong><br>
      <span style="font-size:12px;">
        ${data.archwire ? 'Archwire: ' + data.archwire + '<br>' : ''}
        ${auxCount > 0 ? 'Auxiliaries: ' + auxCount + ' selected<br>' : ''}
        ${data.estimatedDuration ? 'Duration: ' + data.estimatedDuration + '<br>' : ''}
        ${data.complexity ? 'Complexity: ' + data.complexity : ''}
      </span>
    `;
  }
  
  // Load phases
  const savedPhases = localStorage.getItem(`phases_${selectedPatient}`);
  if (savedPhases) {
    // Could implement phase loading here
  }
  
  // Load history
  const savedHistory = localStorage.getItem(`history_${selectedPatient}`);
  if (savedHistory) {
    const history = JSON.parse(savedHistory);
    const historyList = document.getElementById("historyList");
    historyList.innerHTML = '';
    
    history.forEach(entry => {
      const entryDate = new Date(entry.timestamp);
      const timeStr = entryDate.toLocaleDateString() + ' ' + entryDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      
      const div = document.createElement("div");
      div.className = "history-item";
      div.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <strong>${entry.title}</strong>
          <span class="text-sm" style="color:var(--text-light);">${timeStr}</span>
        </div>
        <p class="text-sm mt-10">${entry.description}</p>
        <div class="text-xs mt-10" style="color:var(--sidebar-active);">
          <i class="fas fa-${entry.type === 'system' ? 'user-md' : 'user'}"></i>
          ${entry.type === 'system' ? 'System Auto-save' : 'User'}
        </div>
      `;
      historyList.appendChild(div);
    });
  }
}

// =========================
// PROGRESS CALCULATION
// =========================
function updateTreatmentProgress() {
  if (!selectedPatient) {
    treatmentProgress = 0;
  } else {
    let progress = 0;
    
    // Patient selected (10%)
    progress += 10;
    
    // Archwire selected (20%)
    if (document.querySelector('input[name="archwire"]:checked')) progress += 20;
    
    // Auxiliaries selected (15%)
    const auxSelected = document.querySelectorAll('input[name="auxiliaries"]:checked').length;
    if (auxSelected > 0) progress += Math.min(15, auxSelected * 3);
    
    // Chief complaint filled (25%)
    if (document.getElementById("chiefComplaint").value.trim()) progress += 25;
    
    // Assessment fields filled (20%)
    const assessmentFields = ["malocclusion", "overjet", "overbitePercent", "crowding"];
    const filledFields = assessmentFields.filter(id => document.getElementById(id).value.trim()).length;
    progress += (filledFields / assessmentFields.length) * 20;
    
    // Phases configured (10%)
    if (document.querySelectorAll(".phase-row").length > 0) progress += 10;
  }
  
  treatmentProgress = Math.min(progress, 100);
  
  // Update UI
  const progressFill = document.getElementById("treatmentProgress");
  progressFill.style.width = `${treatmentProgress}%`;
  document.getElementById("progressPercent").textContent = `${Math.round(treatmentProgress)}%`;
  
  // Update progress bar color
  if (treatmentProgress < 30) {
    progressFill.style.background = "linear-gradient(90deg, #ff6b6b, #ff8e8e)";
  } else if (treatmentProgress < 70) {
    progressFill.style.background = "linear-gradient(90deg, #f39c12, #f1c40f)";
  } else {
    progressFill.style.background = "linear-gradient(90deg, var(--sidebar-active), #0099cc)";
  }
}

// =========================
// ENHANCED WALKTHROUGH
// =========================
const steps = [
  { el: ".search-box", title: "ðŸ” Search Patient", text: "Quickly find patients by typing their name." },
  { el: "#selectedPatientSpan", title: "ðŸ‘¤ Patient Selection", text: "Click any patient to select them for treatment planning." },
  { el: ".tabs", title: "ðŸ“‹ Tab Navigation", text: "Switch between Treatment Plan, Assessment, Phases, and History." },
  { el: "#treatment-tab", title: "ðŸ¦· Treatment Plan", text: "Configure archwire sequence and select auxiliaries." },
  { el: "#assessment-tab", title: "ðŸ“Š Assessment", text: "Edit patient assessment details and clinical findings." },
  { el: ".progress-container", title: "ðŸ“ˆ Progress Tracking", text: "Track treatment completion percentage." },
  { el: "#fabButton", title: "âš¡ Quick Actions", text: "Access quick actions like print, export, and save." }
];

let stepIndex = 0;
const overlay = document.getElementById("tourOverlay");
const tooltip = document.getElementById("tourTooltip");
const arrow = document.getElementById("tourArrow");

function showStep() {
  document.querySelectorAll(".tour-highlight").forEach(e => e.classList.remove("tour-highlight"));
  const step = steps[stepIndex];
  const el = document.querySelector(step.el);
  if (!el) return nextStep();
  
  if (step.el.includes("tab")) {
    const tabBtn = document.querySelector(`.tab-btn[data-tab="${step.el.split('-')[0].replace('#', '')}"]`);
    if (tabBtn) tabBtn.click();
  }
  
  el.scrollIntoView({ behavior: "smooth", block: "center" });
  el.classList.add("tour-highlight");
  
  const rect = el.getBoundingClientRect();
  const windowHeight = window.innerHeight;
  
  tooltip.innerHTML = `
    <div class="tour-progress">Step ${stepIndex + 1} of ${steps.length}</div>
    <div class="tour-header">
      <i class="fas fa-lightbulb"></i>
      <span>${step.title}</span>
    </div>
    <p>${step.text}</p>
    <div class="tour-actions">
      <button id="skipTour" class="btn-outline">
        <i class="fas fa-times"></i> Skip
      </button>
      <button id="nextTour" class="btn-solid">
        ${stepIndex === steps.length - 1 ? 'Finish <i class="fas fa-check"></i>' : 'Next <i class="fas fa-arrow-right"></i>'}
      </button>
    </div>
  `;
  
  tooltip.style.display = "block";
  
  if (rect.bottom + tooltip.offsetHeight + 20 > windowHeight) {
    tooltip.style.top = `${rect.top - tooltip.offsetHeight - 15}px`;
    arrow.style.top = `${rect.top - 15}px`;
    arrow.style.transform = "rotate(180deg)";
  } else {
    tooltip.style.top = `${rect.bottom + 15}px`;
    arrow.style.top = `${rect.bottom - 20}px`;
    arrow.style.transform = "rotate(0deg)";
  }
  
  tooltip.style.left = `${Math.max(15, rect.left)}px`;
  arrow.style.left = `${rect.left + rect.width / 2 - 14}px`;
  arrow.style.display = "block";
  overlay.style.display = "block";
  
  setTimeout(() => {
    document.getElementById("nextTour").onclick = nextStep;
    document.getElementById("skipTour").onclick = endTour;
  }, 10);
}

function nextStep() {
  stepIndex++;
  if (stepIndex >= steps.length) {
    endTour();
  } else {
    showStep();
  }
}

function endTour() {
  overlay.style.display = "none";
  tooltip.style.display = "none";
  arrow.style.display = "none";
  document.querySelectorAll(".tour-highlight").forEach(e => e.classList.remove("tour-highlight"));
  localStorage.setItem("bracesTourDone", "yes");
  showNotification("Tutorial completed! You're ready to use the system.", "success");
}

document.getElementById("restartTourBtn").addEventListener("click", () => {
  stepIndex = 0;
  localStorage.removeItem("bracesTourDone");
  showStep();
  showNotification("Tutorial restarted", "info");
});

// Auto-run tutorial on first visit
window.addEventListener("load", () => {
  if (!localStorage.getItem("bracesTourDone")) {
    setTimeout(() => {
      showStep();
    }, 1500);
  }
  
  // Auto-select first patient
  if (patientItems.length > 0) {
    setTimeout(() => {
      patientItems[0].click();
    }, 1000);
  }
  
  // Initialize progress
  updateTreatmentProgress();
  
  // Add CSS for tour highlights
  const style = document.createElement('style');
  style.textContent = `
    @keyframes pulseHighlight {
      0%, 100% { box-shadow: 0 0 0 4px rgba(0,191,255,0.5), 0 0 30px rgba(0,191,255,0.3); }
      50% { box-shadow: 0 0 0 4px rgba(0,191,255,0.8), 0 0 40px rgba(0,191,255,0.5); }
    }
  `;
  document.head.appendChild(style);
});
attachSidebarEvents(container);
}

function attachSidebarEvents(container) {
  container.addEventListener('click', event => {
    const actionEl = event.target.closest('[data-action]');
    if (!actionEl || !container.contains(actionEl)) return;

    switch (actionEl.dataset.action) {
      case 'toggle-dropdown':
        handleDropdown(event, actionEl);
        break;

      case 'return-home':
        handleReturnHome(event);
        break;
    }
  });
}

function handleDropdown(event, trigger) {
  event.preventDefault();

  const dropdown = trigger.closest('.dropdown');
  const isActive = dropdown.classList.contains('active');

  document.querySelectorAll('.dropdown.active')
    .forEach(d => d.classList.remove('active'));

  dropdown.classList.toggle('active', !isActive);
}

function handleReturnHome(event) {
  event.preventDefault();

  localStorage.removeItem("isLoggedIn");
  localStorage.removeItem("user");
  localStorage.removeItem("role");

  window.location.href = "landingpage.html";
}


</script>
</body>
</html>