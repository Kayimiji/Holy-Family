<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Holy Family Dental Clinic</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">


<style>
        /* ============================================= */
        /* BASE STYLES & VARIABLES */
        /* ============================================= */


        :root {
            --statcards-bg: #00bfff98;
            --calendarmodal-bg: #00bfff98;
            --bg-color: #f5f7fa;
            --sidebar-bg: #2c3e50;
            --sidebar-text: rgba(255, 255, 255, 0.9);
            --sidebar-active: #00bfff;
            --card-bg: #ffffff;
            --text-color: #2e3b48;
            --text-muted: #7a8ba9;
            --border-color: #e1e5eb;
            --hover-bg: #f0f4f8;
            --today-bg: #e6f7ff;
            --selected-bg: #00bfff;
            --selected-text: white;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --modal-bg: #ffffff;
            --modal-text: #2c3e50;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --calendar-day-bg: var(--card-bg);
            --calendar-today-bg: var(--sidebar-active);
            --calendar-today-color: white;
            --calendar-selected-bg: rgba(0, 191, 255, 0.2);
        }


        [data-theme="dark"] {
            --statcards-bg: #004f6998;
            --calendarmodal-bg: #004f6998;
            --bg-color: #1a1a1a;
            --sidebar-bg: #151e25;
            --sidebar-text: rgba(255, 255, 255, 0.85);
            --sidebar-active: #00bfff;
            --card-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --text-muted: #aaa;
            --border-color: #444;
            --hover-bg: #333;
            --today-bg: #003366;
            --selected-bg: #006699;
            --selected-text: white;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            --modal-bg: #2d2d2d;
            --modal-text: #e0e0e0;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            --calendar-day-bg: var(--card-bg);
            --calendar-today-bg: var(--sidebar-active);
            --calendar-today-color: white;
            --calendar-selected-bg: rgba(0, 191, 255, 0.2);
        }


        [data-theme="dark"] .left-container {
            background: linear-gradient(135deg, #1a4a6e 0%, #0d2c4d 100%);
        }


        html, body {
            height: 100%;
            overflow: auto;
        }


        body {
            font-family: 'Inter', Arial, sans-serif;
            margin: 0;
            transition: background-color 0.3s ease;
            background-size: cover;
            background-attachment: fixed;
            background-color: var(--bg-color);
            color: var(--sidebar-text);
        }


        /* ============================================= */
        /* LAYOUT & STRUCTURE */
        /* ============================================= */


        .dashboard {
            display: flex;
            height: 100vh;
            min-height: 100vh;
            overflow: hidden;
            color: var(--text-color);
        }
        .sidebar {
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
        }


        .main-content {
            flex-direction: column;
            padding: 20px;
            display: flex;
            flex: 3;
            transition: background-color 0.3s ease;
        }


        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            margin-top: -20px;
        }


        .return-home-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }


        .return-home-menu li {
            margin-bottom: 5px;
        }


        .return-home-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--sidebar-text);
            text-decoration: none;
            transition: all 0.3s ease;
        }


        .return-home-menu a:hover, .return-home-menu a.active {
            background-color: rgba(0, 191, 255, 0.2);
            color: white;
            border-left: 3px solid var(--sidebar-active);
        }


        .return-home-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        .sidebar-header {
            display: flex;
            align-items: center;
            padding: 20px;
            margin-bottom: 30px;
        }


        .sidebar-logo {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            margin-right: -5px;
            margin-top: -45px;
            margin-left: -20px;
            object-fit: cover;
        }


        .sidebar-title h2 {
            color: var(--sidebar-active);
            margin: 0;
            font-size: 18px;
            line-height: 1;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            white-space: nowrap;
        }


        .sidebar-title p {
            color: var(--sidebar-text);
            font-size: 12px;
            margin-top: 10px;
            margin-left: -40px;
            font-style: italic;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            white-space: normal;
        }


        .holy-family {
            color: #00bbff;
            font-weight: bold;
        }


        .dental-clinic {
            color: #00bbff;
            font-weight: bold;
        }


        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }


        .sidebar-menu li {
            margin-bottom: 5px;
        }


        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--sidebar-text);
            text-decoration: none;
            transition: all 0.3s ease;
        }


        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(0, 191, 255, 0.2);
            color: white;
            border-left: 3px solid var(--sidebar-active);
        }


        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }


        .settings-menu a:hover, .return-home-menu a:hover {
            background-color: rgba(0, 191, 255, 0.2);
            color: white;
            border-left: 3px solid var(--sidebar-active);
            display: block;
            width: 100%;
            padding-right: 25px;
        }


        .btn {
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-flex;
            margin-top: -10px;
            align-items: center;
            gap: 5px;
            font-size: 13px;
            border: none;
        }
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--sidebar-active);
            color: var(--sidebar-active);
        }


        .btn-outline:hover {
            background-color: var(--sidebar-active);
            color: white;
            box-shadow: 0 4px 8px rgba(0, 191, 255, 0.2);
        }


        .theme-toggle {
            display: flex;
            align-items: center;
            margin-left: 20px;
            gap: 10px;
        }


        .theme-toggle-label {
            font-size: 14px;
            color: var(--text-color);
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }


        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }


        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }


        input:checked + .slider {
            background-color: #00bfff;
        }


        input:checked + .slider:before {
            transform: translateX(26px);
        }


        /* left container design */
        .abstract-shapes {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            pointer-events: none;
            overflow: hidden;
        }


        .shape {
            position: absolute;
        }


        .wave-top {
            width: 150px;
            height: 100px;
            background: var(--sidebar-active);
            top: -45px;
            right: -10px;
            border-radius: 0 0 100px 100px;
            transform: rotate(45deg);
        }


        .wave-left {
            width: 200px;
            height: 100px;
            background: #1380d3;
            top: -20px;
            left: -50px;
            border-radius: 100px 100px 0 0;
            transform: rotate(-180deg);
        }


        .wave-right {
            width: 200px;
            height: 100px;
            background: #00c4cc;
            top: 80%;
            right: -90px;
            border-radius: 100px 100px 0 0;
            transform: rotate(380deg);
        }


        .wave-bottom {
            width: 200px;
            height: 100px;
            background: var(--sidebar-active);
            bottom: -50px;
            left: 0;
            border-radius: 100px 100px 0 0;
            transform: rotate(-330deg);
        }


        .left-container{
            flex: 1.5; 
            border-radius: 10px; 
            padding: 20px; 
            box-shadow: var(--shadow); 
            overflow: hidden;
            position: relative;
            background: linear-gradient(135deg, #f5f9fc 0%, #cbe2ee 100%);
        }


        .stat-cards-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-top: 20px;
            max-height: 180px;
            overflow-y: auto;
            padding-right: 10px;
        }


        .stat-cards-container::-webkit-scrollbar {
            width: 5px;
        }


        .stat-cards-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }


        .stat-cards-container::-webkit-scrollbar-thumb {
            background: var(--sidebar-active);
            border-radius: 4px;
        }


        .stat-card {
            background: var(--statcards-bg);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }


        .stat-card:hover {
            transform: translateY(-5px);
        }


        .stat-card h3 {
            font-size: 14px;
            margin: 0;
            color: white;
            opacity: 0.9;
        }


        .stat-card .number {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            color: white;
        }


        .stat-card .icon {
            float: right;
            font-size: 20px;
            color: rgba(255, 255, 255, 0.8);
        }


        /* Enhanced Appointment Requests Table Styles */
        .requests-section {
            padding: 20px;
            border-radius: 12px;
            background: var(--card-bg);
        }


        .requests-section h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: -5px;
            margin-bottom: 15px;
        }


        .requests-section h2 i {
            color: var(--sidebar-active);
        }


        .requests-table-container {
            max-height: 430px;
            overflow-y: auto;
            margin-top: -15px;
        }


        .requests-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }


        .requests-table thead {
            position: sticky;
            top: 0;
            z-index: 1;
            background: var(--card-bg);
        }


        .requests-table th {
            background-color: var(--card-bg);
            padding: 15px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
        }


        .requests-table td {
            padding: 15px;
            vertical-align: middle;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
        }


        .requests-table th:nth-child(1), 
        .requests-table td:nth-child(1) {
            width: 5px;
        }


        .requests-table th:nth-child(2), 
        .requests-table td:nth-child(2) {
            width: 150px;
        }


        .requests-table th:nth-child(3), 
        .requests-table td:nth-child(3) {
            width: 160px;
        }


        .requests-table th:nth-child(4), 
        .requests-table td:nth-child(4) {
            width: 150px;
        }


        .requests-table th:nth-child(5), 
        .requests-table td:nth-child(5) {
            width: 100px;
        }


        .requests-table th:nth-child(6), 
        .requests-table td:nth-child(6) {
            width: 100px;
        }


        .requests-table th:nth-child(7), 
        .requests-table td:nth-child(7) {
            width: 250px; /* INCREASED WIDTH FOR BETTER VISIBILITY */
            text-align: center;
        }


        .requests-table tbody tr:hover {
            background-color: var(--hover-bg);
        }


        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }


        .status-re-schedule {
            background-color: #fff3cd;
            color: #856404;
        }


        .status-accepted {
            background-color: #d4edda;
            color: #155724;
        }


        .status-cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }


        .action-btn {
            padding: 8px 16px; /* INCREASED PADDING FOR BETTER VISIBILITY */
            border-radius: 8px; /* INCREASED BORDER RADIUS */
            border: none;
            cursor: pointer;
            margin-right: 8px;
            font-size: 13px;
            transition: all 0.3s ease;
            font-weight: 600; /* ADDED FONT WEIGHT */
            min-width: 120px; /* MINIMUM WIDTH FOR BETTER VISIBILITY */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* ADDED SHADOW */
        }


        .action-btn:hover {
            transform: translateY(-2px); /* IMPROVED HOVER EFFECT */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }


        .accept-btn {
            background-color: #28a745;
            color: white;
            border: 2px solid #28a745; /* ADDED BORDER */
        }


        .accept-btn:hover {
            background-color: #218838;
            border-color: #218838;
        }


        .reschedule-btn {
            background-color: #ffc107; /* BRIGHT YELLOW COLOR */
            color: #000; /* BLACK TEXT FOR CONTRAST */
            border: 2px solid #ffc107; /* ADDED BORDER */
            font-weight: bold; /* BOLDER TEXT */
        }


        .reschedule-btn:hover {
            background-color: #e0a800;
            color: #000;
            border-color: #e0a800;
        }


        .checkbox-wrapper input[type="checkbox"] {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            cursor: pointer;
        }


        .patient-name {
            margin-left: 10px;
            font-weight: 500;
            color: var(--sidebar-active);
            position: relative;
        }


        .procedure-tag {
            background-color: var(--hover-bg);
            padding: 4px 8px;
            border-radius: 4px;
            margin-left: -10px;
            font-size: 12px;
            position: relative;
        }


        .patient-name:hover::after,
        .procedure-tag:hover::after {
            content: attr(data-full-text);
            position: absolute;
            background: var(--card-bg);
            padding: 5px 10px;
            border-radius: 4px;
            box-shadow: var(--shadow);
            z-index: 1000;
            white-space: nowrap;
            left: 0;
            top: 100%;
        }


        /* CONTAINER HOVER EFFECTS */
        .bottom-left-section {
            display: flex;
            flex-direction: column;
            flex: 2;
            gap: 10px;
            transition: all 0.3s ease;
        }


        .bottom-left-top {
            flex: 1;
            min-height: 0;
            transition: all 0.3s ease;
        }


        .bottom-left-bottom {
            flex: 1;
            min-height: 0;
            transition: all 0.3s ease;
            background: var(--card-bg);
        }


        .bottom-left-top:hover {
            flex: 5;
        }


        .bottom-left-top:hover + .bottom-left-bottom {
            flex: 0.2;
        }


        .bottom-left-bottom:hover {
            flex: 25;
        }


        .bottom-left-bottom:hover + .bottom-left-top {
            flex: 0.2;
        }


        .bottom-left-bottom .requests-table th:nth-child(1),
        .bottom-left-bottom .requests-table td:nth-child(1) {
            width: 10px;
        }


        .bottom-left-bottom .requests-table th:nth-child(2),
        .bottom-left-bottom .requests-table td:nth-child(2) {
            width: 150px;
        }


        .bottom-left-bottom .requests-table th:nth-child(3),
        .bottom-left-bottom .requests-table td:nth-child(3) {
            width: 100px;
        }


        .bottom-left-bottom .requests-table th:nth-child(4),
        .bottom-left-bottom .requests-table td:nth-child(4) {
            width: 100px;
        }


        .bottom-left-bottom .requests-table th:nth-child(5),
        .bottom-left-bottom .requests-table td:nth-child(5) {
            width: 150px;
        }


        .bottom-left-bottom .requests-table th:nth-child(6),
        .bottom-left-bottom .requests-table td:nth-child(6) {
            width: 120px;
        }


        .bottom-left-bottom .requests-table th:nth-child(7),
        .bottom-left-bottom .requests-table td:nth-child(7) {
            width: 250px; /* INCREASED WIDTH */
        }


        .bottom-left-bottom .requests-table-container {
            background: transparent;
        }


        .bottom-left-bottom .requests-table thead {
            background: transparent;
        }


        .bottom-left-bottom .requests-table th {
            background: transparent;
            color: var(--text-color);
        }


        .bottom-left-section .left-container {
            background: var(--card-bg);
        }


        .bottom-left-section .requests-section {
            background: var(--card-bg);
        }


        /* ============================================= */
        /* MEDIA QUERIES FOR RESPONSIVENESS */
        /* ============================================= */


        @media (max-width: 1200px) {
            .container-layout {
                flex-direction: column;
                height: auto;
            }
            .left-container, .right-container {
                flex: 1 1 100%;
            }
            .stat-cards-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }


        @media (max-width: 1024px) {
            .stat-cards-container {
                grid-template-columns: repeat(3, 1fr);
            }
            .container-layout {
                flex-direction: column;
                height: auto;
            }
        }


        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
                height: auto;
            }
            .stat-cards-container {
                grid-template-columns: repeat(2, 1fr);
            }
            .sidebar {
                width: 100%;
                position: relative;
                padding: 10px;
            }
            .sidebar-menu li a {
                font-size: 14px;
                padding: 10px;
            }
            .main-content {
                padding: 10px;
            }
            .bulk-actions {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            .action-btn {
                min-width: 100px;
                padding: 6px 12px;
                font-size: 12px;
            }
        }


        @media (max-width: 600px) {
            .stat-cards-container {
                grid-template-columns: 1fr;
            }
            .requests-table-container, .calendar-grid {
                overflow-x: auto;
            }
            .requests-table, .calendar-grid {
                min-width: 600px;
            }
            .action-btn {
                min-width: 90px;
                padding: 5px 10px;
                font-size: 11px;
            }
        }


        /* Notification Count */
        .notification-count {
            background-color: var(--sidebar-active);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 14px;
            margin-left: 8px;
            display: none;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            animation: bounce 1s ease infinite;
        }


        .notification-count.show {
            display: inline-flex;
        }


        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }


        /* Status badges */
        .status-confirmed {
            background-color: #d4edda;
            color: #155724;
        }


        .status-cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }


        .confirm-btn {
            background-color: #28a745;
            color: white;
        }


        .cancel-btn {
            background-color: #dc3545;
            color: white;
        }


        /* Calendar Styles */
        .calendar-container {
            padding: 0;
            position: relative;
            height: 100%;
        }


        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }


        .calendar-nav {
            display: flex;
            gap: 10px;
        }


        .calendar-nav button {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }


        .calendar-nav button:hover {
            background: var(--hover-bg);
        }


        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }


        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 5px;
            color: var(--text-color);
        }


        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px;
            border-radius: 4px;
            cursor: pointer;
            background: var(--calendar-day-bg);
            border: 1px solid var(--border-color);
            position: relative;
        }


        .calendar-day:hover {
            background: var(--hover-bg);
        }


        .calendar-day.selected {
            background: var(--calendar-today-bg);
            color: var(--calendar-today-color);
        }


        .calendar-day.has-appointments::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 4px;
            height: 4px;
            background: var(--sidebar-active);
            border-radius: 50%;
        }


        .calendar-header h2 {
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            margin: 0;
            padding: 5px 10px;
            border-radius: 6px;
        }


        .calendar-header h2:hover {
            background-color: var(--hover-bg);
        }


        /* Confirmation Modal Styles */
        .confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(3px);
        }


        .confirmation-modal.active {
            opacity: 1;
            pointer-events: auto;
        }


        .confirmation-content {
            background-color: var(--modal-bg);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 450px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease, opacity 0.3s ease;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }


        .confirmation-modal.active .confirmation-content {
            transform: translateY(0);
        }


        .confirmation-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }


        .confirmation-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }


        .accept-icon {
            background-color: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }


        .reject-icon {
            background-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }


        .confirmation-title {
            margin: 0;
            font-size: 1.3rem;
            color: var(--text-color);
            font-weight: 600;
        }


        .confirmation-message {
            margin: 15px 0 20px;
            color: var(--text-muted);
            line-height: 1.5;
        }


        .reason-textarea {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            margin-bottom: 20px;
            min-height: 100px;
            resize: vertical;
            transition: border-color 0.3s ease;
            font-family: 'Inter', Arial, sans-serif;
        }


        .reason-textarea:focus {
            outline: none;
            border-color: var(--sidebar-active);
            box-shadow: 0 0 0 3px rgba(0, 191, 255, 0.2);
        }


        .confirmation-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }


        .confirmation-buttons button {
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }


        .confirm-btn {
            background-color: var(--sidebar-active);
            color: white;
            border: none;
        }


        .confirm-btn:hover {
            background-color: #0099cc;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 191, 255, 0.3);
        }


        .cancel-btn {
            background-color: var(--text-muted);
            color: white;
            border: none;
        }


        .cancel-btn:hover {
            background-color: #6c757d;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(108, 117, 125, 0.3);
        }


        /* Decorative elements */
        .modal-decoration {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            opacity: 0.1;
            z-index: -1;
        }


        .modal-decoration-1 {
            top: -30px;
            right: -30px;
            background: var(--sidebar-active);
        }


        .modal-decoration-2 {
            bottom: -20px;
            left: -20px;
            background: #28a745;
            width: 80px;
            height: 80px;
        }


        .patient-name {
            margin-left: 10px;
            font-weight: 500;
            color: var(--sidebar-active);
            position: relative;
        }


        /* Bulk Actions */
        .bulk-actions {
            display: none;
            position: sticky;
            top: 0;
            background: var(--calendarmodal-bg);
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            z-index: 2;
            box-shadow: var(--shadow);
            align-items: center;
            justify-content: space-between;
        }


        .bulk-actions.show {
            display: flex;
        }


        .bulk-actions .selected-count {
            color: white;
            font-weight: 500;
        }


        .bulk-actions .action-buttons {
            display: flex;
            gap: 10px;
        }


        /* Toast Container */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }


        .toast {
            background: var(--card-bg);
            color: var(--text-color);
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(120%);
            opacity: 0;
            animation: slideIn 0.3s ease forwards;
            border-left: 4px solid var(--sidebar-active);
        }


        .toast.toast-success {
            border-left-color: #28a745;
        }


        .toast.toast-warning {
            border-left-color: #ffc107;
        }


        .toast.toast-error {
            border-left-color: #dc3545;
        }


        @keyframes slideIn {
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }


        @keyframes slideOut {
            to {
                transform: translateX(120%);
                opacity: 0;
            }
        }


        /* Search Container */
        .search-container {
            margin-bottom: 15px;
            padding: 0 5px;
            display: flex;
            gap: 10px;
            align-items: center;
        }


        .search-wrapper {
            position: relative;
            flex: 1;
            max-width: 300px;
        }


        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }


        #searchRequests {
            width: 100%;
            padding: 8px 35px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 14px;
            transition: all 0.3s ease;
        }


        #searchRequests:focus {
            outline: none;
            border-color: var(--sidebar-active);
            box-shadow: 0 0 0 3px rgba(0, 191, 255, 0.2);
        }


        .highlight {
            background-color: rgba(0, 191, 255, 0.2);
            padding: 2px 0;
            border-radius: 2px;
        }


        .filter-wrapper {
            position: relative;
            margin-left: 70px;
            width: 200px;
            display: flex;
            gap: 10px;
            align-items: center;
        }


        .filter-wrapper select {
            flex: 1;
            padding: 8px 35px 8px 12px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 14px;
            appearance: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }


        .filter-wrapper::after {
            content: '\f0d7';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }


        .filter-wrapper select:focus {
            outline: none;
            border-color: var(--sidebar-active);
            box-shadow: 0 0 0 3px rgba(0, 191, 255, 0.2);
        }


        .reset-btn {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-muted);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }


        .reset-btn:hover {
            background: var(--hover-bg);
            color: var(--sidebar-active);
            border-color: var(--sidebar-active);
        }


        .status-upcoming {
            background-color: #e1f5fe;
            color: #0288d1;
        }


        /* Loading Overlay */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--sidebar-active);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }


        #loadingOverlay.active {
            opacity: 1;
            visibility: visible;
        }


        .status-rescheduled {
            background-color: #fff3cd;
            color: #856404;
        }


        /* ============================================= */
        /*  RESCHEDULE BUTTON SPECIFIC STYLES */
        /* ============================================= */
        .reschedule-btn {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); /* GRADIENT FOR VISIBILITY */
            color: #000;
            font-weight: bold;
            text-shadow: 0 1px 1px rgba(255,255,255,0.5);
            border: 2px solid #ff9800;
            box-shadow: 0 3px 6px rgba(255, 193, 7, 0.3);
        }


        .reschedule-btn:hover {
            background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(255, 152, 0, 0.4);
        }


        .reschedule-btn i {
            font-size: 14px;
        }


        /* Make sure table actions column is wide enough */
        .requests-table td:last-child {
            min-width: 250px;
        }


        /* Ensure buttons don't wrap */
        .requests-table .action-buttons-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: nowrap;
        }


        /* ============================================= */
        /*  RESCHEDULE REMINDER MODAL STYLES */
        /* ============================================= */


        .channel-option {
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }


        .channel-option:hover {
            border-color: var(--sidebar-active);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 191, 255, 0.1);
        }


        .channel-option.active {
            border-color: var(--sidebar-active);
            background: rgba(0, 191, 255, 0.05);
        }


        .channel-checkbox:checked + .channel-icon + .checkmark {
            background: var(--sidebar-active);
            border-color: var(--sidebar-active);
        }


        .channel-checkbox:checked + .channel-icon + .checkmark i {
            display: block;
        }


        /* Radio button styling */
        input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: var(--sidebar-active);
        }


        /* Checkbox styling */
        input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--sidebar-active);
            cursor: pointer;
        }


        /* Progress animation */
        @keyframes progressAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }


        #progressBar {
            background-size: 200% 100%;
            animation: progressAnimation 2s ease infinite;
        }


        /* Success animation */
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }


        .success-pulse {
            animation: successPulse 0.5s ease;
        }


        /* Status colors */
        .status-sent {
            color: #28a745;
        }


        .status-pending {
            color: #ffc107;
        }


        .status-failed {
            color: #dc3545;
        }
        .fab-container {
        position: fixed;
        bottom: 25px;
        right: 25px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        z-index: 1000;
      }

      .fab {
        width: 55px;
        height: 55px;
        border-radius: 50%;
        border: none;
        color: #fff;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .fab:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      }

      .fab.calendar {
        background: #0d6efd;
      }

      .fab.patient {
        background: #198754;
      }

      .fab.appointment {
        background: #fd7e14;
      }
      /* Calendar Card */
      .calendar-card {
        background: #ffffff;
        border-radius: 16px;
        padding: 15px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        width: 260px;
        margin-left: auto;
      }

      /* Calendar Header */
      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 10px;
      }

      /* Calendar Grid */
      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
        text-align: center;
      }

      /* Days */
      .calendar-grid span {
        font-size: 12px;
        color: #64748b;
      }

      /* Dates */
      .calendar-grid button {
        border: none;
        background: transparent;
        padding: 8px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 13px;
      }

      .calendar-grid button:hover {
        background: #e0f2fe;
      }

      .calendar-grid .today {
        background: #0d6efd;
        color: #fff;
        font-weight: 600;
      }

      /* Selected date */
      .calendar-grid .selected {
        background: #38bdf8;
        color: #fff;
      }
       /* ============================================= */
    /* INTERACTIVE ONBOARDING TUTORIAL STYLES */
    /* ============================================= */
    .tutorial-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 999999;
        display: none;
        backdrop-filter: blur(3px);
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .tutorial-highlight {
        position: absolute;
        border: 3px solid #00bfff;
        border-radius: 12px;
        box-shadow: 
            0 0 0 9999px rgba(0, 0, 0, 0.7),
            0 0 20px rgba(0, 191, 255, 0.5),
            inset 0 0 20px rgba(0, 191, 255, 0.3);
        z-index: 999998;
        pointer-events: none;
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { 
            box-shadow: 
                0 0 0 9999px rgba(0, 0, 0, 0.7),
                0 0 20px rgba(0, 191, 255, 0.5),
                inset 0 0 20px rgba(0, 191, 255, 0.3);
        }
        50% { 
            box-shadow: 
                0 0 0 9999px rgba(0, 0, 0, 0.7),
                0 0 30px rgba(0, 191, 255, 0.8),
                inset 0 0 30px rgba(0, 191, 255, 0.5);
        }
    }

    .tutorial-content {
        position: fixed;
        background: linear-gradient(135deg, var(--card-bg) 0%, var(--hover-bg) 100%);
        border-radius: 20px;
        padding: 30px;
        width: 500px;
        max-width: 90%;
        z-index: 999999;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        border: 2px solid var(--sidebar-active);
        animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        font-family: 'Inter', sans-serif;
    }

    @keyframes slideUp {
        from { 
            transform: translateY(50px) scale(0.95); 
            opacity: 0; 
        }
        to { 
            transform: translateY(0) scale(1); 
            opacity: 1; 
        }
    }

    .tutorial-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--border-color);
    }

    .tutorial-title {
        margin: 0;
        color: var(--text-color);
        font-size: 1.5rem;
        font-weight: 700;
        background: linear-gradient(90deg, var(--sidebar-active), #00d4ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .tutorial-progress {
        background: linear-gradient(135deg, var(--sidebar-active), #00d4ff);
        color: white;
        padding: 8px 16px;
        border-radius: 25px;
        font-size: 1rem;
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(0, 191, 255, 0.3);
    }

    .tutorial-body {
        margin-bottom: 30px;
    }

    .tutorial-message {
        color: var(--text-color);
        font-size: 1.1rem;
        line-height: 1.6;
        margin: 0 0 25px 0;
        min-height: 80px;
        padding: 15px;
        background: var(--hover-bg);
        border-radius: 12px;
        border-left: 4px solid var(--sidebar-active);
    }

    .tutorial-feature-highlight {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: rgba(0, 191, 255, 0.1);
        border-radius: 10px;
        margin-bottom: 15px;
        border: 1px solid rgba(0, 191, 255, 0.2);
    }

    .tutorial-feature-highlight i {
        color: var(--sidebar-active);
        font-size: 1.2rem;
        background: rgba(0, 191, 255, 0.2);
        padding: 10px;
        border-radius: 10px;
    }

    .tutorial-bullets {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
    }

    .bullet-point {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--border-color);
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .bullet-point:hover {
        transform: scale(1.3);
    }

    .bullet-point.active {
        background: var(--sidebar-active);
        transform: scale(1.3);
        box-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
    }

    .tutorial-footer {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
    }

    .tutorial-btn {
        padding: 12px 24px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        flex: 1;
        justify-content: center;
        min-width: 120px;
    }

    .tutorial-btn i {
        font-size: 1rem;
    }

    .tutorial-skip {
        background: transparent;
        color: var(--text-muted);
        border: 2px solid var(--border-color);
    }

    .tutorial-skip:hover {
        background: var(--hover-bg);
        color: var(--text-color);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .tutorial-prev {
        background: var(--hover-bg);
        color: var(--text-color);
        border: 2px solid var(--border-color);
    }

    .tutorial-prev:hover {
        background: var(--border-color);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .tutorial-next, .tutorial-complete {
        background: linear-gradient(135deg, var(--sidebar-active), #00d4ff);
        color: white;
        border: none;
        box-shadow: 0 4px 12px rgba(0, 191, 255, 0.3);
    }

    .tutorial-next:hover, .tutorial-complete:hover {
        background: linear-gradient(135deg, #0099cc, #00bfff);
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 6px 20px rgba(0, 191, 255, 0.4);
    }

    .tutorial-try-it {
        background: linear-gradient(135deg, #ffc107, #ff9800);
        color: #000;
        border: none;
        font-weight: bold;
        box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
    }

    .tutorial-try-it:hover {
        background: linear-gradient(135deg, #ff9800, #ff5722);
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
    }

    .tutorial-close {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(0, 0, 0, 0.1);
        border: none;
        color: var(--text-muted);
        font-size: 1.2rem;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .tutorial-close:hover {
        color: var(--text-color);
        background: rgba(0, 0, 0, 0.2);
        transform: rotate(90deg);
    }

    .tutorial-hotkey {
        display: inline-block;
        background: var(--hover-bg);
        color: var(--sidebar-active);
        padding: 2px 8px;
        border-radius: 4px;
        font-family: monospace;
        font-weight: bold;
        border: 1px solid var(--border-color);
        margin: 0 4px;
    }

    .tutorial-tip {
        background: rgba(255, 193, 7, 0.1);
        border-left: 4px solid #ffc107;
        padding: 12px;
        border-radius: 8px;
        margin-top: 15px;
        font-size: 0.9rem;
        color: var(--text-muted);
    }

    .tutorial-tip i {
        color: #ffc107;
        margin-right: 8px;
    }

    /* Interactive elements during tutorial */
    .tutorial-interactive {
        cursor: pointer !important;
        position: relative;
        z-index: 1000000 !important;
    }

    .tutorial-interactive:hover {
        transform: scale(1.02) !important;
        box-shadow: 0 0 20px rgba(0, 191, 255, 0.5) !important;
    }
    /* FAB CONTAINER */
    .fab-container{
        position:fixed;
        bottom:30px;
        right:30px;
        display:flex;
        flex-direction:column;
        gap:14px;
        z-index:1500;
    }

    .fab{
        width:56px;
        height:56px;
        border-radius:50%;
        border:none;
        cursor:pointer;
        color:#fff;
        font-size:20px;
        display:flex;
        align-items:center;
        justify-content:center;
        box-shadow:0 10px 25px rgba(0,0,0,.25);
        transition:.3s;
    }

    .fab:hover{
        transform:translateY(-3px);
        box-shadow:0 14px 30px rgba(0,0,0,.3);
    }

    .fab.patient{
        background:linear-gradient(135deg,#22c55e,#16a34a);
    }

    .fab.tutorial{
        background:linear-gradient(135deg,#0ea5e9,#0284c7);
    }


    /* Dark mode adjustments */
    [data-theme="dark"] .tutorial-content {
        background: linear-gradient(135deg, var(--card-bg) 0%, #1a1a1a 100%);
        border: 2px solid var(--sidebar-active);
    }

    [data-theme="dark"] .tutorial-highlight {
        box-shadow: 
            0 0 0 9999px rgba(0, 0, 0, 0.85),
            0 0 20px rgba(0, 191, 255, 0.7),
            inset 0 0 20px rgba(0, 191, 255, 0.5);
    }

    [data-theme="dark"] .tutorial-message {
        background: rgba(0, 0, 0, 0.3);
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .tutorial-content {
            width: 90%;
            padding: 20px;
        }
        
        .tutorial-footer {
            flex-direction: column;
        }
        
        .tutorial-btn {
            width: 100%;
            margin-bottom: 8px;
        }
        
        .tutorial-title {
            font-size: 1.3rem;
        }
        
        .tutorial-message {
            font-size: 1rem;
            padding: 12px;
        }
    }

    /* Animation for completed step */
    @keyframes stepCompleted {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    .step-completed {
        animation: stepCompleted 0.5s ease;
    }
    /* MODAL OVERLAY */
    .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        }

    .modal-overlay.hidden {
        display: none;
        }

    /* MODAL CARD */
    .modal-card {
        background: #fff;
        width: 420px;
        border-radius: 16px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        padding: 20px;
        animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
        from { transform: translateY(30px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
        }

    /* HEADER */
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        }

        .modal-header h3 {
        margin: 0;
        color: #1f2937;
        }

    /* CLOSE BUTTON */
    .close-btn {
        background: none;
        border: none;
        font-size: 22px;
        cursor: pointer;
        }

    /* FORM */
    .form-grid {
        margin-top: 15px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        }

    .form-grid input,
    .form-grid select {
        width: 100%;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        font-size: 14px;
        }

    .form-grid input:focus,
    .form-grid select:focus {
        outline: none;
        border-color: #0d6efd;
        }

    /* ACTION BUTTONS */
    .modal-actions {
        margin-top: 20px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        }

    .btn-cancel {
        background: #e5e7eb;
        border: none;
        padding: 10px 14px;
        border-radius: 8px;
        cursor: pointer;
        }

    .btn-save {
        background: #0d6efd;
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
    }   


    /* ============================================= */
    /*  End of Styles */
    /* ============================================= */
</style>


<!-- Add Chart.js library before closing head tag -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" style="
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--sidebar-active);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        ">
    <i class="fas fa-spinner fa-spin"></i> Loading...
    </div>
    <!-- Interactive Tutorial Overlay -->
    <div id="tutorialOverlay" class="tutorial-overlay">
        <div class="tutorial-highlight"></div>
        <div class="tutorial-content">
            <button class="tutorial-close" onclick="skipTutorial()">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="tutorial-header">
                <h3 class="tutorial-title" id="tutorialStepTitle">Welcome to Admin Dashboard</h3>
                <div class="tutorial-progress">
                    <span id="tutorialCurrentStep">1</span> / <span id="tutorialTotalSteps">10</span>
                </div>
            </div>
            
            <div class="tutorial-body">
                <p class="tutorial-message" id="tutorialMessage">
                    Welcome to your Holy Family Dental Clinic Admin Dashboard! This interactive tutorial will guide you through all features.
                </p>
                
                <div class="tutorial-feature-highlight" id="tutorialFeatureHighlight" style="display: none;">
                    <i class="fas fa-star"></i>
                    <div>
                        <strong id="featureTitle">Feature Name</strong>
                        <div id="featureDescription">Feature description goes here</div>
                    </div>
                </div>
                
                <div class="tutorial-tip" id="tutorialTip" style="display: none;">
                    <i class="fas fa-lightbulb"></i>
                    <span id="tipText">Pro tip: You can click highlighted elements to try them out!</span>
                </div>
                
                <div class="tutorial-bullets" id="tutorialBullets">
                    <!-- Bullets will be generated dynamically -->
                </div>
            </div>
            
            <div class="tutorial-footer">
                <button class="tutorial-btn tutorial-skip" onclick="skipTutorial()">
                    <i class="fas fa-times"></i> Skip Tutorial
                </button>
                <button class="tutorial-btn tutorial-prev" onclick="prevTutorialStep()" id="tutorialPrevBtn" style="display: none;">
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                <button class="tutorial-btn tutorial-try-it" onclick="tryCurrentFeature()" id="tutorialTryBtn" style="display: none;">
                    <i class="fas fa-hand-pointer"></i> Try It Now
                </button>
                <button class="tutorial-btn tutorial-next" onclick="nextTutorialStep()" id="tutorialNextBtn">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
                <button class="tutorial-btn tutorial-complete" onclick="completeTutorial()" id="tutorialCompleteBtn" style="display: none;">
                    <i class="fas fa-check"></i> Complete Tutorial
                </button>
            </div>
        </div>
    </div>


    <div class="dashboard">
    <!-- Sidebar Navigation -->
    <div class="sidebar">
    <div class="sidebar-header">
    <div class="logo-container">
    <img src="logo.png" alt="Holy Family Dental Clinic Logo" class="sidebar-logo">
    <div class="logo-glow"></div>
    </div>
    <div class="sidebar-title">
    <h2>
    <span class="holy-family">SMART</span><br>
    <span class="dental-clinic">DENTISTRY</span>
    </h2>
    </div>
    </div>
    <ul class="sidebar-menu">
    <li><a href="admin.html"><i class="fas fa-home"></i> Dashboard</a></li>
    <li><a href="My-Clinic.html"><i class="fas fa-tooth"></i> My Clinic</a></li>
    <li><a href="appointment-history.html"><i class="fas fa-calendar-alt"></i><span> Appointment History</a></li>
    <li><a href="patients.html"><i class="fas fa-users"></i><span>Patients</span></a></li>
    <li><a href="Finance.html"><i class="fas fa-dollar-sign"></i> Finance</a></li>
    <li><a href="Data-Back-Up.html"><i class="fa solid fa-database"></i><span> Data BackUp</a></li>

    </ul>
    <!-- Add Return to Home menu at the bottom -->
    <div style="position: absolute; bottom: 20px; width: 13%;">
    <div style="position: absolute; bottom: 20px; width: 100%;">
    <ul class="sidebar-menu settings-menu">
    <li><a href="Admin settings.html"><i class="fas fa-cog"></i> Settings</a></li>
    </ul>
    <ul class="sidebar-menu return-home-menu">
    <li><a href="landingpage.html" class="logout-btn"><i class="fas fa-arrow-left"></i> Return to Home</a></li>
    </ul>
    </div>
    </div>
    </div>


    <!-- Main Content Area -->
    <div class="main-content">
    <div class="header">
    <div>
    <h1 style="color: var(--text-color); margin: 0;">Admin Dashboard</h1>
    </div>
    <div class="theme-toggle">
    <span class="theme-toggle-label">Dark Mode</span>
    <label class="switch">
    <input type="checkbox" id="themeToggle">
    <span class="slider"></span>
    </label>
    </div>
    </div>


    <!-- Container Layout -->
    <div class="container-layout" style="display: flex; gap: 10px; height: calc(45vh - 150px); margin-top: -10px;">
    <!-- Left Container -->
    <div class="left-container">
    <div class="abstract-shapes">
    <div class="shape wave-top"></div>
    <div class="shape wave-left"></div>
    <div class="shape wave-right"></div>
    <div class="shape wave-bottom"></div>
    </div>


    <p style="color: var(--text-color); margin: 5px; margin-left: 30px; margin-bottom: -100px; font-size: 1.2em;">Good Morning,</p>
    <h2 style="color: var(--text-color); margin: 5px 0 5px; margin-top: 100px; margin-left: 30px; font-size: 2em;">Dr. Admin</h2>
    <p style="color: var(--text-color); margin: 0; margin-top: 5px; margin-left: 30px;">Your schedule today.</p>


    <div class="stat-cards-container">
    <div class="stat-card">
    <i class="fas fa-calendar-check icon"></i>
    <h3>Scheduled Today</h3>
    <div class="number" id="scheduledCount">0</div>
    </div>
    <div class="stat-card">
    <i class="fas fa-calendar-alt icon"></i>
    <h3>Appointment Request</h3>
    <div class="number" id="upcomingCount">0</div>
    </div>
    <div class="stat-card">
    <i class="fas fa-check-circle icon"></i>
    <h3>Completed</h3>
    <div class="number" id="completedCount">0</div>
    </div>
    <div class="stat-card">
    <i class="fas fa-calendar-times icon"></i>
    <h3>Reschedule</h3>
    <div class="number" id="RescheduleCount">0</div>
    </div>
    <div class="stat-card">
    <i class="fas fa-user-plus icon"></i>
    <h3>Walk-ins</h3>
    <div class="number" id="walkInCount">0</div>
    </div>
    </div>
    </div>


    <!-- Right Container -->
    <div class="right-container" style="flex: 0.8; background: var(--card-bg); border-radius: 10px; padding: 10px; box-shadow: var(--shadow); overflow-y: auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1px;">
    <select id="chartMetric" style="padding: 8px 15px; border-radius: 5px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color); font-size: 14px; font-weight: 500;">
    <option value="visits">Total Patient Visits</option>
    </select>
    <div style="display: flex; gap: 8px;">
    <button class="time-period-btn active" data-period="weekly" style="padding: 6px 12px; border-radius: 4px; border: 1px solid var(--sidebar-active); background: var(--card-bg); color: var(--text-color); cursor: pointer;">Week</button>
    <button class="time-period-btn" data-period="monthly" style="padding: 6px 12px; border-radius: 4px; border: 1px solid var(--sidebar-active); background: var(--card-bg); color: var(--text-color); cursor: pointer;">Month</button>
    <button class="time-period-btn" data-period="yearly" style="padding: 6px 12px; border-radius: 4px; border: 1px solid var(--sidebar-active); background: var(--card-bg); color: var(--text-color); cursor: pointer;">Year</button>
    </div>
    </div>
    <div style="height: 180px; position: relative;">
    <canvas id="patientActivityChart"></canvas>
    </div>
    <div style="text-align: center; margin-top: 5px;">
    <div class="percentage-change" style="color: #00bfff; font-size: 13px; font-weight: bold;">+60% Patient visits are higher than last week</div>
    </div>
    </div>
    </div>


    <!-- Bottom Containers Layout -->
    <div class="container-layout" style="display: flex; gap:10px; height: calc(67vh - 50px); margin-top: 10px;">
    <!-- Bottom Left Section - Contains 2 containers -->
    <div class="bottom-left-section">
    <!-- Bottom Left Top Container -->
    <div class="left-container requests-section bottom-left-top">
    <h2 style="margin-top: -5px; margin-bottom: 15px;">
    <i class="fas fa-clipboard-list"></i>
                                Appointment Requests
    <span class="notification-count" id="requestCount">0</span>
    </h2>
    <!-- Bulk actions -->
    <div class="bulk-actions" id="requestBulkActions">
    <div class="selected-count">
    <span id="requestSelectedCount">0</span> items selected
    </div>
    <div class="action-buttons">
    <button class="action-btn accept-btn" onclick="bulkAcceptRequests()">
    <i class="fas fa-check"></i> Accept Selected
    </button>
    <button class="action-btn reschedule-btn" onclick="showBulkRescheduleModal()">
    <i class="fas fa-calendar-alt"></i> Reschedule Selected
    </button>
    </div>
    </div>
    <div class="search-container">
    <div class="search-wrapper">
    <i class="fas fa-search search-icon"></i>
    <input type="text" id="searchRequests" placeholder="Search appointments...">
    </div>
    <div class="filter-wrapper">
    <select id="procedureFilter">
    <option value="">All Procedures</option>
    <option value="Dental Cleaning">Dental Cleaning</option>
    <option value="Root Canal">Root Canal</option>
    <option value="Tooth Extraction">Tooth Extraction</option>
    <option value="Dental Filling">Dental Filling</option>
    <option value="Dental Crown">Dental Crown</option>
    <option value="Dental Bridge">Dental Bridge</option>
    </select>
    <button class="reset-btn" onclick="resetFilters()">
    <i class="fas fa-sync-alt"></i>
                                        Reset
    </button>
    </div>
    </div>
    <div class="requests-table-container">
    <table class="requests-table">
    <thead>
    <tr>
    <th><input type="checkbox" id="selectAll"></th>
    <th>Patient Name</th>
    <th>Requested Date</th>
    <th>Requested Time</th>
    <th>Procedure</th>
    <th>Doctor</th>
    <th>Action</th>
    </tr>
    </thead>
    <tbody id="requestTableBody">
    <!-- Table rows will be dynamically populated -->
    </tbody>
    </table>
    </div>
    </div>


    <!-- Bottom Left Bottom Container -->
    <div class="left-container bottom-left-bottom">
    <h2 style="margin-top: -5px; margin-bottom: 15px;">
    <i class="fas fa-calendar-day"></i>
                                Appointments for <span id="todayDate"></span>
    <span class="notification-count" id="todayCount">0</span>
    </h2>
    <!-- Bulk actions -->
    <div class="bulk-actions" id="appointmentBulkActions">
    <div class="selected-count">
    <span id="appointmentSelectedCount">0</span> items selected
    </div>
    <div class="action-buttons">
    <button class="action-btn complete-btn" onclick="bulkCompleteAppointments()">
    <i class="fas fa-check"></i> Complete Selected
    </button>
    <button class="action-btn cancel-btn" onclick="bulkCancelAppointments()">
    <i class="fas fa-times"></i> Cancel Selected
    </button>
    </div>
    </div>
    <div class="requests-table-container">
    <table class="requests-table">
    <thead>
    <tr>
    <th><input type="checkbox" id="selectAllToday"></th>
    <th>Patient Name</th>
    <th>Date</th>
    <th>Time</th>
    <th>Procedure</th>
    <th>Status</th>
    <th>Actions</th>
    </tr>
    </thead>
    <tbody id="todayTableBody">
    <!-- Will be populated by JavaScript -->
    </tbody>
    </table>
    </div>
    </div>
    </div>
    <!-- Floating Action Buttons -->
    <div class="fab-container">
    <button class="fab patient" onclick="showAddPatientModal()" title="Add Patient">
        <i class="fas fa-user-plus"></i>
    </button>

    <!-- Restart Tutorial FAB -->
    <button class="fab tutorial" onclick="restartTutorial()" title="Restart Tutorial">
     <i class="fas fa-play-circle"></i>
    </button>

    <button class="fab appointment" onclick="showAddAppointmentModal()" title="Add Appointment">
        <i class="fas fa-calendar-plus"></i>
    </button>

    </div>

    <!-- Bottom Right Container -->
    <div class="calendar-card">
    <div class="calendar-header">
        <button onclick="prevMonth()"></button>
        <span id="calendarMonth">May 2025</span>
        <button onclick="nextMonth()"></button>
    </div>

    <div class="calendar-grid">
        <span>Sun</span><span>Mon</span><span>Tue</span>
        <span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span>

        <!-- sample dates -->
        <button>1</button>
        <button>2</button>
        <button class="today">3</button>
        <button>4</button>  
        <button>5</button>
        <button>6</button>      
        <button>7</button>
        <button>8</button>            
        <button>9</button>  
        <button>10</button>
        <button>11</button>
        <button>12</button>
        <button>13</button>
        <button>14</button>
        <button>15</button>
        <button>16</button>
        <button>17</button>
        <button>18</button>
        <button>19</button>
        <button>20</button>
        <button>21</button>
        <button>22</button>
        <button>23</button>
        <button>24</button>
        <button>25</button>
        <button>26</button>
        <button>27</button>
        <button>28</button>
        <button>29</button>
        <button>30</button>
        <button>31</button>
        
    </div>
    </div>

    <!-- Add Appointment Modal -->
<div id="addAppointmentModal" class="confirmation-modal">
    <div class="confirmation-content" style="max-width: 600px;">
        <div class="modal-decoration modal-decoration-1"></div>
        <div class="modal-decoration modal-decoration-2"></div>


        <div class="confirmation-header" style="display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center;">
                <div class="confirmation-icon" style="background-color: rgba(255, 215, 0, 0.2); color: #FFD700;">
                    <i class="fas fa-calendar-plus"></i>
                </div>
                <h3 class="confirmation-title">Add New Appointment</h3>
            </div>
            <button onclick="closeAddAppointmentModal()" style="background: none; border: none; cursor: pointer; color: var(--text-muted); font-size: 1.2rem;">
                <i class="fas fa-times"></i>
            </button>
        </div>
         <div style="margin: 20px 0;">
            <!-- Patient Selection -->
            <div class="form-group">
                <label><i class="fas fa-user"></i> Select Patient</label>
                <select id="addPatientSelect" class="form-control">
                    <option value="">Select Patient</option>
                    <option value="new">+ Add New Patient</option>
                    <option value="P001">John Doe (P001)</option>
                    <option value="P002">Jane Smith (P002)</option>
                    <option value="P003">Michael Johnson (P003)</option>
                    <option value="P004">Sarah Williams (P004)</option>
                    <option value="P005">Robert Brown (P005)</option>
                </select>
            </div> 
            <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-calendar-day"></i> Appointment Date</label>
                    <input type="date" id="addAppointmentDate" class="form-control">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-clock"></i> Appointment Time</label>
                    <input type="time" id="addAppointmentTime" class="form-control">
                </div>
            </div>

             <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-stethoscope"></i> Procedure</label>
                    <select id="addAppointmentProcedure" class="form-control">
                        <option value="">Select Procedure</option>
                        <option value="Dental Cleaning">Dental Cleaning</option>
                        <option value="Root Canal">Root Canal</option>
                        <option value="Tooth Extraction">Tooth Extraction</option>
                        <option value="Dental Filling">Dental Filling</option>
                        <option value="Dental Crown">Dental Crown</option>
                        <option value="Dental Bridge">Dental Bridge</option>
                        <option value="Dental Implant">Dental Implant</option>
                        <option value="Teeth Whitening">Teeth Whitening</option>
                        <option value="Consultation">Consultation</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-user-md"></i> Doctor</label>
                    <select id="addAppointmentDoctor" class="form-control">
                        <option value="Dr. Admin">Dr. Admin</option>
                        <option value="Dr. Smith">Dr. Smith</option>
                        <option value="Dr. Johnson">Dr. Johnson</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label><i class="fas fa-notes-medical"></i> Notes (Optional)</label>
                <textarea id="addAppointmentNotes" class="form-control" rows="3" placeholder="Add any notes or special instructions..."></textarea>
            </div>
        </div>

        <div class="confirmation-buttons">
            <button class="cancel-btn" onclick="closeAddAppointmentModal()">
                <i class="fas fa-times"></i> Cancel
            </button>
            <button class="confirm-btn" onclick="saveNewAppointment()" style="background-color: #FFD700; color: #000;">
                <i class="fas fa-save"></i> Save Appointment
            </button>
        </div>
    </div>
</div>

<!-- Add Patient Modal -->
<div id="addPatientModal" class="confirmation-modal">
    <div class="confirmation-content" style="max-width: 600px;">
        <div class="modal-decoration modal-decoration-1"></div>
        <div class="modal-decoration modal-decoration-2"></div>

         <div class="confirmation-header" style="display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center;">
                <div class="confirmation-icon" style="background-color: rgba(50, 205, 50, 0.2); color: #32CD32;">
                    <i class="fas fa-user-plus"></i>
                </div>
                <h3 class="confirmation-title">Add New Patient</h3>
            </div>
            <button onclick="closeAddPatientModal()" style="background: none; border: none; cursor: pointer; color: var(--text-muted); font-size: 1.2rem;">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div style="margin: 20px 0;">
            <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> First Name</label>
                    <input type="text" id="patientFirstName" class="form-control" placeholder="Enter first name">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Last Name</label>
                    <input type="text" id="patientLastName" class="form-control" placeholder="Enter last name">
                </div>

                </div>
                  <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-birthday-cake"></i> Date of Birth</label>
                    <input type="date" id="patientDOB" class="form-control">
                </div>
                 <div class="form-group">
                    <label><i class="fas fa-venus-mars"></i> Gender</label>
                    <select id="patientGender" class="form-control">
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
              <div class="form-group">
                <label><i class="fas fa-phone"></i> Contact Number</label>
                <input type="tel" id="patientContact" class="form-control" placeholder="+63 912 345 6789">
            </div>

            <div class="form-group">
                <label><i class="fas fa-envelope"></i> Email Address</label>
                <input type="email" id="patientEmail" class="form-control" placeholder="patient@example.com">
            </div>

             <div class="form-group">
                <label><i class="fas fa-map-marker-alt"></i> Address</label>
                <textarea id="patientAddress" class="form-control" rows="2" placeholder="Enter complete address"></textarea>
            </div>

            <div class="form-group">
                <label><i class="fas fa-notes-medical"></i> Medical History (Optional)</label>
                <textarea id="patientMedicalHistory" class="form-control" rows="3" placeholder="Any known allergies, medical conditions, or previous dental treatments..."></textarea>
            </div>
        </div>

        <div class="confirmation-buttons">
            <button class="cancel-btn" onclick="closeAddPatientModal()">
                <i class="fas fa-times"></i> Cancel
            </button>
            <button class="confirm-btn" onclick="saveNewPatient()" style="background-color: #32CD32;">
                <i class="fas fa-save"></i> Save Patient
            </button>
        </div>
    </div>
</div>

    <!-- Accept Confirmation Modal -->
    <div id="acceptConfirmationModal" class="confirmation-modal">
        <div class="confirmation-content">
            <div class="modal-decoration modal-decoration-1"></div>
            <div class="modal-decoration modal-decoration-2"></div>


            <div class="confirmation-header" style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center;">
                    <div class="confirmation-icon accept-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 class="confirmation-title" id="acceptModalTitle">Accept Appointment</h3>
                </div>

                <button onclick="closeAcceptModal()" style="background: none; border: none; cursor: pointer; color: var(--text-muted); font-size: 1.2rem;">
                    <i class="fas fa-times"></i>
                </button>
            </div>


            <p class="confirmation-message" id="acceptModalMessage">
                Are you sure you want to accept this appointment?
            </p>


            <div class="confirmation-buttons">
                <button class="cancel-btn" onclick="closeAcceptModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="confirm-btn" onclick="confirmAcceptAppointment()">
                    <i class="fas fa-check"></i> Complete
                </button>
            </div>
        </div>
    </div>

    <!-- Reschedule Confirmation Modal -->
    <div id="rescheduleConfirmationModal" class="confirmation-modal">
        <div class="confirmation-content">
            <!-- Decorative elements -->
            <div class="modal-decoration modal-decoration-1"></div>
            <div class="modal-decoration modal-decoration-2"></div>


            <div class="confirmation-header" style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center;">
                    <div class="confirmation-icon" style="background-color: rgba(255, 193, 7, 0.2); color: #ffc107;">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h3 class="confirmation-title">Reschedule Appointment</h3>
                </div>
                <button onclick="closeRescheduleModal()" style="background: none; border: none; cursor: pointer; color: var(--text-muted); font-size: 1.2rem;">
                    <i class="fas fa-times"></i>
                </button>
            </div>


            <p class="confirmation-message">
                Please select a new date and provide a reason for rescheduling:
            </p>


            <!-- Date Selection -->
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: var(--text-color); font-weight: 500;">
                    <i class="fas fa-calendar-day"></i> Select New Date
                </label>
                <input type="date" id="rescheduleDate" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color);">
            </div>


            <!-- Time Selection -->
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: var(--text-color); font-weight: 500;">
                    <i class="fas fa-clock"></i> Select New Time
                </label>
                <input type="time" id="rescheduleTime" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color);">
            </div>


            <!-- Reason Textarea -->
            <textarea class="reason-textarea" id="rescheduleReason" 
                    placeholder="Enter reason for rescheduling (e.g., time slot unavailable, patient requested new date...)"></textarea>


            <!-- Notification Options -->
            <div style="margin: 15px 0; padding: 15px; background: var(--hover-bg); border-radius: 8px;">
                <label style="display: flex; align-items: center; gap: 10px; color: var(--text-color);">
                    <input type="checkbox" id="sendRescheduleNotification" checked>
                    <span>
                        <i class="fas fa-bell"></i> Notify patient about rescheduled appointment
                    </span>
                </label>
                <small style="display: block; margin-top: 5px; color: var(--text-muted); margin-left: 24px;">
                    Patient will receive notification via SMS/Email with the new date and reason
                </small>
            </div>


            <div class="confirmation-buttons">
                <button class="cancel-btn" onclick="closeRescheduleModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="confirm-btn" onclick="openCalendarPicker()" style="background-color: #ffc107;">
                    <i class="fas fa-calendar-alt"></i> Use Calendar
                </button>
                <button class="confirm-btn" onclick="submitReschedule()">
                    <i class="fas fa-check"></i> Reschedule
                </button>
            </div>
        </div>
    </div>


    <!-- Calendar Date Picker Modal for Rescheduling -->
    <div id="calendarDatePickerModal" class="confirmation-modal">
        <div class="confirmation-content" style="max-width: 500px;">
            <div class="confirmation-header">
                <div style="display: flex; align-items: center;">
                    <div class="confirmation-icon" style="background-color: rgba(0, 191, 255, 0.2); color: var(--sidebar-active);">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h3 class="confirmation-title">Select New Date</h3>
                </div>
                <button onclick="closeCalendarPickerModal()" style="background: none; border: none; cursor: pointer; color: var(--text-muted); font-size: 1.2rem;">
                    <i class="fas fa-times"></i>
                </button>
            </div>


            <div style="margin-bottom: 20px;">
                <div class="calendar-header">
                    <h2>
                        <i class="fas fa-calendar-alt"></i>
                        <span id="rescheduleMonthYear"></span>
                    </h2>
                    <div class="calendar-nav">
                        <button onclick="reschedulePrevMonth()"><i class="fas fa-chevron-left"></i></button>
                        <button onclick="rescheduleToday()">Today</button>
                        <button onclick="rescheduleNextMonth()"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="calendar-grid" id="rescheduleCalendarDays">
                    <!-- Days of week headers -->
                </div>
                <div class="calendar-grid" id="rescheduleCalendarGrid">
                    <!-- Calendar days will be added here -->
                </div>
            </div>


            <!-- Time Selection -->
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: var(--text-color); font-weight: 500;">
                    <i class="fas fa-clock"></i> Select Time
                </label>
                <input type="time" id="calendarRescheduleTime" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color);">
            </div>


            <div class="confirmation-buttons">
                <button class="cancel-btn" onclick="closeCalendarPickerModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="confirm-btn" onclick="selectCalendarDate()">
                    <i class="fas fa-check"></i> Select Date
                </button>
            </div>
        </div>
    </div>

    <!-- Reschedule Confirmation Reminder Modal -->
    <div id="reminderConfirmationModal" class="confirmation-modal">
        <div class="confirmation-content" style="max-width: 600px;">
            <!-- Decorative elements -->
            <div class="modal-decoration modal-decoration-1"></div>
            <div class="modal-decoration modal-decoration-2"></div>


            <div class="confirmation-header" style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--border-color); padding-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="confirmation-icon" style="background-color: rgba(0, 191, 255, 0.2); color: var(--sidebar-active);">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div>
                        <h3 class="confirmation-title" style="margin: 0 0 5px 0;">Send Reschedule Reminder</h3>
                        <p style="margin: 0; color: var(--text-muted); font-size: 14px;">Notify patient about the new appointment details</p>
                    </div>
                </div>
                <button onclick="closeReminderModal()" style="background: none; border: none; cursor: pointer; color: var(--text-muted); font-size: 1.2rem; padding: 5px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>


            <!-- Patient Information -->
            <div style="margin: 20px 0; padding: 15px; background: var(--hover-bg); border-radius: 10px; border-left: 4px solid var(--sidebar-active);">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <i class="fas fa-user-circle" style="color: var(--sidebar-active); font-size: 16px;"></i>
                            <h4 style="margin: 0; font-size: 16px; color: var(--text-color);" id="reminderPatientName">Patient Name</h4>
                        </div>
                        <div style="margin-left: 26px;">
                            <p style="margin: 5px 0; font-size: 13px; color: var(--text-muted);">
                                <i class="fas fa-calendar-alt" style="margin-right: 8px; width: 16px;"></i>
                                Old Date: <span id="reminderOldDate" style="color: var(--text-color); font-weight: 500;">MM/DD/YYYY</span>
                            </p>
                            <p style="margin: 5px 0; font-size: 13px; color: var(--text-muted);">
                                <i class="fas fa-calendar-check" style="margin-right: 8px; width: 16px;"></i>
                                New Date: <span id="reminderNewDate" style="color: #28a745; font-weight: 600;">MM/DD/YYYY</span>
                            </p>
                            <p style="margin: 5px 0; font-size: 13px; color: var(--text-muted);">
                                <i class="fas fa-clock" style="margin-right: 8px; width: 16px;"></i>
                                New Time: <span id="reminderNewTime" style="color: #28a745; font-weight: 600;">HH:MM AM/PM</span>
                            </p>
                            <p style="margin: 5px 0; font-size: 13px; color: var(--text-muted);">
                                <i class="fas fa-stethoscope" style="margin-right: 8px; width: 16px;"></i>
                                Procedure: <span id="reminderProcedure" style="color: var(--text-color); font-weight: 500;">Procedure Name</span>
                            </p>
                        </div>
                    </div>
                    <div style="background: var(--card-bg); padding: 10px 15px; border-radius: 8px; min-width: 100px; text-align: center;">
                        <div style="color: var(--text-muted); font-size: 12px; margin-bottom: 5px;">Reminder Status</div>
                        <div id="reminderStatus" style="color: #ffc107; font-weight: 600; font-size: 14px;">
                            <i class="fas fa-clock"></i> Pending
                        </div>
                    </div>
                </div>
            </div>


            <!-- Communication Channels -->
            <div style="margin-bottom: 25px;">
                <h4 style="margin: 0 0 15px 0; color: var(--text-color); font-size: 16px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-broadcast-tower"></i>
                    Choose Communication Channels
                </h4>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <!-- SMS Option -->
                    <label class="channel-option" style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--card-bg); border: 2px solid var(--border-color); border-radius: 10px; cursor: pointer; transition: all 0.3s ease; position: relative;">
                        <input type="checkbox" id="smsCheckbox" checked class="channel-checkbox" style="position: absolute; opacity: 0; width: 0; height: 0;">
                        <div class="channel-icon" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #34c759 0%, #2aa44f 100%); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-sms" style="color: white; font-size: 18px;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-color); margin-bottom: 3px;">SMS Notification</div>
                            <div style="font-size: 12px; color: var(--text-muted);">Send text message to patient's phone</div>
                            <div id="smsPhoneNumber" style="font-size: 11px; color: var(--sidebar-active); margin-top: 5px; font-weight: 500;">
                                <i class="fas fa-phone"></i> +63 912 345 6789
                            </div>
                        </div>
                        <div class="checkmark" style="width: 20px; height: 20px; border: 2px solid var(--border-color); border-radius: 4px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-check" style="color: white; font-size: 12px; display: none;"></i>
                        </div>
                    </label>


                    <!-- Email Option -->
                    <label class="channel-option" style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--card-bg); border: 2px solid var(--border-color); border-radius: 10px; cursor: pointer; transition: all 0.3s ease; position: relative;">
                        <input type="checkbox" id="emailCheckbox" checked class="channel-checkbox" style="position: absolute; opacity: 0; width: 0; height: 0;">
                        <div class="channel-icon" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #007aff 0%, #0056cc 100%); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-envelope" style="color: white; font-size: 18px;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-color); margin-bottom: 3px;">Email Notification</div>
                            <div style="font-size: 12px; color: var(--text-muted);">Send detailed email to patient</div>
                            <div id="emailAddress" style="font-size: 11px; color: var(--sidebar-active); margin-top: 5px; font-weight: 500; word-break: break-all;">
                                <i class="fas fa-at"></i> patient.email@example.com
                            </div>
                        </div>
                        <div class="checkmark" style="width: 20px; height: 20px; border: 2px solid var(--border-color); border-radius: 4px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-check" style="color: white; font-size: 12px; display: none;"></i>
                        </div>
                    </label>
                </div>
            </div>


            <!-- Message Preview -->
            <div style="margin-bottom: 25px;">
                <h4 style="margin: 0 0 10px 0; color: var(--text-color); font-size: 16px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-eye"></i>
                    Message Preview
                </h4>
                <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; max-height: 200px; overflow-y: auto;">
                    <div id="smsPreview" style="margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <div style="width: 20px; height: 20px; background: #34c759; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-sms" style="color: white; font-size: 10px;"></i>
                            </div>
                            <span style="font-weight: 600; color: var(--text-color);">SMS Preview:</span>
                        </div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 13px; color: #495057; border-left: 3px solid #34c759;">
                            Dear <span id="previewPatientName">[Patient Name]</span>, your appointment has been rescheduled to <span id="previewNewDate">[New Date]</span> at <span id="previewNewTime">[New Time]</span>. Procedure: <span id="previewProcedure">[Procedure]</span>. Please arrive 15 minutes early.
                        </div>
                    </div>
                    <div id="emailPreview">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <div style="width: 20px; height: 20px; background: #007aff; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-envelope" style="color: white; font-size: 10px;"></i>
                            </div>
                            <span style="font-weight: 600; color: var(--text-color);">Email Preview:</span>
                        </div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 13px; color: #495057; border-left: 3px solid #007aff;">
                            <div style="margin-bottom: 8px;"><strong>Subject:</strong> Appointment Rescheduled - Holy Family Dental Clinic</div>
                            <div>Dear <span id="emailPreviewPatientName">[Patient Name]</span>,</div>
                            <div style="margin: 10px 0;">Your appointment has been rescheduled with the following details:</div>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li><strong>New Date:</strong> <span id="emailPreviewNewDate">[New Date]</span></li>
                                <li><strong>New Time:</strong> <span id="emailPreviewNewTime">[New Time]</span></li>
                                <li><strong>Procedure:</strong> <span id="emailPreviewProcedure">[Procedure]</span></li>
                                <li><strong>Doctor:</strong> <span id="emailPreviewDoctor">[Doctor Name]</span></li>
                            </ul>
                            <div>Please contact us at (02) 123-4567 if you have any questions.</div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Schedule Options -->
            <div style="margin-bottom: 25px;">
                <h4 style="margin: 0 0 10px 0; color: var(--text-color); font-size: 16px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-clock"></i>
                    Schedule Options
                </h4>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="scheduleOption" value="now" checked id="sendNowOption">
                        <span style="color: var(--text-color);">Send Now</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="scheduleOption" value="later" id="sendLaterOption">
                        <span style="color: var(--text-color);">Schedule for Later</span>
                    </label>
                </div>
                <div id="scheduleTimePicker" style="margin-top: 10px; display: none;">
                    <div style="display: flex; gap: 10px;">
                        <input type="datetime-local" id="scheduledDateTime" style="flex: 1; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color);">
                        <button onclick="setReminderTime()" style="padding: 8px 15px; background: var(--hover-bg); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-color); cursor: pointer;">
                            <i class="fas fa-calendar-check"></i> Set Time
                        </button>
                    </div>
                </div>
            </div>


            <!-- Action Buttons -->
            <div class="confirmation-buttons" style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                <div>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="saveTemplate" checked>
                        <span style="color: var(--text-color); font-size: 14px;">Save as template for future use</span>
                    </label>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="cancel-btn" onclick="closeReminderModal()" style="background: var(--text-muted);">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="confirm-btn" onclick="testReminder()" style="background: #6c757d;">
                        <i class="fas fa-vial"></i> Test Send
                    </button>
                    <button class="confirm-btn" onclick="sendReminder()" id="sendReminderBtn">
                        <i class="fas fa-paper-plane"></i> Send Reminder
                    </button>
                </div>
            </div>


            <!-- Progress Bar (Hidden by default) -->
            <div id="reminderProgress" style="display: none; margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span style="font-size: 13px; color: var(--text-color);">Sending notifications...</span>
                    <span id="progressPercentage" style="font-size: 13px; color: var(--sidebar-active); font-weight: 600;">0%</span>
                </div>
                <div style="height: 6px; background: var(--hover-bg); border-radius: 3px; overflow: hidden;">
                    <div id="progressBar" style="height: 100%; background: linear-gradient(90deg, var(--sidebar-active), #28a745); width: 0%; transition: width 0.3s ease;"></div>
                </div>
                <div id="progressDetails" style="margin-top: 10px; font-size: 12px; color: var(--text-muted); text-align: center;">
                    <i class="fas fa-spinner fa-spin"></i> Processing...
                </div>
            </div>
        </div>
    </div>


    <!-- Toast Container -->
    <div class="toast-container"></div>


    <script>

    // =============================================
    // INTERACTIVE ONBOARDING TUTORIAL SYSTEM
    // =============================================

    document.querySelectorAll(".dropdown-toggle").forEach(item => {
        item.addEventListener("click", function () {
        this.parentElement.classList.toggle("active");
        });
    });

    document.querySelectorAll(".dropdown-toggle").forEach(toggle => {
    toggle.addEventListener("click", function () {
        const dropdown = this.parentElement;

        // close other open dropdowns
        document.querySelectorAll(".dropdown.open").forEach(d => {
        if (d !== dropdown) d.classList.remove("open");
        });

        // toggle current
        dropdown.classList.toggle("open");
    });
    });


    let patientActivityChart = null;

    // Tutorial configuration
    let tutorialSteps = [
        {
            title: "Welcome to Admin Dashboard",
            message: "Welcome to your Holy Family Dental Clinic Admin Dashboard! This interactive tutorial will guide you through all the powerful features available to manage your dental practice efficiently.",
            highlight: null,
            position: "center",
            featureHighlight: false,
            tryFeature: false,
            tip: "Press <span class='tutorial-hotkey'>ESC</span> to skip the tutorial anytime"
        },
        {
            title: "Dashboard Statistics",
            message: "Get a quick overview of your clinic's performance with these live statistics cards. They update in real-time showing scheduled appointments, pending requests, completed procedures, and walk-in patients.",
            highlight: ".stat-cards-container",
            position: "top-left",
            featureHighlight: true,
            featureTitle: "Real-time Statistics",
            featureDescription: "Monitor key metrics at a glance",
            tryFeature: true,
            tryAction: "tryStatistics",
            tip: "Hover over any statistic card to see a brief description"
        },
        {
            title: "Patient Activity Chart",
            message: "Visualize your patient visits over time with this interactive chart. Switch between weekly, monthly, and yearly views to analyze trends and patterns in patient appointments.",
            highlight: ".right-container",
            position: "top-right",
            featureHighlight: true,
            featureTitle: "Analytics Dashboard",
            featureDescription: "Track patient visit patterns and growth",
            tryFeature: true,
            tryAction: "tryChartControls",
            tip: "Click on chart data points to see detailed numbers"
        },
        {
            title: "Appointment Requests",
            message: "Manage incoming appointment requests here. Review patient details, requested procedures, and times. Accept, reject, or reschedule appointments with a single click.",
            highlight: ".bottom-left-top",
            position: "left",
            featureHighlight: true,
            featureTitle: "Request Management",
            featureDescription: "Handle all appointment requests efficiently",
            tryFeature: true,
            tryAction: "tryAppointmentRequest",
            tip: "Use the search and filter options to find specific requests quickly"
        },
        {
            title: "Today's Appointments",
            message: "View and manage today's scheduled appointments. Mark appointments as completed, cancel if needed, or handle bulk actions for multiple appointments at once.",
            highlight: ".bottom-left-bottom",
            position: "left",
            featureHighlight: true,
            featureTitle: "Daily Schedule",
            featureDescription: "Manage your day's appointments efficiently",
            tryFeature: true,
            tryAction: "tryTodayAppointments",
            tip: "Click on any appointment row to see patient details and history"
        },
        {
            title: "Interactive Calendar",
            message: "Your scheduling calendar shows all appointments. Days with appointments are marked with blue dots. Click any date to view appointments for that specific day.",
            highlight: ".calendar-sidebar",
            position: "right",
            featureHighlight: true,
            featureTitle: "Visual Scheduling",
            featureDescription: "Plan and view appointments calendar-style",
            tryFeature: true,
            tryAction: "tryCalendar",
            tip: "Use the navigation arrows to move between months"
        },
        {
            title: "Bulk Actions",
            message: "Save time by selecting multiple appointments and performing batch operations. Accept, reject, complete, or cancel multiple appointments simultaneously.",
            highlight: "#selectAll",
            position: "left",
            featureHighlight: true,
            featureTitle: "Batch Processing",
            featureDescription: "Handle multiple appointments efficiently",
            tryFeature: true,
            tryAction: "tryBulkActions",
            tip: "Use the 'Select All' checkbox to quickly select all items"
        },
        {
            title: "Search & Filter",
            message: "Quickly find specific appointments using the search bar. Filter by procedure type to focus on particular dental services or treatments.",
            highlight: ".search-container",
            position: "left",
            featureHighlight: true,
            featureTitle: "Smart Search",
            featureDescription: "Find appointments instantly",
            tryFeature: true,
            tryAction: "trySearchFilter",
            tip: "Combine search and filter for precise results"
        },
        {
            title: "Theme Customization",
            message: "Switch between light and dark modes according to your preference. The dark mode is easier on the eyes during late hours or in low-light environments.",
            highlight: ".theme-toggle",
            position: "right",
            featureHighlight: true,
            featureTitle: "Personalization",
            featureDescription: "Customize your dashboard appearance",
            tryFeature: true,
            tryAction: "tryThemeToggle",
            tip: "Your theme preference is saved automatically"
        },
        {
            title: "Sidebar Navigation",
            message: "Access all clinic management features: My Clinic setup, Appointment History, Patient Records, Financial Reports, Data Backup, and comprehensive Analytics.",
            highlight: ".sidebar-menu",
            position: "left",
            featureHighlight: true,
            featureTitle: "Complete Clinic Management",
            featureDescription: "All tools in one organized navigation",
            tryFeature: false,
            tip: "The sidebar collapses on mobile for more screen space"
        },
        {
            title: "Tutorial Complete!",
            message: "Congratulations! You've completed the interactive tutorial. You're now ready to efficiently manage your dental clinic using all the powerful features of the dashboard.",
            highlight: null,
            position: "center",
            featureHighlight: false,
            tryFeature: false,
            tip: "You can restart this tutorial anytime from the sidebar"
        }
    ];

    // Tutorial state management
    let currentTutorialStep = 0;
    let isTutorialActive = false;
    let tutorialCompleted = localStorage.getItem('tutorialCompleted') === 'true';

    // Initialize tutorial
    function initTutorial() {
        // Create bullet points
        const bulletsContainer = document.getElementById('tutorialBullets');
        bulletsContainer.innerHTML = '';
        
        tutorialSteps.forEach((step, index) => {
            const bullet = document.createElement('div');
            bullet.className = 'bullet-point';
            bullet.dataset.step = index;
            bullet.addEventListener('click', () => goToTutorialStep(index));
            bulletsContainer.appendChild(bullet);
        });
        
        // Set total steps
        document.getElementById('tutorialTotalSteps').textContent = tutorialSteps.length;
        
        // Auto-start tutorial on every page open (no sidebar trigger required)
        setTimeout(() => {
            if (!isTutorialActive) {
                startTutorial();
            }
        }, 1200);
    }

    // Start tutorial
    function startTutorial() {
        isTutorialActive = true;
        currentTutorialStep = 0;
        showTutorialStep(0);
        document.getElementById('tutorialOverlay').style.display = 'flex';
        
        // Disable scrolling during tutorial
        document.body.style.overflow = 'hidden';
    }

    // Show specific tutorial step
    function showTutorialStep(stepIndex) {
        const step = tutorialSteps[stepIndex];
        const overlay = document.getElementById('tutorialOverlay');
        const highlight = overlay.querySelector('.tutorial-highlight');
        const title = document.getElementById('tutorialStepTitle');
        const message = document.getElementById('tutorialMessage');
        const currentStep = document.getElementById('tutorialCurrentStep');
        const featureHighlight = document.getElementById('tutorialFeatureHighlight');
        const tip = document.getElementById('tutorialTip');
        const prevBtn = document.getElementById('tutorialPrevBtn');
        const nextBtn = document.getElementById('tutorialNextBtn');
        const completeBtn = document.getElementById('tutorialCompleteBtn');
        const tryBtn = document.getElementById('tutorialTryBtn');
        const bullets = document.querySelectorAll('.bullet-point');
        
        // Update content
        title.textContent = step.title;
        message.innerHTML = step.message;
        currentStep.textContent = stepIndex + 1;
        
        // Update feature highlight
        if (step.featureHighlight) {
            featureHighlight.style.display = 'flex';
            document.getElementById('featureTitle').textContent = step.featureTitle;
            document.getElementById('featureDescription').textContent = step.featureDescription;
        } else {
            featureHighlight.style.display = 'none';
        }
        
        // Update tip
        if (step.tip) {
            tip.style.display = 'block';
            document.getElementById('tipText').innerHTML = step.tip;
        } else {
            tip.style.display = 'none';
        }
        
        // Update buttons
        prevBtn.style.display = stepIndex > 0 ? 'flex' : 'none';
        nextBtn.style.display = stepIndex < tutorialSteps.length - 1 ? 'flex' : 'none';
        completeBtn.style.display = stepIndex === tutorialSteps.length - 1 ? 'flex' : 'none';
        tryBtn.style.display = step.tryFeature ? 'flex' : 'none';
        
        // Update bullet points
        bullets.forEach((bullet, index) => {
            if (index <= stepIndex) {
                bullet.classList.add('active');
            } else {
                bullet.classList.remove('active');
            }
            
            // Add completion animation for previous steps
            if (index < stepIndex) {
                bullet.classList.add('step-completed');
                setTimeout(() => bullet.classList.remove('step-completed'), 500);
            }
        });
        
        // Position the content
        positionTutorialContent(step.position);
        
        // Handle highlight
        if (step.highlight) {
            const element = document.querySelector(step.highlight);
            if (element) {
                const rect = element.getBoundingClientRect();
                highlight.style.display = 'block';
                highlight.style.width = `${rect.width + 20}px`;
                highlight.style.height = `${rect.height + 20}px`;
                highlight.style.left = `${rect.left - 10}px`;
                highlight.style.top = `${rect.top - 10}px`;
                
                // Make element interactive during tutorial
                element.classList.add('tutorial-interactive');
                
                // Scroll element into view if needed
                element.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center',
                    inline: 'center'
                });
            } else {
                highlight.style.display = 'none';
            }
        } else {
            highlight.style.display = 'none';
        }
        
        currentTutorialStep = stepIndex;
    }

    // Position tutorial content based on step
    function positionTutorialContent(position) {
        const content = document.querySelector('.tutorial-content');
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;
        
        // Reset positioning
        content.style.position = 'fixed';
        content.style.margin = '0';
        content.style.transform = 'none';
        
        switch(position) {
            case 'top-left':
                content.style.top = '20px';
                content.style.left = '20px';
                content.style.right = 'auto';
                content.style.bottom = 'auto';
                break;
                
            case 'top-right':
                content.style.top = '20px';
                content.style.right = '20px';
                content.style.left = 'auto';
                content.style.bottom = 'auto';
                break;
                
            case 'left':
                content.style.top = '50%';
                content.style.left = '20px';
                content.style.right = 'auto';
                content.style.bottom = 'auto';
                content.style.transform = 'translateY(-50%)';
                break;
                
            case 'right':
                content.style.top = '50%';
                content.style.right = '20px';
                content.style.left = 'auto';
                content.style.bottom = 'auto';
                content.style.transform = 'translateY(-50%)';
                break;
                
            case 'center':
            default:
                content.style.top = '50%';
                content.style.left = '50%';
                content.style.right = 'auto';
                content.style.bottom = 'auto';
                content.style.transform = 'translate(-50%, -50%)';
                break;
        }
        
        // Ensure content stays within viewport on mobile
        const contentRect = content.getBoundingClientRect();
        
        if (contentRect.right > viewportWidth - 20) {
            content.style.left = 'auto';
            content.style.right = '20px';
        }
        
        if (contentRect.bottom > viewportHeight - 20) {
            content.style.top = 'auto';
            content.style.bottom = '20px';
            content.style.transform = 'none';
        }
    }

    // Navigation functions
    function nextTutorialStep() {
        if (currentTutorialStep < tutorialSteps.length - 1) {
            // Remove interactive class from previous element
            const prevStep = tutorialSteps[currentTutorialStep];
            if (prevStep.highlight) {
                const prevElement = document.querySelector(prevStep.highlight);
                if (prevElement) {
                    prevElement.classList.remove('tutorial-interactive');
                }
            }
            
            showTutorialStep(currentTutorialStep + 1);
        }
    }

    function prevTutorialStep() {
        if (currentTutorialStep > 0) {
            // Remove interactive class from current element
            const currentStep = tutorialSteps[currentTutorialStep];
            if (currentStep.highlight) {
                const currentElement = document.querySelector(currentStep.highlight);
                if (currentElement) {
                    currentElement.classList.remove('tutorial-interactive');
                }
            }
            
            showTutorialStep(currentTutorialStep - 1);
        }
    }

    function goToTutorialStep(stepIndex) {
        if (stepIndex >= 0 && stepIndex < tutorialSteps.length) {
            // Remove interactive class from current element
            const currentStep = tutorialSteps[currentTutorialStep];
            if (currentStep.highlight) {
                const currentElement = document.querySelector(currentStep.highlight);
                if (currentElement) {
                    currentElement.classList.remove('tutorial-interactive');
                }
            }
            
            showTutorialStep(stepIndex);
        }
    }

    // Interactive feature trying functions
    function tryCurrentFeature() {
        const step = tutorialSteps[currentTutorialStep];
        if (step.tryAction && typeof window[step.tryAction] === 'function') {
            window[step.tryAction]();
        }
    }

    function renderPatientActivityChart(data = [12, 19, 10, 22, 30, 25, 40]) {
        const ctx = document.getElementById('patientActivityChart');
        if (!ctx) return;

        // Destroy old chart if it exists
        if (patientActivityChart) {
            patientActivityChart.destroy();
        }

        patientActivityChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Patient Visits',
                    data: data,
                    tension: 0.4,
                    fill: true,
                    backgroundColor: 'rgba(0, 191, 255, 0.15)',
                    borderColor: '#00bfff',
                    borderWidth: 2,
                    pointRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { color: '#888' }
                    },
                    x: {
                        ticks: { color: '#888' }
                    }
                }
            }
        });
    }

    function tryStatistics() {
        // Simulate hover effect on statistics cards
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            setTimeout(() => {
                card.style.transform = 'translateY(-5px)';
                card.style.boxShadow = '0 10px 20px rgba(0, 191, 255, 0.3)';
                
                setTimeout(() => {
                    card.style.transform = '';
                    card.style.boxShadow = '';
                }, 500);
            }, index * 200);
        });
        
        showToast('Statistics cards highlighted! They show real-time clinic data.', 'success');
    }

    function tryChartControls() {
        // Simulate clicking chart period buttons
        const periodButtons = document.querySelectorAll('.time-period-btn');
        periodButtons.forEach((btn, index) => {
            setTimeout(() => {
                btn.style.transform = 'scale(1.1)';
                btn.style.boxShadow = '0 0 15px rgba(0, 191, 255, 0.5)';
                
                setTimeout(() => {
                    btn.style.transform = '';
                    btn.style.boxShadow = '';
                    
                    // Activate the monthly button
                    if (index === 1) {
                        btn.classList.add('active');
                        periodButtons[0].classList.remove('active');
                        periodButtons[2].classList.remove('active');
                        showToast('Switched to monthly view! Chart now shows patient visits by week.', 'success');
                    }
                }, 300);
            }, index * 400);
        });
    }

    function tryAppointmentRequest() {
        // Highlight the first appointment request action buttons
        const firstRow = document.querySelector('#requestTableBody tr');
        if (firstRow) {
            const actionButtons = firstRow.querySelectorAll('.action-btn');
            actionButtons.forEach((btn, index) => {
                setTimeout(() => {
                    btn.style.transform = 'translateY(-5px) scale(1.1)';
                    btn.style.boxShadow = '0 10px 20px rgba(0, 0, 0, 0.2)';
                    
                    setTimeout(() => {
                        btn.style.transform = '';
                        btn.style.boxShadow = '';
                    }, 500);
                }, index * 300);
            });
            
            showToast('Appointment request actions highlighted! Click to accept, reject, or reschedule.', 'success');
        }
    }

    function tryTodayAppointments() {
        // Highlight today's appointment row
        const todayRows = document.querySelectorAll('#todayTableBody tr');
        if (todayRows.length > 0) {
            todayRows[0].style.backgroundColor = 'rgba(0, 191, 255, 0.1)';
            todayRows[0].style.transform = 'scale(1.02)';
            todayRows[0].style.boxShadow = '0 5px 15px rgba(0, 191, 255, 0.2)';
            
            setTimeout(() => {
                todayRows[0].style.backgroundColor = '';
                todayRows[0].style.transform = '';
                todayRows[0].style.boxShadow = '';
            }, 1500);
            
            showToast('Today\'s appointment highlighted! Click to view details and manage.', 'success');
        }
    }

    function tryCalendar() {
        // Highlight today's date on calendar
        const todayDate = document.querySelector('.calendar-sidebar .date:nth-child(32)'); // May 25th
        if (todayDate) {
            todayDate.classList.add('active');
            todayDate.style.transform = 'scale(1.2)';
            todayDate.style.boxShadow = '0 0 20px rgba(56, 189, 248, 0.5)';
            
            setTimeout(() => {
                todayDate.classList.remove('active');
                todayDate.style.transform = '';
                todayDate.style.boxShadow = '';
            }, 1500);
            
            showToast('Calendar date highlighted! Click any date to view appointments.', 'success');
        }
    }

    function tryBulkActions() {
        // Simulate checking the select all checkbox
        const selectAllCheckbox = document.getElementById('selectAll');
        if (selectAllCheckbox) {
            selectAllCheckbox.checked = true;
            selectAllCheckbox.style.transform = 'scale(1.3)';
            
            // Trigger change event to show bulk actions
            const event = new Event('change');
            selectAllCheckbox.dispatchEvent(event);
            
            setTimeout(() => {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.style.transform = '';
                selectAllCheckbox.dispatchEvent(event);
            }, 2000);
            
            showToast('Bulk selection activated! Checkboxes allow multiple appointment management.', 'success');
        }
    }

    function trySearchFilter() {
        // Animate search input
        const searchInput = document.getElementById('searchRequests');
        const filterSelect = document.getElementById('procedureFilter');
        
        if (searchInput) {
            searchInput.focus();
            searchInput.style.boxShadow = '0 0 20px rgba(0, 191, 255, 0.5)';
            searchInput.placeholder = 'Try typing "John" to search...';
            
            setTimeout(() => {
                searchInput.style.boxShadow = '';
                searchInput.placeholder = 'Search appointments...';
                searchInput.blur();
            }, 2000);
        }
        
        if (filterSelect) {
            setTimeout(() => {
                filterSelect.style.boxShadow = '0 0 20px rgba(0, 191, 255, 0.5)';
                filterSelect.style.transform = 'scale(1.05)';
                
                setTimeout(() => {
                    filterSelect.style.boxShadow = '';
                    filterSelect.style.transform = '';
                }, 1000);
            }, 500);
            
            showToast('Search and filter tools highlighted! Use them to find appointments quickly.', 'success');
        }
    }

    function tryThemeToggle() {
        // Animate theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const slider = document.querySelector('.slider');
        
        if (themeToggle && slider) {
            // Toggle to dark mode
            themeToggle.checked = true;
            slider.style.backgroundColor = '#00bfff';
            
            // Add animation
            slider.style.transform = 'scale(1.2)';
            
            setTimeout(() => {
                slider.style.transform = '';
                
                // Toggle back to light mode
                setTimeout(() => {
                    themeToggle.checked = false;
                    slider.style.backgroundColor = '#ccc';
                    
                    setTimeout(() => {
                        // Apply the actual theme change based on user's preference
                        const savedTheme = localStorage.getItem('theme') || 'light';
                        document.documentElement.setAttribute('data-theme', savedTheme);
                        themeToggle.checked = savedTheme === 'dark';
                    }, 500);
                }, 1000);
            }, 1000);
            
            showToast('Theme toggle demonstrated! Switch between light and dark modes.', 'success');
        }
    }

    // Tutorial completion functions
    function skipTutorial() {
        isTutorialActive = false;
        document.getElementById('tutorialOverlay').style.display = 'none';
        document.body.style.overflow = 'auto';
        
        // Remove interactive classes
        document.querySelectorAll('.tutorial-interactive').forEach(el => {
            el.classList.remove('tutorial-interactive');
        });
        
        showToast('Tutorial skipped. You can restart it anytime from the sidebar.', 'info');
    }

    function completeTutorial() {
        isTutorialActive = false;
        tutorialCompleted = true;
        localStorage.setItem('tutorialCompleted', 'true');
        document.getElementById('tutorialOverlay').style.display = 'none';
        document.body.style.overflow = 'auto';
        
        // Remove interactive classes
        document.querySelectorAll('.tutorial-interactive').forEach(el => {
            el.classList.remove('tutorial-interactive');
        });
        
        // Show completion celebration
        showToast(' Tutorial completed! You\'re ready to manage your clinic efficiently.', 'success');
        
        // Add some celebratory effects
        const celebration = document.createElement('div');
        celebration.style.position = 'fixed';
        celebration.style.top = '0';
        celebration.style.left = '0';
        celebration.style.width = '100%';
        celebration.style.height = '100%';
        celebration.style.pointerEvents = 'none';
        celebration.style.zIndex = '9999999';
        document.body.appendChild(celebration);
        
        // Add confetti effect
        for (let i = 0; i < 50; i++) {
            setTimeout(() => {
                const confetti = document.createElement('div');
                confetti.style.position = 'absolute';
                confetti.style.width = '10px';
                confetti.style.height = '10px';
                confetti.style.background = ['#00bfff', '#28a745', '#ffc107', '#dc3545'][Math.floor(Math.random() * 4)];
                confetti.style.borderRadius = '50%';
                confetti.style.top = '0';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animation = `fall ${1 + Math.random() * 2}s linear forwards`;
                celebration.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => confetti.remove(), 3000);
            }, i * 50);
        }
        
        // Remove celebration div after animation
        setTimeout(() => celebration.remove(), 3000);
    }

    // Toast notification function (existing from your code)
    function showToast(message, type = 'info') {
        const toastContainer = document.querySelector('.toast-container') || (() => {
            const container = document.createElement('div');
            container.className = 'toast-container';
            document.body.appendChild(container);
            return container;
        })();

        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;

        let icon;
        switch (type) {
            case 'success':
                icon = '<i class="fas fa-check-circle" style="color: #28a745;"></i>';
                break;
            case 'warning':
                icon = '<i class="fas fa-exclamation-triangle" style="color: #ffc107;"></i>';
                break;
            case 'error':
                icon = '<i class="fas fa-times-circle" style="color: #dc3545;"></i>';
                break;
            default:
                icon = '<i class="fas fa-info-circle" style="color: var(--sidebar-active);"></i>';
        }

        toast.innerHTML = `${icon} ${message}`;
        toastContainer.appendChild(toast);

        // Remove toast after animation
        setTimeout(() => {
            toast.style.animation = 'slideOut 0.3s ease forwards';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }
    // =============================================
    // RESCHEDULE FUNCTIONALITY - FULLY WORKING
    // =============================================


    // Global variables for rescheduling
    let currentAppointmentId = null;
    let currentRescheduleId = null;
    let currentRescheduleType = 'single';
    let selectedRescheduleDate = null;
    let rescheduleCurrentMonth = new Date().getMonth();
    let rescheduleCurrentYear = new Date().getFullYear();
    let reminderAppointmentData = null;


    // Mock data for demonstration
    let appointmentRequests = [
        {
            id: '1',
            patientName: 'John Doe',
            requestedDate: new Date().toISOString().split('T')[0],
            requestedTime: '10:00',
            procedure: 'Dental Cleaning',
            doctor: 'Dr. Smith',
            status: 'Pending',
            contact: '09123456789',
            email: 'john@example.com',
            notes: 'Regular checkup',
            patientId: 'P001',
            age: 35,
            gender: 'Male',
            address: '123 Main St, City'
        },
        {
            id: '2',
            patientName: 'Jane Smith',
            requestedDate: new Date().toISOString().split('T')[0],
            requestedTime: '14:00',
            procedure: 'Tooth Extraction',
            doctor: 'Dr. Johnson',
            status: 'Pending',
            contact: '09123456790',
            email: 'jane@example.com',
            notes: 'Wisdom tooth removal',
            patientId: 'P002',
            age: 28,
            gender: 'Female',
            address: '456 Oak Ave, City'
        },
        {
            id: '3',
            patientName: 'Michael Johnson',
            requestedDate: new Date().toISOString().split('T')[0],
            requestedTime: '15:30',
            procedure: 'Dental Crown',
            doctor: 'Dr. Smith',
            status: 'Pending',
            contact: '09123456791',
            email: 'michael@example.com',
            notes: 'Follow-up for crown fitting',
            patientId: 'P003',
            age: 45,
            gender: 'Male',
            address: '789 Pine Rd, City'
        },
        {
            id: '4',
            patientName: 'Sarah Williams',
            requestedDate: new Date().toISOString().split('T')[0],
            requestedTime: '11:00',
            procedure: 'Dental Filling',
            doctor: 'Dr. Johnson',
            status: 'Pending',
            contact: '09123456792',
            email: 'sarah@example.com',
            notes: 'Cavity filling - right molar',
            patientId: 'P004',
            age: 32,
            gender: 'Female',
            address: '321 Elm St, City'
        }
    ];


    let todaysAppointments = [
        {
            id: 't1',
            patientName: 'Robert Brown',
            date: new Date().toISOString().split('T')[0],
            time: '09:00',
            procedure: 'Root Canal',
            status: 'Scheduled',
            contact: '09123456791',
            email: 'robert@example.com',
            patientId: 'P005',
            age: 42,
            gender: 'Male',
            address: '789 Maple Dr, City'
        }
    ];


    // FIXED: Updated showLoading function
    function showLoading(show) {
        const overlay = document.getElementById('loadingOverlay');
        if (show) {
            overlay.classList.add('active');
        } else {
            overlay.classList.remove('active');
        }
    }


    // Helper function to format date
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
        });
    }


    // Format time for display
    function formatTime(timeString) {
        const [hours, minutes] = timeString.split(':');
        const hour = parseInt(hours);
        const ampm = hour >= 12 ? 'PM' : 'AM';
        const displayHour = hour % 12 || 12;
        return `${displayHour}:${minutes} ${ampm}`;
    }


    // Update stats function
    async function updateStats() {
        // Count scheduled today
        const today = new Date().toISOString().split('T')[0];
        const scheduledToday = todaysAppointments.filter(apt => 
            apt.date === today && apt.status === 'Scheduled'
        ).length;
        document.getElementById('scheduledCount').textContent = scheduledToday;
        
        // Count pending requests
        const pendingRequests = appointmentRequests.filter(req => 
            req.status === 'Pending'
        ).length;
        document.getElementById('upcomingCount').textContent = pendingRequests;
        document.getElementById('requestCount').textContent = pendingRequests;
        document.getElementById('requestCount').classList.toggle('show', pendingRequests > 0);
        
        // Count today's appointments
        document.getElementById('todayCount').textContent = scheduledToday;
        document.getElementById('todayCount').classList.toggle('show', scheduledToday > 0);
        
        // For demo purposes, set some default values
        document.getElementById('completedCount').textContent = '3';
        document.getElementById('RescheduleCount').textContent = '2';
        document.getElementById('walkInCount').textContent = '1';
    }

    async function fetchAppointmentsFromBackend() {
    try {
        showLoading(true);

        const response = await fetch('http://localhost:3000/appointments/');
        if (!response.ok) throw new Error('Failed to fetch appointments');

        const data = await response.json();

        // Replace mock data with backend data
        appointmentRequests = data || [];

        const today = new Date().toISOString().split('T')[0]; // "YYYY-MM-DD"
        const responseToday = await fetch(`http://localhost:3000/appointments/${today}`);
        const dataToday = await responseToday.json();

        todaysAppointments = dataToday || [];

        // Update UI
        updateRequestTable();
        updateTodayAppointmentsTable();
        updateStats();

    } catch (err) {
        console.error(err);
        showToast('Error fetching appointments from server', 'error');
    } finally {
        showLoading(false);
    }
}

    // TODAYS APPOINTMENTS
    function updateTodayAppointmentsTable() {
        const tbody = document.getElementById('todayTableBody');
        if (!tbody) return;

        tbody.innerHTML = '';

        if (todaysAppointments.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align:center; padding:20px; color: var(--text-muted);">
                        No appointments scheduled for today
                    </td>
                </tr>
            `;
            return;
        }

        todaysAppointments.forEach(apt => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td>
                    <input 
                        type="checkbox"
                        class="request-checkbox"
                        data-id="${apt.id}"
                        onchange="updateBulkActions()"
                    >
                </td>
                <td>${apt.patient_name}</td>
                <td>${apt.date}</td>
                <td>${apt.time}</td>
                <td>${apt.procedure}</td>
                <td>${apt.status}</td>
                <td>
                    <button class="action-btn">View</button>
                </td>
            `;
        });
    }


    // Toast notification function
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
            <span>${message}</span>
        `;
        
        const container = document.querySelector('.toast-container') || createToastContainer();
        container.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'slideOut 0.3s ease forwards';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }


    function createToastContainer() {
        const container = document.createElement('div');
        container.className = 'toast-container';
        document.body.appendChild(container);
        return container;
    }

    const logoutBtn = document.getElementById("logoutBtn");
    if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
            localStorage.removeItem("isLoggedIn");
            localStorage.removeItem("user");
            localStorage.removeItem("role");
            window.location.reload(); // reload page to update UI
        });
    }


    // Update request table with reschedule buttons
        // Update request table with reschedule buttons
    function updateRequestTable() {
        const searchTerm = document.getElementById('searchRequests').value.toLowerCase();
        const procedureFilter = document.getElementById('procedureFilter').value;

        const filteredRequests = appointmentRequests.filter(request => {
            // If searchTerm is empty, matchesSearch is automatically true
            const matchesSearch = !searchTerm || 
                request.patient_name.toLowerCase().includes(searchTerm) ||
                request.procedure.toLowerCase().includes(searchTerm) ||
                (request.doctor && request.doctor.toLowerCase().includes(searchTerm));

            const matchesProcedure = !procedureFilter || request.procedure === procedureFilter;

            // Only show Pending appointments (status_id = 1)
            const isPending = request.status_id === 1;

            return matchesSearch && matchesProcedure && isPending;
        });

        const tbody = document.getElementById('requestTableBody');
        tbody.innerHTML = '';

        if (filteredRequests.length === 0) {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">
                    <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;"></i>
                    <br>
                    No appointment requests found
                </td>
            `;
            return;
        }

        filteredRequests.forEach(request => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td><input type="checkbox" class="request-checkbox" value="${request.id}" onchange="updateBulkActions()"></td>
                <td>
                    <i class="fas fa-user-circle" style="margin-right: 8px; color: var(--sidebar-active);"></i>
                    ${request.patient_name}
                </td>
                <td><i class="fas fa-calendar" style="margin-right: 8px;"></i>${formatDate(request.requested_date)}</td>
                <td><i class="fas fa-clock" style="margin-right: 8px;"></i>${request.requested_time}</td>
                <td><span class="procedure-tag">${request.procedure}</span></td>
                <td><i class="fas fa-user-md" style="margin-right: 8px;"></i>${request.doctor || ''}</td>
                <td>
                    <div class="action-buttons-container">
                        <button class="action-btn accept-btn" onclick="showAcceptModal(${request.id})" title="Accept Appointment">
                            <i class="fas fa-check"></i> Accept
                        </button>
                        <button class="action-btn reschedule-btn" onclick="showRescheduleModal('${request.id}')" title="Reschedule Appointment">
                            <i class="fas fa-calendar-alt"></i> Reschedule
                        </button>
                    </div>
                </td>
            `;
        });

        document.getElementById('selectAll').checked = false;
        updateBulkActions();

        // Update request count badge
        const requestCount = filteredRequests.length;
        const badge = document.getElementById('requestCount');
        badge.textContent = requestCount;
        badge.classList.toggle('show', requestCount > 0);
    }


    // Show reschedule modal 
    function showRescheduleModal(appointmentId) {
        currentRescheduleId = appointmentId;
        currentRescheduleType = 'single';
        
        // Set minimum date to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        const formattedDate = tomorrow.toISOString().split('T')[0];
        
        document.getElementById('rescheduleDate').min = formattedDate;
        document.getElementById('rescheduleDate').value = formattedDate;
        document.getElementById('rescheduleTime').value = '09:00';
        document.getElementById('rescheduleReason').value = '';
        document.getElementById('sendRescheduleNotification').checked = true;
        
        // Show the modal
        document.getElementById('rescheduleConfirmationModal').classList.add('active');
    }


    // Show bulk reschedule modal
    function showBulkRescheduleModal() {
        const selectedCheckboxes = document.querySelectorAll('.request-checkbox:checked');
        if (selectedCheckboxes.length === 0) {
            showToast('Please select at least one appointment to reschedule', 'warning');
            return;
        }
        
        currentRescheduleId = 'bulk';
        currentRescheduleType = 'bulk';
        
        // Set minimum date to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        const formattedDate = tomorrow.toISOString().split('T')[0];
        
        document.getElementById('rescheduleDate').min = formattedDate;
        document.getElementById('rescheduleDate').value = formattedDate;
        document.getElementById('rescheduleTime').value = '09:00';
        document.getElementById('rescheduleReason').value = 'Multiple appointments rescheduled';
        document.getElementById('sendRescheduleNotification').checked = true;
        
        // Show the modal
        document.getElementById('rescheduleConfirmationModal').classList.add('active');
    }


    // Close reschedule modal
    function closeRescheduleModal() {
        document.getElementById('rescheduleConfirmationModal').classList.remove('active');
        currentRescheduleId = null;
        currentRescheduleType = 'single';
    }


    // Open calendar picker from reschedule modal
    function openCalendarPicker() {
        closeRescheduleModal();
        initializeRescheduleCalendar();
        document.getElementById('calendarDatePickerModal').classList.add('active');
    }


    // Initialize reschedule calendar
    function initializeRescheduleCalendar() {
        const monthYearElement = document.getElementById('rescheduleMonthYear');
        const calendarGrid = document.getElementById('rescheduleCalendarGrid');
        const daysHeader = document.getElementById('rescheduleCalendarDays');
        
        // Set month/year display
        const monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"];
        monthYearElement.textContent = `${monthNames[rescheduleCurrentMonth]} ${rescheduleCurrentYear}`;
        
        // Clear previous content
        calendarGrid.innerHTML = '';
        daysHeader.innerHTML = '';
        
        // Add day headers
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        days.forEach(day => {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day-header';
            dayElement.textContent = day;
            daysHeader.appendChild(dayElement);
        });
        
        // Get first day of month
        const firstDay = new Date(rescheduleCurrentYear, rescheduleCurrentMonth, 1);
        const lastDay = new Date(rescheduleCurrentYear, rescheduleCurrentMonth + 1, 0);
        const startDay = firstDay.getDay();
        const totalDays = lastDay.getDate();
        
        // Add empty cells for days before first day of month
        for (let i = 0; i < startDay; i++) {
            const emptyCell = document.createElement('div');
            emptyCell.className = 'calendar-day empty';
            calendarGrid.appendChild(emptyCell);
        }
        
        // Add days of the month
        const today = new Date();
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        for (let day = 1; day <= totalDays; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = day;
            dayElement.dataset.date = `${rescheduleCurrentYear}-${(rescheduleCurrentMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
            
            const currentDate = new Date(rescheduleCurrentYear, rescheduleCurrentMonth, day);
            
            // Disable past dates
            if (currentDate < tomorrow) {
                dayElement.style.opacity = '0.5';
                dayElement.style.cursor = 'not-allowed';
            } else {
                // Add click event for future dates
                dayElement.addEventListener('click', () => {
                    // Remove selection from all days
                    document.querySelectorAll('#rescheduleCalendarGrid .calendar-day').forEach(d => {
                        d.classList.remove('selected');
                    });
                    // Add selection to clicked day
                    dayElement.classList.add('selected');
                    selectedRescheduleDate = dayElement.dataset.date;
                });
            }
            
            calendarGrid.appendChild(dayElement);
        }
    }


    // Calendar navigation functions for reschedule modal
    function reschedulePrevMonth() {
        rescheduleCurrentMonth--;
        if (rescheduleCurrentMonth < 0) {
            rescheduleCurrentMonth = 11;
            rescheduleCurrentYear--;
        }
        initializeRescheduleCalendar();
    }


    function rescheduleNextMonth() {
        rescheduleCurrentMonth++;
        if (rescheduleCurrentMonth > 11) {
            rescheduleCurrentMonth = 0;
            rescheduleCurrentYear++;
        }
        initializeRescheduleCalendar();
    }


    function rescheduleToday() {
        const today = new Date();
        rescheduleCurrentMonth = today.getMonth();
        rescheduleCurrentYear = today.getFullYear();
        initializeRescheduleCalendar();
    }


    function closeCalendarPickerModal() {
        document.getElementById('calendarDatePickerModal').classList.remove('active');
        // Reopen reschedule modal if we came from there
        if (currentRescheduleId) {
            setTimeout(() => showRescheduleModal(currentRescheduleId), 300);
        }
    }


    function selectCalendarDate() {
        const selectedTime = document.getElementById('calendarRescheduleTime').value;
        
        if (!selectedRescheduleDate) {
            showToast('Please select a date', 'warning');
            return;
        }
        
        if (!selectedTime) {
            showToast('Please select a time', 'warning');
            return;
        }
        
        // Format date for input field
        document.getElementById('rescheduleDate').value = selectedRescheduleDate;
        document.getElementById('rescheduleTime').value = selectedTime;
        
        closeCalendarPickerModal();
        showRescheduleModal(currentRescheduleId);
    }


    // Submit reschedule
    function submitReschedule() {
        const newDate = document.getElementById('rescheduleDate').value;
        const newTime = document.getElementById('rescheduleTime').value;
        const reason = document.getElementById('rescheduleReason').value;
        const sendNotification = document.getElementById('sendRescheduleNotification').checked;
        
        if (!newDate || !newTime) {
            showToast('Please select both date and time', 'warning');
            return;
        }
        
        if (!reason.trim()) {
            showToast('Please provide a reason for rescheduling', 'warning');
            return;
        }
        
        // Validate date is not in the past
        const selectedDateTime = new Date(`${newDate}T${newTime}`);
        const now = new Date();
        if (selectedDateTime < now) {
            showToast('Cannot schedule appointment in the past', 'error');
            return;
        }
        
        // Show loading
        showLoading(true);
        
        setTimeout(() => {
            showLoading(false);
            
            if (currentRescheduleType === 'single') {
                // Single appointment reschedule
                const appointmentIndex = appointmentRequests.findIndex(req => req.id === currentRescheduleId);
                
                if (appointmentIndex === -1) {
                    showToast('Appointment not found', 'error');
                    return;
                }
                
                const appointment = appointmentRequests[appointmentIndex];
                const oldDate = appointment.requestedDate;
                
                // Update appointment status
                appointment.status = 'Rescheduled';
                appointment.rescheduledDate = newDate;
                appointment.rescheduledTime = newTime;
                appointment.rescheduleReason = reason;
                
                // Create new appointment
                const newAppointment = {
                    id: 'req_' + Date.now() + Math.random(),
                    patientName: appointment.patientName,
                    requestedDate: newDate,
                    requestedTime: newTime,
                    procedure: appointment.procedure,
                    doctor: appointment.doctor,
                    status: 'Pending',
                    originalRequestDate: new Date().toISOString().split('T')[0],
                    notes: `Rescheduled from ${oldDate}. Reason: ${reason}`,
                    contact: appointment.contact,
                    email: appointment.email,
                    patientId: appointment.patientId,
                    age: appointment.age,
                    gender: appointment.gender,
                    address: appointment.address
                };
                
                appointmentRequests.push(newAppointment);
                
                // Update UI
                updateRequestTable();
                updateStats();
                
                // Show reminder modal if notification is enabled
                if (sendNotification) {
                    closeRescheduleModal();
                    setTimeout(() => {
                        showReminderModal({
                            patientName: appointment.patientName,
                            oldDate: oldDate,
                            newDate: newDate,
                            newTime: newTime,
                            procedure: appointment.procedure,
                            doctor: appointment.doctor,
                            contact: appointment.contact,
                            email: appointment.email
                        });
                    }, 300);
                } else {
                    showToast(`Appointment rescheduled to ${formatDate(newDate)} at ${formatTime(newTime)}`, 'success');
                }
                
            } else {
                // Bulk reschedule
                const selectedCheckboxes = document.querySelectorAll('.request-checkbox:checked');
                const appointmentIds = Array.from(selectedCheckboxes).map(cb => cb.value);
                
                // Process each appointment
                appointmentIds.forEach(appointmentId => {
                    const appointmentIndex = appointmentRequests.findIndex(req => req.id === appointmentId);
                    
                    if (appointmentIndex !== -1) {
                        const appointment = appointmentRequests[appointmentIndex];
                        
                        appointment.status = 'Rescheduled';
                        appointment.rescheduledDate = newDate;
                        appointment.rescheduledTime = newTime;
                        appointment.rescheduleReason = reason;
                        
                        // Create new appointment
                        const newAppointment = {
                            id: 'req_' + Date.now() + Math.random(),
                            patientName: appointment.patientName,
                            requestedDate: newDate,
                            requestedTime: newTime,
                            procedure: appointment.procedure,
                            doctor: appointment.doctor,
                            status: 'Pending',
                            originalRequestDate: new Date().toISOString().split('T')[0],
                            notes: `Rescheduled from ${appointment.requestedDate}. Reason: ${reason}`,
                            contact: appointment.contact,
                            email: appointment.email,
                            patientId: appointment.patientId,
                            age: appointment.age,
                            gender: appointment.gender,
                            address: appointment.address
                        };
                        
                        appointmentRequests.push(newAppointment);
                    }
                });
                
                // Update UI
                updateRequestTable();
                updateStats();
                
                showToast(`${appointmentIds.length} appointments rescheduled to ${formatDate(newDate)} at ${formatTime(newTime)}`, 'success');
            }
            
            closeRescheduleModal();
            
        }, 1000);
    }

    function showAddAppointmentModal() {
    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('addAppointmentDate').value = today;
    
    // Set default time to next hour
    const nextHour = new Date();
    nextHour.setHours(nextHour.getHours() + 1);
    const timeString = nextHour.getHours().toString().padStart(2, '0') + ':00';
    document.getElementById('addAppointmentTime').value = timeString;
    
    // Clear other fields
    document.getElementById('addPatientSelect').value = '';
    document.getElementById('addAppointmentProcedure').value = '';
    document.getElementById('addAppointmentDoctor').value = 'Dr. Admin';
    document.getElementById('addAppointmentNotes').value = '';
    
    document.getElementById('addAppointmentModal').classList.add('active');
}


function closeAddAppointmentModal() {
    document.getElementById('addAppointmentModal').classList.remove('active');
}

function showAddPatientModal() {
    console.log("HELLLOOO")
    // Clear all fields
    document.getElementById('patientFirstName').value = '';
    document.getElementById('patientLastName').value = '';
    document.getElementById('patientDOB').value = '';
    document.getElementById('patientGender').value = '';
    document.getElementById('patientContact').value = '';
    document.getElementById('patientEmail').value = '';
    document.getElementById('patientAddress').value = '';
    document.getElementById('patientMedicalHistory').value = '';
    
    document.getElementById('addPatientModal').classList.add('active');
}


function closeAddPatientModal() {
    document.getElementById('addPatientModal').classList.remove('active');
}

function saveNewAppointment() {
    const patientSelect = document.getElementById('addPatientSelect').value;
    const date = document.getElementById('addAppointmentDate').value;
    const time = document.getElementById('addAppointmentTime').value;
    const procedure = document.getElementById('addAppointmentProcedure').value;
    const doctor = document.getElementById('addAppointmentDoctor').value;
    const notes = document.getElementById('addAppointmentNotes').value;
    
    // Validation
    if (!patientSelect) {
        showToast('Please select a patient', 'warning');
        return;
    }
    
    if (!date || !time) {
        showToast('Please select date and time', 'warning');
        return;
    }
    
    if (!procedure) {
        showToast('Please select a procedure', 'warning');
        return;
    }
    
    // Get patient name based on selection
    let patientName = '';
    if (patientSelect === 'new') {
        // If new patient, open patient modal first
        showToast('Please add patient details first', 'warning');
        closeAddAppointmentModal();
        setTimeout(() => showAddPatientModal(), 300);
        return;
    } else {
        // Get patient name from existing data
        const patientData = getPatientData(patientSelect);
        patientName = patientData ? patientData.name : 'New Patient';
    }
    
    showLoading(true);
    
    // Simulate API call
    setTimeout(() => {
        showLoading(false);
        
        // Check if appointment is for today
        const today = new Date().toISOString().split('T')[0];
        const isToday = date === today;
        
        // Create new appointment
        const newAppointment = {
            id: 'apt_' + Date.now(),
            patientName: patientName,
            date: date,
            time: time,
            procedure: procedure,
            doctor: doctor,
            status: 'Scheduled',
            notes: notes,
            contact: '09123456789', // Default contact
            email: 'patient@example.com', // Default email
            patientId: patientSelect,
            createdAt: new Date().toISOString()
        };

        if (isToday) {
            // Add to today's appointments
            todaysAppointments.push(newAppointment);
            showToast(`Appointment added for today at ${formatTime(time)}`, 'success');
        } else {
            // Add to appointment requests (for future dates)
            appointmentRequests.push({
                ...newAppointment,
                requestedDate: date,
                requestedTime: time,
                status: 'Pending'
            });
            showToast(`Appointment scheduled for ${formatDate(date)}`, 'success');
        }

         updateTodayTable();
        updateStats();
        closeAddAppointmentModal();
        
    }, 1000);
}

function saveNewPatient() {
    const firstName = document.getElementById('patientFirstName').value.trim();
    const lastName = document.getElementById('patientLastName').value.trim();
    const dob = document.getElementById('patientDOB').value;
    const gender = document.getElementById('patientGender').value;
    const contact = document.getElementById('patientContact').value.trim();
    const email = document.getElementById('patientEmail').value.trim();
    const address = document.getElementById('patientAddress').value.trim();
    const medicalHistory = document.getElementById('patientMedicalHistory').value.trim();
    
    // Validation
    if (!firstName || !lastName) {
        showToast('Please enter patient name', 'warning');
        return;
    }
    
    if (!dob) {
        showToast('Please enter date of birth', 'warning');
        return;
    }
    
    if (!gender) {
        showToast('Please select gender', 'warning');
        return;
    }
    
    if (!contact) {
        showToast('Please enter contact number', 'warning');
        return;
    }
    
    showLoading(true);
    
    // Simulate API call
    setTimeout(() => {
        showLoading(false);
        
        // Generate patient ID
        const patientId = 'P' + (Math.floor(Math.random() * 900) + 100);
        const fullName = `${firstName} ${lastName}`;
        
        // In a real app, you would save this to a database
        // For now, we'll just show a success message
        showToast(`Patient ${fullName} added successfully!`, 'success');
        
        // Add to patient select dropdown in appointment modal
        const select = document.getElementById('addPatientSelect');
        const option = document.createElement('option');
        option.value = patientId;
        option.textContent = `${fullName} (${patientId})`;
        select.appendChild(option);
        
        closeAddPatientModal();
        
    }, 1000);
}


    // Show reminder modal
    function showReminderModal(appointmentData) {
        reminderAppointmentData = appointmentData;
        
        // Update modal content
        document.getElementById('reminderPatientName').textContent = appointmentData.patientName;
        document.getElementById('reminderOldDate').textContent = formatDate(appointmentData.oldDate);
        document.getElementById('reminderNewDate').textContent = formatDate(appointmentData.newDate);
        document.getElementById('reminderNewTime').textContent = formatTime(appointmentData.newTime);
        document.getElementById('reminderProcedure').textContent = appointmentData.procedure;
        document.getElementById('smsPhoneNumber').innerHTML = `<i class="fas fa-phone"></i> ${appointmentData.contact || '+63 XXX XXX XXXX'}`;
        document.getElementById('emailAddress').innerHTML = `<i class="fas fa-at"></i> ${appointmentData.email || 'patient@example.com'}`;
        
        // Update previews
        document.getElementById('previewPatientName').textContent = appointmentData.patientName;
        document.getElementById('previewNewDate').textContent = formatDate(appointmentData.newDate);
        document.getElementById('previewNewTime').textContent = formatTime(appointmentData.newTime);
        document.getElementById('previewProcedure').textContent = appointmentData.procedure;
        
        document.getElementById('emailPreviewPatientName').textContent = appointmentData.patientName;
        document.getElementById('emailPreviewNewDate').textContent = formatDate(appointmentData.newDate);
        document.getElementById('emailPreviewNewTime').textContent = formatTime(appointmentData.newTime);
        document.getElementById('emailPreviewProcedure').textContent = appointmentData.procedure;
        document.getElementById('emailPreviewDoctor').textContent = appointmentData.doctor || 'Dr. Admin';
        
        // Reset progress
        document.getElementById('reminderProgress').style.display = 'none';
        document.getElementById('reminderStatus').innerHTML = '<i class="fas fa-clock"></i> Pending';
        document.getElementById('reminderStatus').style.color = '#ffc107';
        document.getElementById('sendReminderBtn').disabled = false;
        
        // Show modal
        document.getElementById('reminderConfirmationModal').classList.add('active');
        
        // Add event listeners for channel options
        document.querySelectorAll('.channel-option').forEach(option => {
            option.addEventListener('click', function() {
                const checkbox = this.querySelector('.channel-checkbox');
                checkbox.checked = !checkbox.checked;
                updateCheckmark(this, checkbox.checked);
            });
        });
        
        // Add event listeners for schedule options
        document.getElementById('sendNowOption').addEventListener('change', function() {
            document.getElementById('scheduleTimePicker').style.display = this.checked ? 'none' : 'block';
        });
        
        document.getElementById('sendLaterOption').addEventListener('change', function() {
            document.getElementById('scheduleTimePicker').style.display = this.checked ? 'block' : 'none';
        });
        
        // Set default time (1 hour from now)
        const defaultTime = new Date();
        defaultTime.setHours(defaultTime.getHours() + 1);
        document.getElementById('scheduledDateTime').value = defaultTime.toISOString().slice(0, 16);
    }


    // Update checkmark display
    function updateCheckmark(element, isChecked) {
        const checkmark = element.querySelector('.checkmark');
        const icon = checkmark.querySelector('i');
        
        if (isChecked) {
            checkmark.style.background = 'var(--sidebar-active)';
            checkmark.style.borderColor = 'var(--sidebar-active)';
            icon.style.display = 'block';
            element.style.borderColor = 'var(--sidebar-active)';
        } else {
            checkmark.style.background = 'transparent';
            checkmark.style.borderColor = 'var(--border-color)';
            icon.style.display = 'none';
            element.style.borderColor = 'var(--border-color)';
        }
    }


    // Close reminder modal
    function closeReminderModal() {
        document.getElementById('reminderConfirmationModal').classList.remove('active');
        reminderAppointmentData = null;
    }


    // Set reminder time
    function setReminderTime() {
        const dateTime = document.getElementById('scheduledDateTime').value;
        if (!dateTime) {
            showToast('Please select a date and time', 'warning');
            return;
        }
        
        const selectedTime = new Date(dateTime);
        const now = new Date();
        
        if (selectedTime < now) {
            showToast('Cannot schedule reminder in the past', 'error');
            return;
        }
        
        showToast(`Reminder scheduled for ${selectedTime.toLocaleString()}`, 'success');
    }


    // Test reminder (simulate sending)
    function testReminder() {
        const smsChecked = document.getElementById('smsCheckbox').checked;
        const emailChecked = document.getElementById('emailCheckbox').checked;
        
        if (!smsChecked && !emailChecked) {
            showToast('Please select at least one communication channel', 'warning');
            return;
        }
        
        showLoading(true);
        
        // Simulate test send
        setTimeout(() => {
            showLoading(false);
            showToast('Test reminder sent successfully!', 'success');
            document.getElementById('reminderStatus').innerHTML = '<i class="fas fa-check-circle"></i> Test Sent';
            document.getElementById('reminderStatus').style.color = '#28a745';
            document.getElementById('reminderStatus').classList.add('success-pulse');
            
            setTimeout(() => {
                document.getElementById('reminderStatus').classList.remove('success-pulse');
            }, 500);
        }, 1500);
    }


    // Send reminder
    function sendReminder() {
        const smsChecked = document.getElementById('smsCheckbox').checked;
        const emailChecked = document.getElementById('emailCheckbox').checked;
        const saveTemplate = document.getElementById('saveTemplate').checked;
        const sendNow = document.getElementById('sendNowOption').checked;
        const scheduledTime = document.getElementById('scheduledDateTime').value;
        
        if (!smsChecked && !emailChecked) {
            showToast('Please select at least one communication channel', 'warning');
            return;
        }
        
        if (!sendNow && !scheduledTime) {
            showToast('Please select a scheduled time', 'warning');
            return;
        }
        
        // Disable send button
        document.getElementById('sendReminderBtn').disabled = true;
        
        // Show progress bar
        const progressDiv = document.getElementById('reminderProgress');
        const progressBar = document.getElementById('progressBar');
        const progressPercentage = document.getElementById('progressPercentage');
        const progressDetails = document.getElementById('progressDetails');
        
        progressDiv.style.display = 'block';
        progressBar.style.width = '0%';
        progressPercentage.textContent = '0%';
        progressDetails.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        
        // Simulate progress
        let progress = 0;
        const interval = setInterval(() => {
            progress += 10;
            progressBar.style.width = `${progress}%`;
            progressPercentage.textContent = `${progress}%`;
            
            // Update details based on progress
            if (progress === 30) {
                progressDetails.innerHTML = '<i class="fas fa-paper-plane"></i> Sending SMS...';
            } else if (progress === 60) {
                progressDetails.innerHTML = '<i class="fas fa-envelope"></i> Sending Email...';
            } else if (progress === 90) {
                progressDetails.innerHTML = '<i class="fas fa-database"></i> Saving to database...';
            }
            
            if (progress >= 100) {
                clearInterval(interval);
                
                // Update status
                setTimeout(() => {
                    document.getElementById('reminderStatus').innerHTML = '<i class="fas fa-check-circle"></i> Sent Successfully';
                    document.getElementById('reminderStatus').style.color = '#28a745';
                    progressDetails.innerHTML = '<i class="fas fa-check-circle" style="color: #28a745;"></i> All notifications sent successfully!';
                    
                    showToast('Reminder sent successfully!', 'success');
                    
                    // Save template if checked
                    if (saveTemplate) {
                        saveReminderTemplate();
                    }
                    
                    // Close modal after 2 seconds
                    setTimeout(() => {
                        closeReminderModal();
                    }, 2000);
                }, 500);
            }
        }, 200);
    }


    // Save reminder template
    function saveReminderTemplate() {
        const template = {
            smsEnabled: document.getElementById('smsCheckbox').checked,
            emailEnabled: document.getElementById('emailCheckbox').checked,
            scheduleOption: document.querySelector('input[name="scheduleOption"]:checked').value,
            lastUpdated: new Date().toISOString()
        };
        
        // In a real app, save to localStorage or backend
        localStorage.setItem('reminderTemplate', JSON.stringify(template));
        console.log('Template saved:', template);
    }


    // Load reminder template
    function loadReminderTemplate() {
        const savedTemplate = localStorage.getItem('reminderTemplate');
        if (savedTemplate) {
            const template = JSON.parse(savedTemplate);
            document.getElementById('smsCheckbox').checked = template.smsEnabled;
            document.getElementById('emailCheckbox').checked = template.emailEnabled;
            // Update checkmarks
            document.querySelectorAll('.channel-option').forEach(option => {
                const checkbox = option.querySelector('.channel-checkbox');
                updateCheckmark(option, checkbox.checked);
            });
        }
    }


    // Update bulk actions
    function updateBulkActions() {
        const selectedCheckboxes = document.querySelectorAll('.request-checkbox:checked');
        const selectedCount = selectedCheckboxes.length;
        const bulkActions = document.getElementById('requestBulkActions');
        
        if (selectedCount > 0) {
            bulkActions.classList.add('show');
            document.getElementById('requestSelectedCount').textContent = selectedCount;
        } else {
            bulkActions.classList.remove('show');
        }
    }


    // Reset filters
    function resetFilters() {
        document.getElementById('searchRequests').value = '';
        document.getElementById('procedureFilter').value = '';
        updateRequestTable();
    }


    // Accept modal functions
    function showAcceptModal(appointmentId) {
        const appointment = appointmentRequests.find(
            req => req.id === appointmentId
        );
        if (!appointment) return;

        currentAppointmentId = appointmentId;

        // Optional enhancement (contextual, not required)
        document.getElementById("acceptModalTitle").textContent =
            `Accept ${appointment.patient_name}'s Appointment`;

        document.getElementById("acceptModalMessage").textContent =
            `Accept appointment for ${appointment.patient_name} on ${formatDate(appointment.requested_date)} at ${appointment.requested_time}?`;

        document
            .getElementById("acceptConfirmationModal")
            .classList.add("active");
    }

    async function closeAcceptModal() {
        document.getElementById('acceptConfirmationModal').classList.remove('active');
        currentAppointmentId = null;
    }

    async function confirmAcceptAppointment() {
        if (!currentAppointmentId) return;

        try {
            const appointment = appointmentRequests.find(
                req => req.id === currentAppointmentId
            );
            if (!appointment) return;

            const res = await fetch(
                "http://localhost:3000/appointments/updateStatus",
                {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        appointment_id: currentAppointmentId,
                        new_status: 2 // number
                    })
                }
            );


            if (!res.ok) {
                throw new Error("Accept failed");
            }

            appointmentRequests = appointmentRequests.filter(
                req => req.id !== currentAppointmentId
            );

            fetchAppointmentsFromBackend();
            updateRequestTable();
            updateTodayAppointmentsTable();
            updateStats();
            closeAcceptModal();

            showToast(
                `Appointment accepted for ${appointment.patientName}`,
                "success"
            );

        } catch (err) {
            console.error(err);
            showToast("Unable to accept appointment", "error");
        }
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', async function() {
        initTutorial()
        // Show loading initially
        showLoading(true);
        
        // Set today's date
        const today = new Date();
        document.getElementById('todayDate').textContent = today.toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        
        // Update tables and stats
        await fetchAppointmentsFromBackend();
        renderPatientActivityChart();
        updateRequestTable();
        updateTodayAppointmentsTable();
        await updateStats();
        
        // Set minimum date for reschedule input
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('rescheduleDate').min = tomorrow.toISOString().split('T')[0];
        
        // Load reminder template
        loadReminderTemplate();
        
        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        themeToggle.checked = savedTheme === 'dark';
        
        themeToggle.addEventListener('change', function() {
            const theme = this.checked ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        });
        
        // Bulk selection
        document.getElementById('selectAll').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.request-checkbox');
            checkboxes.forEach(cb => cb.checked = this.checked);
            updateBulkActions();
        });
        
        // Search functionality
        document.getElementById('searchRequests').addEventListener('input', updateRequestTable);
        document.getElementById('procedureFilter').addEventListener('change', updateRequestTable);
        
        // Hide loading after everything is set up
        setTimeout(() => showLoading(false), 500);
        
        // Add safety timeout
        setTimeout(() => {
            if (document.getElementById('loadingOverlay').classList.contains('active')) {
                showLoading(false);
                console.warn('Loading timeout - forcing hide');
            }
        }, 10000);

    document.getElementById("addPatientForm").addEventListener("submit", function(e) {
        e.preventDefault();

        alert("Patient successfully added!");
        closeAddPatient();

        // DITO ka pwede maglagay ng:
        // fetch()  save to database
        // or update patient table
    });
    });
    function restartTutorial(){
    // Clean any existing tutorial state
    document.querySelectorAll(".spotlight").forEach(el=>{
        el.classList.remove("spotlight");
    });

    const arrow = document.getElementById("arrow");
    const overlay = document.getElementById("overlay");
    const walkBox = document.getElementById("walkBox");

    if(arrow) arrow.style.display="none";
    if(overlay) overlay.style.display="none";
    if(walkBox) walkBox.style.display="none";

    // Restart walkthrough
    if(typeof startTutorial === "function"){
        startTutorial();
    }else{
        alert("Tutorial function not found.");
    }
    }


    </script>


</body>
</html>